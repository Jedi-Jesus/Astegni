<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Filter Click Test</title>
    <script>tailwind.config={corePlugins:{preflight:false}}</script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold mb-6">Location Filter Click Test</h1>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Location Filter:
                </label>
                <select id="locationFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">All Locations</option>
                    <option value="Ethiopia">In Ethiopia (Country)</option>
                    <option value="Addis Ababa, Ethiopia">In Addis Ababa (City)</option>
                    <option value="Yeka, Addis Ababa, Ethiopia">In Yeka (Sub-city/District)</option>
                    <option value="Megenagna, Yeka, Addis Ababa, Ethiopia">In Megenagna (Neighborhood)</option>
                </select>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <p class="text-sm text-blue-700">
                    <strong>Instructions:</strong> Select a location from the dropdown above.
                    Watch the console (F12) and the log below.
                </p>
            </div>

            <div class="mb-4">
                <h2 class="text-lg font-semibold mb-2">Event Log:</h2>
                <div id="eventLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto"></div>
            </div>

            <div class="mb-4">
                <h2 class="text-lg font-semibold mb-2">Current Filter Value:</h2>
                <div id="currentValue" class="bg-gray-100 p-4 rounded text-lg font-mono">
                    (not selected)
                </div>
            </div>

            <div class="mb-4">
                <h2 class="text-lg font-semibold mb-2">Expected API Call:</h2>
                <div id="apiCall" class="bg-gray-100 p-4 rounded font-mono text-sm break-all">
                    (not selected)
                </div>
            </div>
        </div>
    </div>

    <script>
        const eventLog = document.getElementById('eventLog');
        const currentValue = document.getElementById('currentValue');
        const apiCall = document.getElementById('apiCall');
        const locationFilter = document.getElementById('locationFilter');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? 'text-green-400' :
                         type === 'error' ? 'text-red-400' :
                         type === 'warn' ? 'text-yellow-400' : 'text-green-400';

            const entry = document.createElement('div');
            entry.className = color;
            entry.textContent = `[${timestamp}] ${message}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;

            console.log(`[LocationFilterTest] ${message}`);
        }

        // Simulate the event listener from find-tutors
        locationFilter.addEventListener('change', function(event) {
            const value = event.target.value.trim();

            log('‚îÅ'.repeat(60), 'info');
            log('üéØ Location filter changed!', 'success');
            log(`Selected value: "${value}"`, 'info');
            log(`Selected text: "${event.target.options[event.target.selectedIndex].text}"`, 'info');

            // Update displays
            currentValue.textContent = value || '(empty - All Locations)';

            // Simulate the API call
            const params = new URLSearchParams();
            if (value) {
                params.append('user_location', value);
            }
            params.append('page', '1');
            params.append('limit', '12');

            const apiUrl = `http://localhost:8000/api/tutors?${params.toString()}`;
            apiCall.textContent = apiUrl;

            log(`API URL: ${apiUrl}`, 'success');
            log('‚úÖ Filter would be applied to tutors query', 'success');

            // Test if backend param is correct
            if (value) {
                log(`Backend will filter: User.location.contains("${value.toLowerCase()}")`, 'info');
                log('This will match any tutor whose location contains this string', 'info');
            } else {
                log('Backend will return all tutors (no location filter)', 'warn');
            }

            log('‚îÅ'.repeat(60), 'info');
        });

        // Initial log
        log('‚úÖ Location filter test loaded', 'success');
        log('Select a location from dropdown to test', 'info');
        log('‚îÅ'.repeat(60), 'info');
    </script>
</body>
</html>
