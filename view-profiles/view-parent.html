<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTEGNI - View Parent Profile</title>
    <!-- Preconnect for faster font loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Google Fonts - For Appearance Modal Font Selection -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600;700&family=Comic+Neue:wght@400;700&family=Caveat:wght@400;500;600;700&family=Patrick+Hand&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- TailwindCSS CDN -->
    <script src="../js/config.js?v=20260216"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- Custom Styles -->
    <link rel="stylesheet" href="../css/root.css?v=20260206-adblocker-fix">
    <link rel="stylesheet" href="../css/root/profile-dropdown.css">
    <link rel="stylesheet" href="../css/find-tutors/navbar.css">
    <link rel="stylesheet" href="../css/shared/profile-responsive.css">
    <link rel="stylesheet" href="../css/view-parent.css">
    <!-- Shared Modal Styles -->
    <link rel="stylesheet" href="../css/common-modals/add-role-modal.css">
    <link rel="stylesheet" href="../css/common-modals/coming-soon-modal.css">
    <link rel="stylesheet" href="../css/common-modals/promo-modal.css">
    <link rel="stylesheet" href="../css/common-modals/chat-modal.css">
    <!-- Standalone Chat Call Modal Styles -->
    <link rel="stylesheet" href="../css/common-modals/chat-call-modal.css">
    <link rel="stylesheet" href="../css/common-modals/view-request-modal.css">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- View Parent Responsive Styles -->
    <link rel="stylesheet" href="../css/view-parent/view-parent-responsive.css">
    <!-- Profile Dropdown Fix - MUST load last -->
    <link rel="stylesheet" href="../css/view-parent/profile-specific-fix.css">
</head>

<body class="font-sans">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loader">
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
        </div>
        <h2 class="loading-text">ASTEGNI</h2>
    </div>
    <script>
        // Hide loading screen only after page fully loads
        window.addEventListener('load', function() {
            // Wait for all resources (images, styles, scripts) to fully load
            setTimeout(() => {
                const loadingScreen = document.getElementById("loading-screen");
                if (loadingScreen) {
                    loadingScreen.classList.add("fade-out");
                    setTimeout(() => {
                        loadingScreen.style.display = "none";
                    }, 600);
                }
            }, 300);
        });

        // Fallback: Force hide after 10 seconds if something goes wrong
        setTimeout(() => {
            const loadingScreen = document.getElementById("loading-screen");
            if (loadingScreen && loadingScreen.style.display !== "none") {
                loadingScreen.classList.add("fade-out");
                setTimeout(() => {
                    loadingScreen.style.display = "none";
                }, 600);
            }
        }, 10000);
    </script>

    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container" style="max-width: 100%; padding: 0 1rem;">
            <div class="nav-brand">
                <button class="sidebar-toggle" id="hamburger" aria-label="Toggle sidebar" onclick="toggleSidebar()">
                    <span class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </button>
                <a href="../index.html" class="logo-container">
                    <div class="logo-text">
                        <span class="logo-main">Astegni</span>
                        <span class="logo-sub">View Parent</span>
                    </div>
                    <span class="logo-badge">Beta</span>
                </a>
            </div>

            <!-- Right Section: Nav Menu + Actions -->
            <div class="nav-actions" style="display: flex; align-items: center; gap: 0.5rem; margin-right: 0;">
                <div class="nav-items" style="display: flex; gap: 0.25rem;">
                    <a class="nav-link" href="#" onclick="handleNavLinkClick(event, 'news')">
                        <span class="nav-icon">üì∞</span> News
                    </a>
                    <a class="nav-link" href="../branch/find-tutors.html">
                        <span class="nav-icon">üë®‚Äçüè´</span> Find Tutors
                    </a>
                    <a class="nav-link" href="../branch/videos.html">
                        <span class="nav-icon">üé¨</span> Videos
                    </a>
                    <a class="nav-link" href="#" onclick="handleNavLinkClick(event, 'store')">
                        <span class="nav-icon">üìö</span> Bookstore
                    </a>
                    <a class="nav-link" href="#" onclick="handleNavLinkClick(event, 'find-jobs')">
                        <span class="nav-icon">üíº</span> Find a Job
                    </a>
                </div>
                <!-- Profile container -->
                <div id="profile-container" class="profile-dropdown-container">
                    <button id="profile-dropdown-toggle" class="profile-dropdown-toggle"
                        onclick="toggleProfileDropdown()">
                        <img id="profile-pic" class="profile-pic" alt="Profile">
                        <span id="profile-name" class="profile-name"></span>
                        <svg class="dropdown-arrow" width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>

                    <div id="profile-dropdown-menu" class="profile-dropdown-menu">
                        <!-- User info header - CLICKABLE to go to profile page -->
                        <a href="#" id="dropdown-profile-link" class="dropdown-header-link">
                            <div class="dropdown-header">
                                <img id="dropdown-profile-pic" class="profile-pic" alt="Profile">
                                <div class="dropdown-user-info">
                                    <span id="dropdown-user-name" class="dropdown-user-name"></span>
                                    <span id="dropdown-user-email" class="dropdown-user-email"></span>
                                    <span id="dropdown-user-role" class="dropdown-user-role"></span>
                                </div>
                                <svg class="dropdown-header-arrow" width="16" height="16" fill="currentColor"
                                    viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </a>

                        <div class="dropdown-divider"></div>

                        <!-- Deletion Countdown Banner (shown when role is scheduled for deletion) -->
                        <div id="deletion-countdown-banner" class="deletion-countdown-banner hidden">
                            <div class="countdown-content">
                                <div class="countdown-icon">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="countdown-text">
                                    <div class="countdown-title">Role Scheduled for Deletion</div>
                                    <div class="countdown-details">
                                        Your <span id="countdown-role-name" class="font-semibold"></span> role will be deleted in
                                        <span id="countdown-days" class="font-bold text-orange-600"></span> days
                                    </div>
                                </div>
                            </div>
                            <button onclick="openAddRoleModal()" class="countdown-restore-btn">
                                Restore Role
                            </button>
                        </div>

                        <div class="dropdown-divider" id="countdown-divider" style="display: none;"></div>

                        <!-- Role switcher (shown only if user has multiple roles) -->
                        <div id="role-switcher-section" class="role-switcher-section hidden">
                            <div class="dropdown-item-header">Switch Role</div>
                            <div id="role-options" class="role-options">
                                <!-- Role options will be dynamically added here -->
                            </div>
                            <div class="dropdown-divider"></div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <button class="dropdown-item logout-item" onclick="logout()">
                            <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                </path>
                            </svg>
                            Logout
                        </button>
                    </div>
                </div>

                <!-- Notification Icon -->
                <button class="icon-btn" aria-label="Notifications">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                        </path>
                    </svg>
                    <span class="notification-badge">5</span>
                </button>

                <!-- Theme Toggle -->
                <button id="theme-toggle-btn" class="icon-btn" aria-label="Toggle theme">
                    <svg id="theme-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                </button>
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle mobile menu">
                    <span class="mobile-hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay hidden"></div>

    <!-- Mobile Slide-in Menu -->
    <div id="mobileMenu" class="mobile-menu hidden">
        <div class="mobile-menu-header">
            <div class="mobile-menu-logo">
                <span class="logo-main">Astegni</span>
                <span class="logo-badge">Beta</span>
            </div>
            <button class="mobile-menu-close" onclick="closeMobileMenu()">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div class="mobile-menu-content">
            <!-- Navigation Links -->
            <div class="mobile-nav-section">
                <a href="#" class="mobile-menu-link" onclick="handleNavLinkClick(event, 'news')">
                    <span class="nav-icon">üì∞</span> News
                </a>
                <a href="../branch/find-tutors.html" class="mobile-menu-link">
                    <span class="nav-icon">üë®‚Äçüè´</span> Find Tutors
                </a>
                <a href="../branch/videos.html" class="mobile-menu-link">
                    <span class="nav-icon">üé¨</span> Videos
                </a>
                <a href="#" class="mobile-menu-link" onclick="handleNavLinkClick(event, 'store')">
                    <span class="nav-icon">üìö</span> Bookstore
                </a>
                <a href="#" class="mobile-menu-link" onclick="handleNavLinkClick(event, 'find-jobs')">
                    <span class="nav-icon">üíº</span> Find a Job
                </a>
            </div>

            <!-- Profile Section -->
            <div class="mobile-profile-section">
                <div class="mobile-profile-header" id="mobile-profile-header" onclick="toggleMobileProfileDropdown()">
                    <img id="mobile-profile-pic" class="mobile-profile-pic" alt="Profile">
                    <div class="mobile-profile-info">
                        <span id="mobile-profile-name" class="mobile-profile-name"></span>
                        <span id="mobile-profile-role" class="mobile-profile-role"></span>
                    </div>
                    <svg class="mobile-profile-arrow" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="mobile-profile-dropdown">
                    <div class="mobile-profile-dropdown-content">
                        <!-- Dropdown Profile Picture Section - Clickable Link -->
                        <a href="#" id="mobile-my-profile-link" class="mobile-dropdown-user-info">
                            <img id="mobile-dropdown-profile-pic" class="mobile-dropdown-profile-pic" alt="Profile">
                            <div class="mobile-dropdown-user-details">
                                <span id="mobile-dropdown-profile-name" class="mobile-dropdown-profile-name"></span>
                                <span id="mobile-dropdown-profile-role" class="mobile-dropdown-profile-role"></span>
                            </div>
                        </a>

                        <div id="mobile-role-switcher" class="mobile-role-switcher hidden">
                        <div class="mobile-dropdown-divider"></div>
                        <div class="mobile-dropdown-label">Switch Role</div>
                        <div id="mobile-role-options"></div>
                    </div>
                    <div class="mobile-dropdown-divider"></div>
                    <button class="mobile-dropdown-item logout" onclick="showLogoutModal()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Logout
                    </button>
                    </div>
                </div>
            </div>

            <!-- Theme Toggle -->
            <div class="mobile-theme-section">
                <button class="mobile-theme-toggle" onclick="toggleTheme()">
                    <svg class="theme-icon-sun" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <span>Toggle Theme</span>
                </button>
            </div>

            <!-- Notifications -->
            <div class="mobile-notifications-section">
                <button class="mobile-notifications-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    <span>Notifications</span>
                    <span class="mobile-notification-badge">5</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Rotating Ad Section -->
    <div class="leaderboard-banner premium-promo" style="margin-top: 2rem;" data-placement="leaderboard_banner" data-profile-type="parent" data-location="view_parent">
        <!-- Ads will be loaded dynamically via adRotationManager -->
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar-container"
        style="position: fixed; left: -280px; top: 72px; width: 280px; height: calc(100vh - 72px); background: var(--card-bg); box-shadow: 2px 0 10px rgba(0,0,0,0.1); transition: left 0.3s ease; z-index: 1000; overflow-y: auto;">
        <div class="sidebar-content" style="padding: 1.5rem;">
            <div class="sidebar-nav">
                <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem; font-weight: 700; color: var(--heading);">Parent
                    Profile</h3>

                <a href="#" onclick="switchPanel(event, 'dashboard'); return false;" class="sidebar-link active"
                    data-panel="dashboard">
                    <span class="sidebar-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <hr class="my-4 border-gray-300">
                <a href="#" onclick="switchPanel(event, 'children-profiles'); return false;" class="sidebar-link"
                    data-panel="children-profiles">
                    <span class="sidebar-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <span>Children Profiles</span>
                    <span class="badge-count" id="children-count-badge">0</span>
                </a>
                <hr class="my-4 border-gray-300">
                <a href="#" onclick="switchPanel(event, 'blog'); return false;" class="sidebar-link" data-panel="blog">
                    <span class="sidebar-icon">üìù</span>
                    <span>Blog</span>
                    <span class="badge-count">7</span>
                </a>
                <hr class="my-4 border-gray-300">
                <a href="#" onclick="switchPanel(event, 'reviews-ratings'); return false;" class="sidebar-link"
                    data-panel="reviews-ratings">
                    <span class="sidebar-icon">‚≠ê</span>
                    <span>Reviews & Ratings</span>
                    <span id="reviews-badge-count" class="badge-count">0</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;"
        onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <section class="py-8" style="padding-top: 1rem;">
        <div class="container mx-auto px-4">

            <!-- Main Content with Widgets -->
            <div class="flex gap-6">
                <!-- Left Content Area -->
                <div class="flex-1" style="min-width: 0;">
                    <!-- Panels Section -->
                    <div class="panels-container">
                        <!-- Dashboard Panel (Default) -->
                        <div id="dashboard-panel" class="panel-content active">

                            <!-- Hero Section -->
                            <section class="hero-section animate__animated animate__fadeIn">
                                <h2 class="hero-title">
                                    <span id="typedText">Dedicated Parent ‚Ä¢ Supporting Educational Excellence</span>
                                    <span id="cursor" class="cursor-blink">|</span>
                                </h2>
                                <p id="hero-subtitle" class="hero-subtitle">Actively involved in children's academic
                                    journey and development</p>
                                <div class="hero-stats">
                                    <div class="stat-item animate__animated animate__fadeInUp"
                                        style="animation-delay: 0.2s">
                                        <span class="stat-number" data-target="3" data-suffix="">0</span>
                                        <span class="stat-label">Children</span>
                                    </div>
                                    <div class="stat-item animate__animated animate__fadeInUp"
                                        style="animation-delay: 0.3s">
                                        <span class="stat-number" data-target="92" data-suffix="%">0</span>
                                        <span class="stat-label">Engagement Rate</span>
                                    </div>
                                    <div class="stat-item animate__animated animate__fadeInUp"
                                        style="animation-delay: 0.4s">
                                        <span class="stat-number" data-target="96" data-suffix="%">0</span>
                                        <span class="stat-label">Rating</span>
                                    </div>
                                </div>
                            </section>
                            <!-- Profile Header Section -->
                            <section class="profile-header-section mb-8">
                                <div class="cover-image-container relative">
                                    <img id="cover-img"
                                        src="../uploads/system_images/system_cover_pictures/parent-cover.webp"
                                        alt="Cover" class="cover-img">
                                    <div class="cover-overlay"></div>
                                    <!-- View Mode Badge -->
                                    <div class="view-mode-badge">
                                        <span>üëÅÔ∏è</span>
                                        <span>View Mode</span>
                                    </div>
                                </div>

                                <div class="profile-main-info">
                                    <div class="profile-info-wrapper"
                                        style="display: flex; gap: 2rem; align-items: flex-start;">
                                        <div class="profile-avatar-container"
                                            style="position: relative; flex-shrink: 0;">
                                            <img id="profile-avatar"
                                                src="../uploads/system_images/system_profile_pictures/Dad-profile.jpg"
                                                alt="Parent Profile" class="profile-avatar">
                                            <span class="online-indicator"></span>
                                        </div>

                                        <div class="profile-details-section" style="flex: 1; padding-top: 1.5rem;">
                                            <div class="profile-name-row" style="margin-bottom: 1.25rem;">
                                                <h1 class="profile-name" id="parentName"
                                                    style="margin-bottom: 0.5rem; white-space: nowrap !important; word-break: keep-all !important; max-width: none !important; width: auto !important; display: inline-block !important;">
                                                    Mulugeta Alemu</h1>
                                                <!-- Username field under name -->
                                                <div id="parentUsername"
                                                    style="font-size: 0.95rem; color: var(--text-muted); font-weight: 500; margin-bottom: 1rem;">
                                                    <!-- Username will be populated dynamically -->
                                                </div>
                                                <div class="badges-row"
                                                    style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1rem; margin-top: 1rem;">
                                                    <span class="profile-badge verified"
                                                        style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white;">‚úî
                                                        Verified Parent</span>
                                                    <span class="profile-badge relationship"
                                                        style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                                                        Father</span>
                                                    <span class="profile-badge expert"
                                                        style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">üìà
                                                        92% Engagement</span>
                                                </div>
                                            </div>

                                            <div class="rating-section" style="margin-bottom: 1rem;">
                                                <div class="rating-wrapper"
                                                    style="display: flex; align-items: center; gap: 0.75rem;">
                                                    <div class="rating-tooltip-container">
                                                        <div class="rating-stars rating-stars-trigger"
                                                            style="color: #f59e0b; font-size: 1.5rem;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                                                        <div class="rating-tooltip">
                                                            <h4
                                                                style="margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 600; color: var(--heading);">
                                                                Rating Breakdown</h4>

                                                            <div class="rating-metric">
                                                                <div class="metric-header">
                                                                    <span class="metric-label">Engagement with
                                                                        Tutor</span>
                                                                    <span class="metric-score">4.6</span>
                                                                </div>
                                                                <div class="metric-bar">
                                                                    <div class="metric-fill" style="width: 92%"></div>
                                                                </div>
                                                            </div>

                                                            <div class="rating-metric">
                                                                <div class="metric-header">
                                                                    <span class="metric-label">Engagement with
                                                                        Child</span>
                                                                    <span class="metric-score">4.8</span>
                                                                </div>
                                                                <div class="metric-bar">
                                                                    <div class="metric-fill" style="width: 96%"></div>
                                                                </div>
                                                            </div>

                                                            <div class="rating-metric">
                                                                <div class="metric-header">
                                                                    <span class="metric-label">Responsiveness</span>
                                                                    <span class="metric-score">4.9</span>
                                                                </div>
                                                                <div class="metric-bar">
                                                                    <div class="metric-fill" style="width: 98%"></div>
                                                                </div>
                                                            </div>

                                                            <div class="rating-metric">
                                                                <div class="metric-header">
                                                                    <span class="metric-label">Payment
                                                                        Consistency</span>
                                                                    <span class="metric-score">5.0</span>
                                                                </div>
                                                                <div class="metric-bar">
                                                                    <div class="metric-fill" style="width: 100%"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <span class="rating-value"
                                                        style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">4.8</span>
                                                    <span class="rating-count"
                                                        style="color: var(--text-secondary); font-size: 0.95rem;">(45
                                                        tutor reviews)</span>
                                                </div>
                                            </div>

                                            <div class="profile-location"
                                                style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: rgba(var(--button-bg-rgb), 0.05); border-radius: 12px; margin-bottom: 0.75rem;">
                                                <span class="location-icon" style="font-size: 1.25rem;">üìç</span>
                                                <span style="color: var(--text); font-size: 0.95rem;">Addis Ababa,
                                                    Ethiopia | Parent of 3 Students</span>
                                            </div>

                                            <!-- Relationship & Occupation (Contact Info Style) -->
                                            <div class="profile-contact-info"
                                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 0.75rem;">
                                                <div
                                                    style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: rgba(var(--button-bg-rgb), 0.05); border-radius: 12px;">
                                                    <span style="font-size: 1.25rem;">üë§</span>
                                                    <div style="flex: 1;">
                                                        <div
                                                            style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.125rem;">
                                                            Relationship</div>
                                                        <div
                                                            style="color: var(--text); font-size: 0.875rem; font-weight: 500;">
                                                            Father</div>
                                                    </div>
                                                </div>
                                                <div
                                                    style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: rgba(var(--button-bg-rgb), 0.05); border-radius: 12px;">
                                                    <span style="font-size: 1.25rem;">üíº</span>
                                                    <div style="flex: 1;">
                                                        <div
                                                            style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.125rem;">
                                                            Occupation</div>
                                                        <div
                                                            style="color: var(--text); font-size: 0.875rem; font-weight: 500;">
                                                            Software Engineer</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Hobbies & Interests -->
                                            <div id="hobbies-display-container"
                                                style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: rgba(var(--button-bg-rgb), 0.05); border-radius: 12px; margin-bottom: 0.75rem;">
                                                <span style="font-size: 1.25rem;">üé®</span>
                                                <div style="flex: 1;">
                                                    <div
                                                        style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.125rem;">
                                                        Hobbies & Interests</div>
                                                    <div id="parent-hobbies"
                                                        style="color: var(--text-muted); font-size: 0.875rem; font-weight: 500; font-style: italic;">
                                                        No hobbies yet</div>
                                                </div>
                                            </div>

                                            <!-- Social Links -->
                                            <div class="profile-social-links" id="social-links-container"
                                                style="display: flex; gap: 0.75rem; margin-top: 1.5rem; margin-bottom: 0.75rem; padding: 0.5rem 0;">
                                                <!-- Social links will be populated dynamically by JS with beautiful styling -->
                                            </div>

                                            <div class="profile-quote"
                                                style="background: linear-gradient(135deg, rgba(79,70,229,0.1) 0%, rgba(124,58,237,0.05) 100%); border-left: 4px solid #4f46e5; border-radius: 12px; padding: 1.25rem 1.5rem; margin-top: 1.5rem; font-style: italic; color: var(--text);">
                                                <span>"Investing in my children's education for a brighter
                                                    future"</span>
                                            </div>

                                            <!-- Action Buttons -->
                                            <div class="profile-actions"
                                                style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                                                <button onclick="openConnectModal()" class="btn-primary"
                                                    style="flex: 1; min-width: 160px; padding: 0.875rem 1.5rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; border: none; cursor: pointer;">
                                                    ü§ù Connect
                                                </button>
                                                <button onclick="openMessageModal()" class="btn-secondary"
                                                    style="flex: 1; min-width: 160px; padding: 0.875rem 1.5rem; font-weight: 600; border-radius: 12px; background: transparent; color: var(--text); border: 2px solid rgba(var(--border-rgb), 0.3); cursor: pointer;">
                                                    üí¨ Message
                                                </button>
                                                <button onclick="shareProfile()" class="btn-secondary"
                                                    style="flex: 1; min-width: 160px; padding: 0.875rem 1.5rem; font-weight: 600; border-radius: 12px; background: transparent; color: var(--text); border: 2px solid rgba(var(--border-rgb), 0.3); cursor: pointer;">
                                                    <i class="fas fa-share-alt"></i> Share
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- About Section -->
                            <section
                                style="background: var(--card-bg); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <h3
                                    style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--heading);">
                                    About This Parent</h3>
                                <p style="color: var(--text); line-height: 1.7;">Mulugeta Alemu is a dedicated parent of
                                    three children, actively involved in their educational journey. With a strong
                                    commitment to providing quality education, he maintains regular communication with
                                    tutors, monitors academic progress closely, and ensures timely payment for all
                                    educational services. His engagement level and support have contributed
                                    significantly to his children's academic success.</p>
                            </section>

                            <!-- Parent Statistics Section -->
                            <section
                                style="background: var(--card-bg); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <h2
                                    style="font-size: 1.75rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--heading);">
                                    Parent Statistics</h2>
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                                    <div
                                        style="padding: 1.5rem; background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.05)); border-radius: 12px; text-align: center;">
                                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--heading);">3</div>
                                        <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                                            Children Enrolled</div>
                                        <div
                                            style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                            All Active</div>
                                    </div>
                                    <div
                                        style="padding: 1.5rem; background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.05)); border-radius: 12px; text-align: center;">
                                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìà</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--heading);">92%</div>
                                        <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                                            Engagement Rate</div>
                                        <div
                                            style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                            Excellent</div>
                                    </div>
                                    <div
                                        style="padding: 1.5rem; background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(124,58,237,0.05)); border-radius: 12px; text-align: center;">
                                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí≥</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--heading);">100%
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                                            Payment Punctuality</div>
                                        <div
                                            style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                            Always On Time</div>
                                    </div>
                                    <div
                                        style="padding: 1.5rem; background: linear-gradient(135deg, rgba(234,179,8,0.1), rgba(202,138,4,0.05)); border-radius: 12px; text-align: center;">
                                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚≠ê</div>
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--heading);">4.8</div>
                                        <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                                            Parent Rating</div>
                                        <div
                                            style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                            From Tutors</div>
                                    </div>
                                </div>
                            </section>

                            <!-- Reviews & Ratings Section -->
                            <section id="dashboard-reviews-section"
                                style="background: var(--card-bg); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                    <h2
                                        style="font-size: 1.75rem; font-weight: 700; margin: 0; color: var(--heading); display: flex; align-items: center; gap: 0.75rem;">
                                        <span>‚≠ê</span> Reviews & Ratings
                                    </h2>
                                    <button onclick="viewAllReviews()"
                                        style="background: var(--button-bg); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s;">
                                        View All
                                    </button>
                                </div>

                                <!-- Reviews Grid - Dynamically populated from parent_reviews table -->
                                <div id="dashboard-reviews-grid" style="display: grid; gap: 1.5rem;">
                                    <!-- Loading placeholder - will be replaced by view-parent-reviews.js -->
                                    <div id="dashboard-reviews-loading" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                        <div style="width: 40px; height: 40px; border: 3px solid rgba(var(--button-bg-rgb), 0.2); border-top-color: var(--button-bg); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                                        <p>Loading reviews...</p>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Children Profiles Panel -->
                        <div id="children-profiles-panel" class="panel-content">
                            <div style="margin-bottom: 2rem;">
                                <h2
                                    style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--heading);">
                                    Children Profiles</h2>
                                <p style="color: var(--text-secondary);">View detailed profiles and academic progress of
                                    all children</p>
                            </div>

                            <!-- Loading State -->
                            <div id="children-loading" style="display: none; text-align: center; padding: 3rem;">
                                <div style="width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                                <p style="color: var(--text-secondary);">Loading children profiles...</p>
                            </div>

                            <!-- Children Cards Grid - Populated dynamically by view-parent-children.js -->
                            <div class="children-cards-grid">
                                <!-- Cards will be inserted here dynamically -->
                            </div>
                        </div>

                        <!-- Other panels placeholders -->
                        <div id="blog-panel" class="panel-content">
                            <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 1rem;">Blog Posts</h2>

                            <!-- Loading State -->
                            <div id="blog-loading" style="display: none; text-align: center; padding: 3rem;">
                                <div
                                    style="width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;">
                                </div>
                                <p style="color: var(--text-secondary);">Loading blog posts...</p>
                            </div>

                            <!-- Blog Posts Grid -->
                            <div id="blog-posts-grid"
                                style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                                <!-- Blog cards will be inserted here dynamically -->
                            </div>

                            <!-- Empty State -->
                            <div id="blog-empty-state"
                                style="display: none; text-align: center; padding: 3rem; background: var(--card-bg); border-radius: 16px; border: 2px dashed var(--border-color);">
                                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üìù</div>
                                <h3
                                    style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--heading);">
                                    No Blogs Yet</h3>
                                <p style="color: var(--text-secondary);">This parent hasn't published any blog posts
                                    yet.</p>
                            </div>

                            <!-- Error State -->
                            <div id="blog-error-state"
                                style="display: none; text-align: center; padding: 3rem; background: var(--card-bg); border-radius: 16px; border: 2px solid #ef4444;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                                <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: #ef4444;">
                                    Failed to Load Blogs</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 1rem;" id="blog-error-message">
                                    Unable to load blog posts. Please try again later.</p>
                                <button onclick="loadBlogPosts()"
                                    style="padding: 0.75rem 1.5rem; background: var(--button-bg); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                    Try Again
                                </button>
                            </div>
                        </div>

                        <!-- Reviews & Ratings Panel -->
                        <div id="reviews-ratings-panel" class="panel-content">
                            <div style="margin-bottom: 2rem;">
                                <h2
                                    style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--heading);">
                                    <span style="display: inline-flex; align-items: center; gap: 0.75rem;">
                                        <span>‚≠ê</span> Reviews & Ratings
                                    </span>
                                </h2>
                                <p style="color: var(--text-secondary);">See what tutors are saying about this parent
                                </p>
                            </div>

                            <!-- Rating Overview Card -->
                            <section id="reviews-overview-card"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 16px rgba(245,158,11,0.3); color: white;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 2rem;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <div
                                            style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; opacity: 0.95;">
                                            Overall Parent Rating</div>
                                        <div
                                            style="display: flex; align-items: baseline; gap: 0.75rem; margin-bottom: 0.75rem;">
                                            <div id="overall-rating-value" style="font-size: 3.5rem; font-weight: 700; line-height: 1;">0.0</div>
                                            <div style="font-size: 1.25rem; opacity: 0.9;">/ 5.0</div>
                                        </div>
                                        <div id="overall-rating-stars"
                                            style="color: rgba(255,255,255,0.95); font-size: 1rem; margin-bottom: 1rem;">
                                            ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ
                                        </div>
                                        <div id="total-reviews-text" style="font-size: 0.95rem; opacity: 0.9;">Based on 0 tutor reviews</div>
                                    </div>

                                    <div style="flex: 2; min-width: 300px;">
                                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                            <!-- Engagement with Tutor -->
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.875rem; width: 160px;">Engagement w/
                                                    Tutor</span>
                                                <div
                                                    style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                                    <div id="engagement-tutor-bar"
                                                        style="height: 100%; width: 0%; background: white; border-radius: 4px; transition: width 0.5s ease;">
                                                    </div>
                                                </div>
                                                <span id="engagement-tutor-value"
                                                    style="font-size: 0.875rem; width: 40px; text-align: right; font-weight: 600;">0.0</span>
                                            </div>
                                            <!-- Engagement with Student -->
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.875rem; width: 160px;">Engagement w/
                                                    Student</span>
                                                <div
                                                    style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                                    <div id="engagement-child-bar"
                                                        style="height: 100%; width: 0%; background: white; border-radius: 4px; transition: width 0.5s ease;">
                                                    </div>
                                                </div>
                                                <span id="engagement-child-value"
                                                    style="font-size: 0.875rem; width: 40px; text-align: right; font-weight: 600;">0.0</span>
                                            </div>
                                            <!-- Responsiveness -->
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.875rem; width: 160px;">Responsiveness</span>
                                                <div
                                                    style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                                    <div id="responsiveness-bar"
                                                        style="height: 100%; width: 0%; background: white; border-radius: 4px; transition: width 0.5s ease;">
                                                    </div>
                                                </div>
                                                <span id="responsiveness-value"
                                                    style="font-size: 0.875rem; width: 40px; text-align: right; font-weight: 600;">0.0</span>
                                            </div>
                                            <!-- Payment History -->
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.875rem; width: 160px;">Payment History</span>
                                                <div
                                                    style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                                    <div id="payment-bar"
                                                        style="height: 100%; width: 0%; background: white; border-radius: 4px; transition: width 0.5s ease;">
                                                    </div>
                                                </div>
                                                <span id="payment-value"
                                                    style="font-size: 0.875rem; width: 40px; text-align: right; font-weight: 600;">0.0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Filter & Sort Controls -->
                            <div
                                style="background: var(--card-bg); border-radius: 12px; padding: 1.25rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <button onclick="filterReviews('all')" class="filter-btn active"
                                            data-filter="all"
                                            style="padding: 0.5rem 1rem; border-radius: 8px; border: 2px solid var(--button-bg); background: var(--button-bg); color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s;">
                                            All (45)
                                        </button>
                                        <button onclick="filterReviews('5')" class="filter-btn" data-filter="5"
                                            style="padding: 0.5rem 1rem; border-radius: 8px; border: 2px solid rgba(var(--border-rgb), 0.3); background: transparent; color: var(--text); font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s;">
                                            5 Stars (37)
                                        </button>
                                        <button onclick="filterReviews('4')" class="filter-btn" data-filter="4"
                                            style="padding: 0.5rem 1rem; border-radius: 8px; border: 2px solid rgba(var(--border-rgb), 0.3); background: transparent; color: var(--text); font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s;">
                                            4 Stars (6)
                                        </button>
                                        <button onclick="filterReviews('3')" class="filter-btn" data-filter="3"
                                            style="padding: 0.5rem 1rem; border-radius: 8px; border: 2px solid rgba(var(--border-rgb), 0.3); background: transparent; color: var(--text); font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s;">
                                            3 Stars (2)
                                        </button>
                                    </div>
                                    <select onchange="sortReviews(this.value)"
                                        style="padding: 0.5rem 1rem; border-radius: 8px; border: 2px solid rgba(var(--border-rgb), 0.3); background: var(--card-bg); color: var(--text); font-size: 0.875rem; cursor: pointer;">
                                        <option value="recent">Most Recent</option>
                                        <option value="helpful">Most Helpful</option>
                                        <option value="highest">Highest Rating</option>
                                        <option value="lowest">Lowest Rating</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Reviews List - Dynamically populated from parent_reviews table -->
                            <div id="reviews-list" style="display: grid; gap: 1.5rem;">
                                <!-- Loading placeholder - will be replaced by view-parent-reviews.js -->
                                <div id="reviews-list-loading" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                                    <div style="width: 50px; height: 50px; border: 4px solid rgba(var(--button-bg-rgb), 0.2); border-top-color: var(--button-bg); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                                    <p>Loading reviews...</p>
                                </div>
                            </div>

                            <!-- Load More Button - Updated dynamically -->
                            <div id="load-more-container" style="text-align: center; margin-top: 2rem; display: none;">
                                <button onclick="loadMoreReviews()"
                                    style="padding: 0.875rem 2rem; border-radius: 12px; background: var(--button-bg); color: white; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(var(--button-bg-rgb), 0.3);">
                                    Load More Reviews
                                </button>
                                <p id="reviews-count-text" style="color: var(--text-muted); font-size: 0.875rem; margin-top: 1rem;">Showing 0 of 0 reviews</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar Widgets (Persistent across all panels) -->
                <div class="admin-right-widgets">

                    <!-- Dynamic Logo Ad Widget -->
                    <div class="admin-widget-card" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="widget-header" style="margin-bottom: 0.75rem; display: flex; justify-content: flex-end;">
                            <span style="font-size: 0.65rem; color: var(--text-secondary); background: var(--bg-secondary); padding: 0.2rem 0.5rem; border-radius: 4px;">Ad</span>
                        </div>
                        <!-- Dynamic ad container loaded by AdRotationManager -->
                        <div
                            data-placement="logo"
                            data-profile-type="parent"
                            class="leaderboard-banner premium-promo"
                            style="min-height: 170px; border-radius: 12px; overflow: hidden; position: relative; background: var(--bg-secondary);">
                            <!-- Ads will be dynamically loaded here -->
                        </div>
                    </div>

                    <!-- Payment Punctuality Widget -->
                    <div class="admin-widget-card"
                        style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;">
                        <h3 class="text-lg font-semibold mb-4" style="color: white;">üí≥ Payment Punctuality</h3>
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <div style="width: 120px; height: 120px; margin: 0 auto; position: relative;">
                                <svg viewBox="0 0 36 36" style="transform: rotate(-90deg);">
                                    <circle cx="18" cy="18" r="16" fill="none" stroke="rgba(255,255,255,0.2)"
                                        stroke-width="3"></circle>
                                    <circle id="widget-punctuality-circle" cx="18" cy="18" r="16" fill="none" stroke="white" stroke-width="3"
                                        stroke-dasharray="100.48" stroke-dashoffset="100.48" stroke-linecap="round"></circle>
                                </svg>
                                <div
                                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                    <div id="widget-punctuality-percent" style="font-size: 2rem; font-weight: 700;">0%</div>
                                    <div style="font-size: 0.75rem; opacity: 0.9;">On Time</div>
                                </div>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <span style="font-size: 0.875rem; opacity: 0.9;">Paid on Time</span>
                                <span id="widget-punctuality-ontime" style="font-weight: 600; font-size: 1rem;">0/0</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <span style="font-size: 0.875rem; opacity: 0.9;">Late Payments</span>
                                <span id="widget-punctuality-late" style="font-weight: 600; font-size: 1rem;">0</span>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; text-align: center;">
                            <div id="widget-punctuality-badge"
                                style="background: rgba(156, 163, 175, 0.2); padding: 0.5rem 1rem; border-radius: 12px; font-size: 0.875rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem;">
                                <span id="widget-punctuality-badge-icon">üÜï</span> <span id="widget-punctuality-badge-text">No Payment History</span>
                            </div>
                        </div>
                    </div>

                    <!-- Parent Overview Widget -->
                    <div class="admin-widget-card">
                        <h3 class="text-lg font-semibold mb-4">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Overview</h3>
                        <div class="stats-container"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                            <!-- Children Count paid on time 0/-->
                            <div
                                style="text-align: center; padding: 0.75rem; background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(37,99,235,0.05)); border-radius: 8px;">
                                <div id="widget-children-count" style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;">0</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Children</div>
                            </div>
                            <!-- Engagement Rate -->
                            <div
                                style="text-align: center; padding: 0.75rem; background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(22,163,74,0.05)); border-radius: 8px;">
                                <div id="widget-engagement-rate" style="font-size: 1.5rem; font-weight: 700; color: #22c55e;">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Engagement</div>
                            </div>
                            <!-- Parent Rating -->
                            <div
                                style="text-align: center; padding: 0.75rem; background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05)); border-radius: 8px; grid-column: span 2;">
                                <div id="widget-parent-rating" style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">0.0</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Tutor Rating</div>
                            </div>
                        </div>
                    </div>

                    <!-- Children Quick Stats Widget -->
                    <div class="admin-widget-card"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <h3 class="text-lg font-semibold mb-4" style="color: white;">üë• Children Overview</h3>
                        <div class="timeline-content" style="display: flex; flex-direction: column; gap: 1rem;">
                            <div class="timeline-item"
                                style="display: flex; gap: 0.75rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <div class="timeline-dot"
                                    style="width: 12px; height: 12px; background: white; border-radius: 50%; margin-top: 0.25rem; flex-shrink: 0; box-shadow: 0 0 10px rgba(255,255,255,0.5);">
                                </div>
                                <div style="flex: 1;">
                                    <p style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.95rem;">Abebe Alemu
                                    </p>
                                    <p style="font-size: 0.875rem; opacity: 0.9;">Grade 10 ‚Ä¢ GPA: 3.8</p>
                                </div>
                            </div>
                            <div class="timeline-item"
                                style="display: flex; gap: 0.75rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div class="timeline-dot"
                                    style="width: 12px; height: 12px; background: rgba(255,255,255,0.7); border-radius: 50%; margin-top: 0.25rem; flex-shrink: 0;">
                                </div>
                                <div style="flex: 1;">
                                    <p style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.95rem;">Sara Alemu
                                    </p>
                                    <p style="font-size: 0.875rem; opacity: 0.9;">Grade 8 ‚Ä¢ GPA: 3.9</p>
                                </div>
                            </div>
                            <div class="timeline-item" style="display: flex; gap: 0.75rem;">
                                <div class="timeline-dot"
                                    style="width: 12px; height: 12px; background: rgba(255,255,255,0.5); border-radius: 50%; margin-top: 0.25rem; flex-shrink: 0;">
                                </div>
                                <div style="flex: 1;">
                                    <p style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.95rem;">Merhawi
                                        Alemu</p>
                                    <p style="font-size: 0.875rem; opacity: 0.9;">Grade 5 ‚Ä¢ GPA: 3.7</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bottom Widgets Section -->
    <section class="bottom-widgets" style="margin-top: 3rem; margin-bottom: 3rem;">
        <div class="container mx-auto px-4">
            <div class="bottom-widgets-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;">

                <!-- News Widget -->
                <div style="padding: 1.5rem; background: var(--card-bg); border-radius: 16px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0;">üì∞ Latest News</h3>
                        <a href="#" style="color: var(--button-bg); text-decoration: none; font-size: 0.875rem;">View
                            All</a>
                    </div>

                    <div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span
                                style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">Education</span>
                            <span style="color: var(--text-muted); font-size: 0.875rem;">2h ago</span>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <img src="https://images.unsplash.com/photo-1427504494785-3a9ca7044f45?w=400" alt="News"
                                style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                        </div>
                        <h4
                            style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--heading);">
                            New Education Reforms Transform Ethiopian Schools</h4>
                        <p
                            style="color: var(--text); opacity: 0.8; font-size: 0.875rem; line-height: 1.6; margin-bottom: 1rem;">
                            Latest educational initiatives are revolutionizing how students learn across Ethiopia...</p>
                        <div style="display: flex; gap: 1rem;">
                            <span style="font-size: 0.875rem; color: var(--text-muted);">üî• Trending</span>
                            <span style="font-size: 0.875rem; color: var(--text-muted);">üëÅÔ∏è 1.2k views</span>
                        </div>
                    </div>
                </div>

                <!-- Bookstore Widget -->
                <div class="sidebar-widget bookstore-widget card" onclick="openComingSoonModal('store')"
                    style="cursor: pointer; padding: 1.5rem; background: var(--card-bg); border-radius: 16px; transition: transform 0.3s ease, box-shadow 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div class="widget-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0; color: var(--heading);">üìö Bookstore
                        </h3>
                        <span
                            style="background: var(--button-bg); color: white; padding: 0.5rem 0.75rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;">Coming
                            Soon</span>
                    </div>

                    <!-- Bookstore Content -->
                    <div class="bookstore-content">
                        <div class="bookstore-main" style="text-align: center; margin-bottom: 1.5rem;">
                            <div class="bookstore-icon" style="font-size: 4rem; margin-bottom: 0.5rem;">üìñ</div>
                            <div class="bookstore-title-animated"
                                style="position: relative; height: 2.5rem; overflow: hidden;">
                                <div class="bookstore-title"
                                    style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--heading); position: absolute; width: 100%; opacity: 1; transition: opacity 0.6s ease, transform 0.6s ease;">
                                    Educational Books</div>
                            </div>
                            <div class="bookstore-subtitle" style="font-size: 1rem; color: var(--text);">Buy, Sell &
                                Rent Textbooks</div>
                        </div>
                        <div class="bookstore-features"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üìó</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">New Books</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üìò</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Used Books</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üí∞</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Best
                                    Prices</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üöö</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Fast
                                    Delivery</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gamestore Widget -->
                <div class="sidebar-widget gamestore-widget card" onclick="openComingSoonModal('gamestore')"
                    style="cursor: pointer; padding: 1.5rem; background: var(--card-bg); border-radius: 16px; transition: transform 0.3s ease, box-shadow 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div class="widget-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0; color: var(--heading);">üéÆ Gamestore
                        </h3>
                        <span
                            style="background: var(--button-bg); color: white; padding: 0.5rem 0.75rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;">Coming
                            Soon</span>
                    </div>
                    <div class="gamestore-content">
                        <div class="gamestore-main" style="text-align: center; margin-bottom: 1.5rem;">
                            <div class="gamestore-icon" style="font-size: 4rem; margin-bottom: 0.5rem;">üéÆ</div>
                            <div class="gamestore-title-animated"
                                style="position: relative; height: 2.5rem; overflow: hidden;">
                                <div class="gamestore-title"
                                    style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--heading); position: absolute; width: 100%; opacity: 1; transition: opacity 0.6s ease, transform 0.6s ease;">
                                    Educational Games</div>
                            </div>
                            <div class="gamestore-subtitle" style="font-size: 1rem; color: var(--text);">Learn While
                                Playing</div>
                        </div>
                        <div class="gamestore-features"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üßÆ</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Puzzle
                                    Games</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üéØ</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Strategy
                                    Games</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üèÜ</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Top Rated</span>
                            </div>
                            <div class="feature-item"
                                style="background: var(--highlight-bg); padding: 0.75rem; border-radius: 8px; text-align: center;">
                                <span style="display: block; font-size: 1.5rem; margin-bottom: 0.25rem;">üéÅ</span>
                                <span style="display: block; font-size: 0.875rem; color: var(--text);">Free to
                                    Play</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="../js/root/app.js"></script>
    <script src="../js/root/auth.js?v=20251217"></script>
    <script src="../js/root/nav.js"></script>

    <!-- Share Profile Manager (Must load early for onclick handlers) -->
    <script src="../js/common-modals/share-profile-manager.js?v=20260204k"></script>

    <script src="../js/root/profile-system.js"></script>
    <script src="../js/root/theme.js"></script>
    <!-- Common Modal Loader for add-role, logout, coming-soon modals -->
    <script src="../modals/common-modals/common-modal-loader.js?v=20260204g"></script>
    <script src="../js/common-modals/coming-soon-modal.js"></script>
    <script src="../js/common-modals/ad-modal.js"></script>
    <script src="../js/common-modals/ad-rotation-manager.js"></script>
    <script src="../js/common-modals/logout-modal.js"></script>
    <!-- Deletion Countdown Banner - Shows role deletion warning in profile dropdown -->
    <script src="../js/common-modals/deletion-countdown-banner.js"></script>
    <!-- View Parent Profile Loaders -->
    <script src="../js/view-parent/view-parent-reviews.js"></script>
    <script src="../js/view-parent/view-parent-children.js"></script>
    <script src="../js/view-parent/view-parent-widgets.js"></script>
    <script src="../js/view-parent/view-parent-loader.js"></script>

    <script>
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize core app
            initializeApp();

            // Initialize authentication
            const authManager = new AuthenticationManager();
            await authManager.initialize();

            // Note: Parent data is now loaded by view-parent-loader.js
            // which reads parent_profile_id from URL parameter

            // Initialize animations
            animateStats();

            // Initialize sidebar
            initializeSidebar();

            // Mobile menu is handled by nav.js, just update mobile profile section on load
            // Update mobile profile section on page load
            updateMobileProfileSection();
        });

        // Also update on window load to ensure everything is ready
        window.addEventListener('load', () => {
            updateMobileProfileSection();
        });

        // ============================================
        // NOTE: Parent data loading is now handled by view-parent-loader.js
        // The external loader reads parent_profile_id from URL (?id=X)
        // and populates all profile sections dynamically from the database.
        // It also loads reviews via view-parent-reviews.js
        // ============================================

        // Generate star rating HTML (kept for backward compatibility)
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

            let starsHTML = '';
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '‚òÖ';
            }
            if (hasHalfStar) {
                starsHTML += '‚Ø®';
            }
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '‚òÜ';
            }
            return starsHTML;
        }

        // Show error message to user
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(239,68,68,0.3); z-index: 9999; font-weight: 600;';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Panel switching
        function switchPanel(event, panelName) {
            if (event) event.preventDefault();
            console.log('Switching to panel:', panelName);

            // Hide all panels
            const allPanels = document.querySelectorAll('.panel-content');
            allPanels.forEach(panel => {
                panel.classList.remove('active');
            });

            // Show selected panel
            const selectedPanel = document.getElementById(panelName + '-panel');
            if (selectedPanel) {
                selectedPanel.classList.add('active');
            }

            // Update sidebar active link
            const allLinks = document.querySelectorAll('.sidebar-link');
            allLinks.forEach(link => {
                link.classList.remove('active');
            });

            const clickedLink = event ? event.currentTarget : document.querySelector(`.sidebar-link[data-panel="${panelName}"]`);
            if (clickedLink) {
                clickedLink.classList.add('active');
            }

            // Load blog posts when switching to blog panel
            if (panelName === 'blog') {
                const grid = document.getElementById('blog-posts-grid');
                // Only load if not already loaded (check if there are no child elements, ignoring comments)
                if (grid && grid.children.length === 0) {
                    console.log('Blog panel activated - loading blog posts...');
                    loadBlogPosts();
                } else {
                    console.log('Blog posts already loaded, skipping...');
                }
            }

            // Close sidebar on mobile after selection
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const hamburger = document.querySelector('.hamburger');

            if (sidebar && overlay) {
                const isOpen = sidebar.style.left === '0px';

                if (isOpen) {
                    sidebar.style.left = '-280px';
                    overlay.style.display = 'none';
                    if (hamburger) hamburger.classList.remove('active');
                } else {
                    sidebar.style.left = '0px';
                    overlay.style.display = 'block';
                    if (hamburger) hamburger.classList.add('active');
                }
            }
        }

        // Sidebar initialization
        function initializeSidebar() {
            // Sidebar is already initialized with inline styles and onclick handlers
            console.log('Sidebar initialized');

            // Close sidebar with ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar && sidebar.style.left === '0px') {
                        toggleSidebar();
                    }
                }
            });
        }

        // Handle nav clicks
        function handleNavLinkClick(event, section) {
            event.preventDefault();
            console.log('Navigation to:', section);
        }

        // Mobile Menu Functions
        function openMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');

            if (!mobileMenu) return;

            mobileMenu.classList.remove('hidden');
            if (mobileMenuBtn) mobileMenuBtn.classList.add('active');
            if (mobileMenuOverlay) mobileMenuOverlay.classList.remove('hidden');

            // Prevent body scroll
            document.body.style.overflow = 'hidden';

            // Update mobile profile section visibility
            updateMobileProfileSection();
        }

        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');

            if (!mobileMenu) return;

            mobileMenu.classList.add('hidden');
            if (mobileMenuBtn) mobileMenuBtn.classList.remove('active');
            if (mobileMenuOverlay) mobileMenuOverlay.classList.add('hidden');

            // Restore body scroll
            document.body.style.overflow = '';

            // Close mobile profile dropdown if open
            const dropdown = document.querySelector('.mobile-profile-dropdown');
            const header = document.getElementById('mobile-profile-header');
            if (dropdown) dropdown.classList.remove('open');
            if (header) header.classList.remove('expanded');
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const isOpen = !mobileMenu?.classList.contains('hidden');

            if (isOpen) {
                if (typeof closeMobileMenu === 'function') {
                    closeMobileMenu();
                }
            } else {
                openMobileMenu();
            }
        }

        function toggleMobileProfileDropdown() {
            const dropdown = document.querySelector('.mobile-profile-dropdown');
            const header = document.getElementById('mobile-profile-header');

            if (dropdown) {
                dropdown.classList.toggle('open');
            }
            if (header) {
                header.classList.toggle('expanded');
            }
        }

        function updateMobileProfileSection() {
            const mobileProfileSection = document.querySelector('.mobile-profile-section');

            const token = localStorage.getItem('access_token') || localStorage.getItem('token');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');

            if (token && currentUser) {
                // User is logged in
                if (mobileProfileSection) {
                    mobileProfileSection.classList.remove('hidden');

                    // Update profile info
                    const profilePic = document.getElementById('mobile-profile-pic');
                    const profileName = document.getElementById('mobile-profile-name');
                    const profileRole = document.getElementById('mobile-profile-role');
                    const profileLink = document.getElementById('mobile-my-profile-link');

                    const avatarUrl = currentUser.profile_picture || currentUser.profile_picture_url ||
                                    currentUser.profilePicture || '../images/default-avatar.png';
                    const name = currentUser.name || currentUser.full_name || 'User';
                    const role = localStorage.getItem('userRole') || localStorage.getItem('active_role') ||
                               currentUser.active_role || currentUser.role || 'student';

                    // Update mobile header profile info
                    if (profilePic) profilePic.src = avatarUrl;
                    if (profileName) profileName.textContent = name;
                    if (profileRole) {
                        const formattedRole = role.charAt(0).toUpperCase() + role.slice(1);
                        profileRole.textContent = formattedRole;
                    }

                    // Update dropdown profile info
                    const dropdownProfilePic = document.getElementById('mobile-dropdown-profile-pic');
                    const dropdownProfileName = document.getElementById('mobile-dropdown-profile-name');
                    const dropdownProfileRole = document.getElementById('mobile-dropdown-profile-role');

                    console.log('[MobileMenu] Updating dropdown profile:', {
                        pic: !!dropdownProfilePic,
                        name: !!dropdownProfileName,
                        role: !!dropdownProfileRole,
                        avatarUrl,
                        userName: name,
                        userRole: role
                    });

                    if (dropdownProfilePic) dropdownProfilePic.src = avatarUrl;
                    if (dropdownProfileName) dropdownProfileName.textContent = name;
                    if (dropdownProfileRole) {
                        const formattedRole = role.charAt(0).toUpperCase() + role.slice(1);
                        dropdownProfileRole.textContent = formattedRole;
                    }

                    // Set profile link based on role
                    if (profileLink) {
                        const profilePages = {
                            'tutor': '../profile-pages/tutor-profile.html',
                            'student': '../profile-pages/student-profile.html',
                            'parent': '../profile-pages/parent-profile.html',
                            'advertiser': '../profile-pages/advertiser-profile.html'
                        };
                        profileLink.href = profilePages[role] || '../profile-pages/user-profile.html';
                    }

                    // Update role switcher if user has multiple roles
                    updateMobileRoleSwitcher();
                }
            } else {
                // User is logged out
                if (mobileProfileSection) mobileProfileSection.classList.add('hidden');
            }
        }

        function updateMobileRoleSwitcher() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                console.log('[MobileMenu] No currentUser found in localStorage');
                return;
            }

            const roles = currentUser.roles || [];
            const activeRole = localStorage.getItem('userRole') || localStorage.getItem('active_role') ||
                              currentUser.active_role || currentUser.role;

            console.log('[MobileMenu] User roles:', roles);
            console.log('[MobileMenu] Active role:', activeRole);

            // If user has multiple roles, show role switcher
            const roleSwitcherSection = document.getElementById('mobile-role-switcher');
            if (roles.length > 1 && roleSwitcherSection) {
                roleSwitcherSection.classList.remove('hidden');

                const roleOptionsContainer = document.getElementById('mobile-role-options');
                if (roleOptionsContainer) {
                    roleOptionsContainer.innerHTML = '';
                    console.log('[MobileMenu] Populating role switcher with', roles.length, 'roles');

                    // Role icon mapping
                    const roleIcons = {
                        'student': 'üéì',
                        'tutor': 'üë®‚Äçüè´',
                        'parent': 'üë™',
                        'advertiser': 'üì¢'
                    };

                    roles.forEach(role => {
                        if (role !== activeRole) {
                            const roleButton = document.createElement('button');
                            roleButton.className = 'mobile-dropdown-item';
                            const roleIcon = roleIcons[role.toLowerCase()] || 'üë§';
                            const roleName = role.charAt(0).toUpperCase() + role.slice(1);

                            roleButton.innerHTML = `
                                <span class="mobile-role-icon">${roleIcon}</span>
                                Switch to ${roleName}
                            `;
                            roleButton.onclick = () => switchRole(role);
                            roleOptionsContainer.appendChild(roleButton);
                        }
                    });
                }
            } else if (roleSwitcherSection) {
                roleSwitcherSection.classList.add('hidden');
            }
        }

        async function switchRole(newRole) {
            try {
                const token = localStorage.getItem('access_token') || localStorage.getItem('token');
                if (!token) return;

                const response = await fetch(`${window.API_BASE_URL || 'http://localhost:8000'}/api/switch-role`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: newRole })
                });

                if (response.ok) {
                    localStorage.setItem('userRole', newRole);
                    localStorage.setItem('active_role', newRole);

                    // Update mobile profile section
                    updateMobileProfileSection();

                    // Redirect to appropriate profile page
                    const profilePages = {
                        'tutor': '../profile-pages/tutor-profile.html',
                        'student': '../profile-pages/student-profile.html',
                        'parent': '../profile-pages/parent-profile.html',
                        'advertiser': '../profile-pages/advertiser-profile.html'
                    };

                    const profilePage = profilePages[newRole] || '../profile-pages/user-profile.html';
                    window.location.href = profilePage;
                }
            } catch (error) {
                console.error('Error switching role:', error);
            }
        }

        // Make functions globally available
        window.openMobileMenu = openMobileMenu;
        window.toggleMobileMenu = toggleMobileMenu;
        window.toggleMobileProfileDropdown = toggleMobileProfileDropdown;
        window.updateMobileProfileSection = updateMobileProfileSection;
        window.switchRole = switchRole;

        // Modal functions
        function openConnectModal() {
            console.log('Opening connect modal');
            alert('Connect modal - Feature coming soon!');
        }

        function openMessageModal() {
            // Check if user is authenticated
            const token = localStorage.getItem('access_token') || localStorage.getItem('token');
            if (!token) {
                if (window.openAuthModal) {
                    window.openAuthModal('login');
                } else {
                    alert('Please log in to message this parent');
                }
                return;
            }

            // Get parent data from the global variable set by view-parent-loader.js
            const parentData = window.currentParentData;
            if (!parentData) {
                console.error('Parent data not loaded yet');
                alert('Please wait for the profile to load');
                return;
            }

            console.log('Opening chat with parent:', parentData);

            // Build target user object for chat modal
            const targetUser = {
                id: parentData.user_id,
                user_id: parentData.user_id,
                profile_id: parentData.id,
                full_name: parentData.full_name || `${parentData.first_name || ''} ${parentData.father_name || ''}`.trim(),
                name: parentData.full_name || `${parentData.first_name || ''} ${parentData.father_name || ''}`.trim(),
                profile_picture: parentData.profile_picture,
                avatar: parentData.profile_picture,
                role: 'parent',
                profile_type: 'parent',
                is_online: parentData.is_online || false
            };

            console.log('Target user for chat:', targetUser);

            // Open chat modal with the parent
            if (typeof ChatModalManager !== 'undefined' && typeof ChatModalManager.open === 'function') {
                ChatModalManager.open(targetUser);
                console.log('Chat modal opened for parent:', targetUser.full_name);
            } else {
                console.error('ChatModalManager not available');
                alert('Chat feature is not available. Please refresh the page.');
            }
        }

        function openAdAnalyticsModal() {
            console.log('Opening ad analytics');
        }

        function viewChildProfile(childId) {
            console.log('Viewing child profile:', childId);
            // Navigate to child's profile page
            window.location.href = `view-student.html?id=${childId}`;
        }

        // messageChild function is defined in view-parent-children.js
        // It opens the chat modal with the child's data

        function viewAllReviews() {
            console.log('Switching to reviews panel');
            switchPanel(null, 'reviews-ratings');
        }

        // Filter reviews by rating
        function filterReviews(rating) {
            console.log('Filtering reviews by rating:', rating);

            // Update active filter button
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text)';
                btn.style.border = '2px solid rgba(var(--border-rgb), 0.3)';
            });

            const activeBtn = document.querySelector(`.filter-btn[data-filter="${rating}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.background = 'var(--button-bg)';
                activeBtn.style.color = 'white';
                activeBtn.style.border = '2px solid var(--button-bg)';
            }

            // Show/hide review cards
            const reviewCards = document.querySelectorAll('.review-card');
            reviewCards.forEach(card => {
                if (rating === 'all') {
                    card.style.display = 'block';
                } else {
                    const cardRating = card.getAttribute('data-rating');
                    if (cardRating === rating) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // Sort reviews
        function sortReviews(sortBy) {
            console.log('Sorting reviews by:', sortBy);

            const reviewsList = document.getElementById('reviews-list');
            const reviews = Array.from(reviewsList.querySelectorAll('.review-card'));

            reviews.sort((a, b) => {
                switch (sortBy) {
                    case 'recent':
                        // Already in recent order - no change needed
                        return 0;
                    case 'helpful':
                        const helpfulA = parseInt(a.querySelector('button[onclick*="markHelpful"]').textContent.match(/\d+/)[0]);
                        const helpfulB = parseInt(b.querySelector('button[onclick*="markHelpful"]').textContent.match(/\d+/)[0]);
                        return helpfulB - helpfulA;
                    case 'highest':
                        return parseInt(b.getAttribute('data-rating')) - parseInt(a.getAttribute('data-rating'));
                    case 'lowest':
                        return parseInt(a.getAttribute('data-rating')) - parseInt(b.getAttribute('data-rating'));
                    default:
                        return 0;
                }
            });

            // Re-append sorted reviews
            reviews.forEach(review => reviewsList.appendChild(review));
        }

        // Mark review as helpful
        function markHelpful(button) {
            console.log('Marking review as helpful');

            // Extract current count
            const currentText = button.textContent;
            const currentCount = parseInt(currentText.match(/\d+/)[0]);
            const newCount = currentCount + 1;

            // Update button text
            button.innerHTML = `<span>üëç</span> Helpful (${newCount})`;

            // Visual feedback
            button.style.background = 'rgba(var(--button-bg-rgb), 0.1)';
            button.style.borderColor = 'var(--button-bg)';
            button.style.color = 'var(--button-bg)';
            button.style.fontWeight = '600';

            // Disable button to prevent multiple clicks
            button.disabled = true;
            button.style.cursor = 'not-allowed';
            button.style.opacity = '0.7';

            // Show confirmation
            const reviewCard = button.closest('.review-card');
            const feedback = document.createElement('div');
            feedback.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: 0 4px 12px rgba(16,185,129,0.3); z-index: 100; animation: fadeInOut 2s ease-in-out;';
            feedback.textContent = '‚úì Marked as helpful!';
            reviewCard.style.position = 'relative';
            reviewCard.appendChild(feedback);

            setTimeout(() => {
                feedback.remove();
            }, 2000);
        }

        // Report review
        function reportReview(button) {
            console.log('Reporting review');

            const confirmed = confirm('Are you sure you want to report this review?\n\nReported reviews will be reviewed by our moderation team.');

            if (confirmed) {
                // Visual feedback
                button.style.background = 'rgba(239, 68, 68, 0.1)';
                button.style.borderColor = '#ef4444';
                button.style.color = '#ef4444';
                button.style.fontWeight = '600';

                // Disable button
                button.disabled = true;
                button.innerHTML = '<span>‚úì</span> Reported';
                button.style.cursor = 'not-allowed';

                // Show confirmation
                const reviewCard = button.closest('.review-card');
                const feedback = document.createElement('div');
                feedback.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: 0 4px 12px rgba(239,68,68,0.3); z-index: 100;';
                feedback.textContent = '‚úì Review reported to moderators';
                reviewCard.style.position = 'relative';
                reviewCard.appendChild(feedback);

                setTimeout(() => {
                    feedback.remove();
                }, 3000);
            }
        }

        // Load more reviews
        function loadMoreReviews() {
            console.log('Loading more reviews...');

            // Show loading state on button
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Loading...';
            button.disabled = true;
            button.style.opacity = '0.6';

            // Simulate loading (in real app, this would be an API call)
            setTimeout(() => {
                // Show message
                alert('More reviews loaded! (Feature demo - in production, this would load actual reviews from the database)');

                // Reset button
                button.textContent = originalText;
                button.disabled = false;
                button.style.opacity = '1';
            }, 1000);
        }

        // Rate & Review functionality
        let selectedRating = 0;

        function selectRating(rating) {
            selectedRating = rating;
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.style.filter = 'brightness(1.2) drop-shadow(0 0 8px rgba(245,158,11,0.6))';
                    star.style.transform = 'scale(1.2)';
                } else {
                    star.style.filter = 'brightness(0.7)';
                    star.style.transform = 'scale(1)';
                }
            });
        }

        function submitReview() {
            const reviewText = document.getElementById('review-text').value;

            if (selectedRating === 0) {
                alert('Please select a rating before submitting your review.');
                return;
            }

            if (!reviewText.trim()) {
                alert('Please write a review before submitting.');
                return;
            }

            console.log('Submitting review:', {
                rating: selectedRating,
                review: reviewText,
                parentId: new URLSearchParams(window.location.search).get('id')
            });

            // TODO: Send to API
            alert(`Thank you for your ${selectedRating}-star review!\n\nYour feedback helps improve the community.`);

            // Reset form
            selectedRating = 0;
            document.getElementById('review-text').value = '';
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.style.filter = 'brightness(1)';
                star.style.transform = 'scale(1)';
            });
        }

        // Animate statistics
        function animateStats() {
            const statNumbers = document.querySelectorAll('.stat-number');

            statNumbers.forEach(stat => {
                const target = parseFloat(stat.getAttribute('data-target'));
                const suffix = stat.getAttribute('data-suffix') || '';

                let current = 0;
                const increment = target / 50;

                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    stat.textContent = Math.floor(current) + suffix;
                }, 30);
            });
        }

        // Theme toggle
        document.getElementById('theme-toggle-btn')?.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // ============================================
        // BLOG POSTS FUNCTIONALITY
        // ============================================

        // Load blog posts for the parent
        async function loadBlogPosts() {
            console.log('=== loadBlogPosts() called ===');
            const parentId = new URLSearchParams(window.location.search).get('id');
            console.log('Parent ID from URL:', parentId);

            if (!parentId) {
                console.warn('No parent ID provided for blog posts');
                // Show empty state if no parent ID
                document.getElementById('blog-loading').style.display = 'none';
                document.getElementById('blog-posts-grid').style.display = 'none';
                document.getElementById('blog-empty-state').style.display = 'block';
                document.getElementById('blog-error-state').style.display = 'none';
                return;
            }

            // Show loading state
            console.log('Showing loading state...');
            document.getElementById('blog-loading').style.display = 'block';
            document.getElementById('blog-posts-grid').style.display = 'none';
            document.getElementById('blog-empty-state').style.display = 'none';
            document.getElementById('blog-error-state').style.display = 'none';

            try {
                // Fetch blog posts from API - uses profile_id and role='parent'
                const baseUrl = window.API_BASE_URL || 'http://localhost:8000';
                const apiUrl = `${baseUrl}/api/blogs/by-profile/${parentId}?role=parent`;
                console.log('Fetching from:', apiUrl);
                const response = await fetch(apiUrl);
                console.log('Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`Failed to fetch blog posts: ${response.status}`);
                }

                const data = await response.json();
                console.log('Blog posts data received:', data);
                console.log('Number of posts:', data.posts ? data.posts.length : 0);

                // Hide loading state
                document.getElementById('blog-loading').style.display = 'none';

                // Check if there are any posts
                if (!data.posts || data.posts.length === 0) {
                    console.log('No posts found - showing empty state');
                    // Show empty state
                    document.getElementById('blog-empty-state').style.display = 'block';
                } else {
                    console.log('Posts found - displaying blog cards');
                    // Display blog posts
                    displayBlogPosts(data.posts);
                    document.getElementById('blog-posts-grid').style.display = 'grid';
                }

            } catch (error) {
                console.error('Error loading blog posts:', error);

                // Hide loading state
                document.getElementById('blog-loading').style.display = 'none';

                // Show error state
                document.getElementById('blog-error-state').style.display = 'block';
                document.getElementById('blog-error-message').textContent =
                    error.message || 'Unable to load blog posts. Please try again later.';
            }
        }

        // Display blog posts in the grid
        function displayBlogPosts(posts) {
            const grid = document.getElementById('blog-posts-grid');
            grid.innerHTML = ''; // Clear existing content

            posts.forEach(post => {
                const blogCard = createBlogCard(post);
                grid.appendChild(blogCard);
            });
        }

        // Create a blog card element
        function createBlogCard(post) {
            const card = document.createElement('div');
            card.className = 'blog-card';
            card.style.cssText = `
                background: var(--card-bg);
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                cursor: pointer;
                display: flex;
                flex-direction: column;
            `;

            // Format date
            const publishedDate = post.published_at
                ? new Date(post.published_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                })
                : new Date(post.created_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

            // Truncate description
            const maxDescriptionLength = 120;
            const description = post.description && post.description.length > maxDescriptionLength
                ? post.description.substring(0, maxDescriptionLength) + '...'
                : post.description || 'No description available';

            // Blog picture with fallback (database column is blog_picture)
            const blogPictureUrl = post.blog_picture || 'https://via.placeholder.com/400x200?text=Blog+Post';

            // Reading time
            const readingTime = post.reading_time || 5;

            card.innerHTML = `
                <!-- Blog Picture -->
                <div style="width: 100%; height: 200px; overflow: hidden; background: var(--bg-secondary);">
                    <img
                        src="${blogPictureUrl}"
                        alt="${post.title}"
                        style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;"
                        onerror="this.src='https://via.placeholder.com/400x200?text=Blog+Post'"
                    >
                </div>

                <!-- Content -->
                <div style="padding: 1.5rem; flex: 1; display: flex; flex-direction: column;">
                    <!-- Category Badge -->
                    ${post.category ? `
                        <div style="margin-bottom: 0.75rem;">
                            <span style="display: inline-block; padding: 0.25rem 0.75rem; background: var(--accent-color); color: white; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">
                                ${post.category}
                            </span>
                        </div>
                    ` : ''}

                    <!-- Title -->
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--heading); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        ${post.title}
                    </h3>

                    <!-- Description -->
                    <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 1rem; flex: 1; line-height: 1.6;">
                        ${description}
                    </p>

                    <!-- Footer -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <!-- Date -->
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                            <span>üìÖ</span>
                            <span>${publishedDate}</span>
                        </div>

                        <!-- Stats -->
                        <div style="display: flex; gap: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                            <span style="display: flex; align-items: center; gap: 0.25rem;">
                                <span>‚è±Ô∏è</span>
                                <span>${readingTime} min</span>
                            </span>
                            <span style="display: flex; align-items: center; gap: 0.25rem;">
                                <span>‚ù§Ô∏è</span>
                                <span>${post.likes || 0}</span>
                            </span>
                            <span style="display: flex; align-items: center; gap: 0.25rem;">
                                <span>üí¨</span>
                                <span>${Array.isArray(post.comments) ? post.comments.length : 0}</span>
                            </span>
                        </div>
                    </div>
                </div>
            `;

            // Add hover effect
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-8px)';
                card.style.boxShadow = '0 8px 24px rgba(0, 0, 0, 0.15)';
                const img = card.querySelector('img');
                if (img) img.style.transform = 'scale(1.1)';
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
                const img = card.querySelector('img');
                if (img) img.style.transform = 'scale(1)';
            });

            // Add click handler to view blog post
            card.addEventListener('click', () => {
                viewBlogPost(post.id);
            });

            return card;
        }

        // View blog post (placeholder - implement based on your blog viewing page)
        function viewBlogPost(postId) {
            console.log('Viewing blog post:', postId);
            // TODO: Implement navigation to blog post detail page
            // Example: window.location.href = `/blog/post?id=${postId}`;
            alert(`Blog post viewing functionality coming soon! Post ID: ${postId}`);
        }
    </script>

    <!-- Widget Animations Script -->
    <script>
        // ============================================
        //   BOOKSTORE WIDGET - FADE IN/OUT ANIMATION
        // ============================================
        (function () {
            const bookstoreTitles = [
                { icon: 'üìñ', text: 'Educational Books', emoji: 'üìö' },
                { icon: 'üìö', text: 'Fiction & Novels', emoji: 'üìñ' },
                { icon: 'üî¨', text: 'Science Textbooks', emoji: 'üß™' },
                { icon: 'üìê', text: 'Mathematics Books', emoji: '‚ûó' },
                { icon: 'üî•', text: 'Trending Books', emoji: 'üî•' },
                { icon: 'üí∞', text: 'Special Discounts', emoji: 'üè∑Ô∏è' },
                { icon: 'üéÅ', text: 'Bundle Deals', emoji: 'üì¶' },
                { icon: '‚ú®', text: 'Coming Soon!', emoji: 'üéâ' }
            ];

            let currentBookIndex = 0;
            const bookstoreTitleContainer = document.querySelector('.bookstore-title-animated');
            const bookstoreIcon = document.querySelector('.bookstore-icon');

            if (bookstoreTitleContainer && bookstoreIcon) {
                const titleElement = bookstoreTitleContainer.querySelector('.bookstore-title');

                function animateBookstoreTitle() {
                    // Fade out
                    titleElement.style.opacity = '0';
                    titleElement.style.transform = 'translateY(-10px)';

                    setTimeout(() => {
                        // Update content
                        currentBookIndex = (currentBookIndex + 1) % bookstoreTitles.length;
                        const currentTitle = bookstoreTitles[currentBookIndex];
                        titleElement.textContent = currentTitle.text;
                        bookstoreIcon.textContent = currentTitle.icon;

                        // Fade in
                        titleElement.style.transform = 'translateY(10px)';
                        setTimeout(() => {
                            titleElement.style.opacity = '1';
                            titleElement.style.transform = 'translateY(0)';
                        }, 50);
                    }, 600);
                }

                // Start animation every 3 seconds
                setInterval(animateBookstoreTitle, 3000);
            }
        })();

        // ============================================
        //   GAMESTORE WIDGET - FADE IN/OUT ANIMATION
        // ============================================
        (function () {
            const gamestoreTitles = [
                { icon: 'üéÆ', text: 'Educational Games', emoji: 'üéÆ' },
                { icon: 'üßÆ', text: 'Puzzle Games', emoji: 'üß©' },
                { icon: 'üéØ', text: 'Strategy Games', emoji: '‚ôüÔ∏è' },
                { icon: 'üèÜ', text: 'Top Rated Games', emoji: '‚≠ê' },
                { icon: 'üî•', text: 'Trending Games', emoji: 'üî•' },
                { icon: 'üí∞', text: 'Special Discounts', emoji: 'üè∑Ô∏è' },
                { icon: 'üéÅ', text: 'Bundle Deals', emoji: 'üì¶' },
                { icon: '‚ú®', text: 'Coming Soon!', emoji: 'üéâ' }
            ];

            let currentGameIndex = 0;
            const gamestoreTitleContainer = document.querySelector('.gamestore-title-animated');
            const gamestoreIcon = document.querySelector('.gamestore-icon');

            if (gamestoreTitleContainer && gamestoreIcon) {
                const titleElement = gamestoreTitleContainer.querySelector('.gamestore-title');

                function animateGamestoreTitle() {
                    // Fade out
                    titleElement.style.opacity = '0';
                    titleElement.style.transform = 'translateY(-10px)';

                    setTimeout(() => {
                        // Update content
                        currentGameIndex = (currentGameIndex + 1) % gamestoreTitles.length;
                        const currentTitle = gamestoreTitles[currentGameIndex];
                        titleElement.textContent = currentTitle.text;
                        gamestoreIcon.textContent = currentTitle.icon;

                        // Fade in
                        titleElement.style.transform = 'translateY(10px)';
                        setTimeout(() => {
                            titleElement.style.opacity = '1';
                            titleElement.style.transform = 'translateY(0)';
                        }, 50);
                    }, 600);
                }

                // Start animation every 3 seconds
                setInterval(animateGamestoreTitle, 3000);
            }
        })();
    </script>

    <!-- Reviewer Names Clickable Handler - For dynamically loaded reviews -->
    <script>
        // This function will be called after reviews are loaded dynamically
        // The review cards now include reviewer_id from the API, so links are generated in JS
        window.makeReviewerNamesClickable = function() {
            // Find all reviewer names in review cards and add hover effects
            document.querySelectorAll('.review-card h4 a').forEach(link => {
                link.addEventListener('mouseover', () => {
                    link.style.color = '#3b82f6';
                });
                link.addEventListener('mouseout', () => {
                    link.style.color = 'var(--heading)';
                });
            });

            // Add hover effects to avatars
            document.querySelectorAll('.review-card img').forEach(avatarImg => {
                avatarImg.style.cursor = 'pointer';
                avatarImg.style.transition = 'all 0.3s';
                avatarImg.addEventListener('mouseover', () => {
                    avatarImg.style.boxShadow = '0 0 0 4px rgba(59,130,246,0.3)';
                });
                avatarImg.addEventListener('mouseout', () => {
                    avatarImg.style.boxShadow = 'none';
                });
            });
        };

        // Call on page load and after dynamic content loads
        window.addEventListener('parentDataLoaded', () => {
            setTimeout(makeReviewerNamesClickable, 500);
        });
    </script>

    <!-- Chat Modal Container -->
    <div id="chat-modal-container"></div>

    <!-- Chat Modal Script -->
    <script src="../js/common-modals/chat-modal.js"></script>
    <!-- Standalone Chat Call Modal JavaScript -->
    <script src="../js/common-modals/chat-call-modal.js"></script>
    <script src="../js/common-modals/view-request-modal.js"></script>

    <!-- Load Chat Modal HTML and Initialize -->
    <script>
        // Load chat modal HTML dynamically
        (function loadChatModal() {
            fetch('../modals/common-modals/chat-modal.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('chat-modal-container').innerHTML = html;
                    // Re-initialize chat modal after HTML is loaded
                    if (typeof ChatModalManager !== 'undefined') {
                        ChatModalManager.init();
                    }
                })
                .catch(err => console.log('Chat modal will load on demand:', err.message));
        })();

        // Load standalone chat call modal HTML dynamically
        (function loadChatCallModal() {
            fetch('../modals/common-modals/chat-call-modal.html')
                .then(response => response.text())
                .then(html => {
                    document.body.insertAdjacentHTML('beforeend', html);
                    console.log('‚úÖ Standalone Chat Call Modal loaded for view-parent');
                })
                .catch(err => console.error('Failed to load chat-call-modal:', err));
        })();
    </script>

    <!-- Ad Rotation Manager -->
    <script src="../js/common-modals/ad-rotation-manager.js"></script>
    <!-- Appearance Manager - Theme & Color Palette Sync -->
    <script src="../js/common-modals/appearance-manager.js?v=20260127"></script>

    <!-- Currency Utilities for dynamic currency display -->
    <script src="../js/utils/currency-utils.js"></script>

    <!-- Share Profile Function -->
    <script>
        // shareProfile() is now handled by share-profile-manager.js
    </script>

    <!-- Share Profile Manager - MOVED EARLIER (after nav.js) to ensure onclick handlers work -->
</body>

</html>
