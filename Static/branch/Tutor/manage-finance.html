<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Profile - Payments and Billing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --button-hover: #f3f4f6;
            --heading: #1f2937;
            --text: #4b5563;
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 28rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-content h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
        }
        .modal-content input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .modal-content textarea, .modal-content input[type="password"], .modal-content input[type="text"], .modal-content input[type="tel"], .modal-content input[type="email"], .modal-content input[type="file"], .modal-content select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
        .modal-content button {
            margin-right: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .cta-button {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .cta-button:hover {
            background-color: #1d4ed8;
        }
        .school-suggestions {
            position: absolute;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
            z-index: 10;
        }
    </style>
</head>

            <button id="manage-finance-btn"
              class="block w-full text-left px-4 py-2 text-[var(--text)] hover:bg-[var(--button-hover)]">Manage
              Finances</button>

    <!-- Manage Finances Modal -->
    <div id="manageFinanceModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto flex">
            <!-- Vertical Tabs -->
            <div class="w-1/4 border-r pr-4">
                <nav class="space-y-2">
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="payment-details">Payment Details</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="verification">Verification</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="subscription">Subscription</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="set-package">Set Package</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="view-package">View Package</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="income">Income</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="bills">Bills</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="analytics">Analytics</button>
                    <button class="tab-btn block w-full text-left px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-100 rounded-md" data-tab="leave-astegni">Leave Astegni</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="w-3/4 pl-6">
                <!-- Payment Details -->
                <div id="payment-details" class="tab-content">
                    <h3 class="text-xl font-semibold mb-4">Payment Details</h3>
                    <form id="paymentDetailsForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium">Bank Name</label>
                            <select id="bankName" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                                <option value="cbe">Commercial Bank of Ethiopia</option>
                                <option value="awash">Awash International Bank</option>
                                <option value="dashen">Dashen Bank</option>
                                <option value="abyssinia">Bank of Abyssinia</option>
                                <option value="wegagen">Wegagen Bank</option>
                                <option value="hibret">Hibret Bank</option>
                                <option value="nib">Nib International Bank</option>
                                <option value="coop">Cooperative Bank of Oromia</option>
                                <option value="zemen">Zemen Bank</option>
                                <option value="telebirr">Tele Birr</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Account Number</label>
                            <input id="accountNumber" type="text" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter account number">
                        </div>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">Save</button>
                    </form>
                </div>

                <!-- Verification -->
                <div id="verification" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Verification</h3>
                    <div class="space-y-8">
                        <div>
                            <h4 class="text-lg font-semibold mb-4">Tutor Verification</h4>
                            <div class="border p-4 rounded-md bg-gray-50">
                                <h5 class="text-md font-semibold">Get Verified</h5>
                                <p>Price: 990 ETB</p>
                                <p><strong>Name:</strong> <span id="tutor-name">Not set</span></p>
                                <p><strong>Gender:</strong> <span id="tutor-gender">Not set</span></p>
                                <p><strong>Phone:</strong> <span id="tutor-phone">Not set</span></p>
                                <p><strong>Email:</strong> <span id="tutor-email">Not set</span></p>
                                <p><strong>Quote:</strong> <span id="tutor-quote">Not set</span></p>
                                <p><strong>Address:</strong> <span id="tutor-address">Not set</span></p>
                                <p><strong>Teaches at:</strong> <span id="tutor-school">Not set</span></p>
                                <p><strong>Verification Status:</strong> <span id="tutor-verification-status">Not Verified</span></p>
                                <div class="mt-2 flex space-x-2">
                                    <button id="get-verified-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">Get Verified</button>
                                    <button id="edit-verify-profile-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">Edit Profile</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Subscription -->
                <div id="subscription" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Subscription</h3>
                    <div class="space-y-8">
                        <!-- Page Subscription -->
                        <div>
                            <h4 class="text-lg font-semibold mb-4">Standard Subscription</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">1 Month (Basic)</h5>
                                    <p>Price: 390 ETB</p>
                                    <p>Page Search Visibility: Standard</p>
                                    <p>Video Search Visibility: Standard</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="390" data-type="page" data-duration="1-month" data-visibility="Standard">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="390" data-type="page" data-duration="1-month">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">3 Months</h5>
                                    <p>Price: <s>1170 ETB</s> 1000 ETB</p>
                                    <p>Page Search Visibility: Enhanced</p>
                                    <p>Video Search Visibility: Enhanced</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="1000" data-type="page" data-duration="3-months" data-visibility="Enhanced">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="1000" data-type="page" data-duration="3-months">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">6 Months</h5>
                                    <p>Price: <s>2360 ETB</s> 2000 ETB</p>
                                    <p>Page Search Visibility: Premium</p>
                                    <p>Video Search Visibility: Premium</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="2100" data-type="page" data-duration="6-months" data-visibility="Premium">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="2100" data-type="page" data-duration="6-months">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">12 Months</h5>
                                    <p>Price: <s>4680 ETB</s> 4000 ETB</p>
                                    <p>Page Search Visibility: Top Tier</p>
                                    <p>Video Search Visibility: Top Tier</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="4000" data-type="page" data-duration="12-months" data-visibility="Top Tier">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="4000" data-type="page" data-duration="12-months">Cancel Subscription</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Ad Subscription (Premium) -->
                        <div>
                            <h4 class="text-lg font-semibold mb-4">Premium Subscription</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">24 Hours</h5>
                                    <p>Price: 300 ETB</p>
                                    <p>Page Search Visibility: Boosted</p>
                                    <p>Video Search Visibility: Boosted</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="300" data-type="ad" data-duration="24-hours" data-visibility="Boosted">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="300" data-type="ad" data-duration="24-hours">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">3 Days</h5>
                                    <p>Price: <s>900 ETB</s> 825 ETB</p>
                                    <p>Page Search Visibility: Boosted</p>
                                    <p>Video Search Visibility: Boosted</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="500" data-type="ad" data-duration="3-days" data-visibility="Boosted">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="500" data-type="ad" data-duration="3-days">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">1 Week</h5>
                                    <p>Price: <s>2,100 ETB</s> 1,750 ETB</p>
                                    <p>Page Search Visibility: Boosted</p>
                                    <p>Video Search Visibility: Boosted</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="700" data-type="ad" data-duration="1-week" data-visibility="Boosted">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="700" data-type="ad" data-duration="1-week">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">2 Weeks</h5>
                                    <p>Price: <s>4,200 ETB</s> 3,080 ETB</p>
                                    <p>Page Search Visibility: Boosted</p>
                                    <p>Video Search Visibility: Boosted</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="900" data-type="ad" data-duration="2-weeks" data-visibility="Boosted">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="900" data-type="ad" data-duration="2-weeks">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">1 Month</h5>
                                    <p>Price: <s>8,400 ETB</s> 5,600 ETB</p>
                                    <p>Page Search Visibility: Premium</p>
                                    <p>Video Search Visibility: Premium</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="1200" data-type="ad" data-duration="1-month" data-visibility="Premium">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="1200" data-type="ad" data-duration="1-month">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">3 Months (Recommended)</h5>
                                    <p>Price: <s>25,200 ETB</s> 14,700 ETB</p>
                                    <p>Page Search Visibility: Premium</p>
                                    <p>Video Search Visibility: Premium</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="3200" data-type="ad" data-duration="3-months" data-visibility="Premium">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="3200" data-type="ad" data-duration="3-months">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">6 Months</h5>
                                    <p>Price: <s>50,400 ETB</s> 25,200 ETB</p>
                                    <p>Page Search Visibility: Premium</p>
                                    <p>Video Search Visibility: Premium</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="7000" data-type="ad" data-duration="6-months" data-visibility="Premium">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="7000" data-type="ad" data-duration="6-months">Cancel Subscription</button>
                                    </div>
                                </div>
                                <div class="border p-4 rounded-md bg-gray-50">
                                    <h5 class="text-md font-semibold">12 Months</h5>
                                    <p>Price: <s>100,800 ETB</s> 40,320 ETB</p>
                                    <p>Page Search Visibility: Top Tier</p>
                                    <p>Video Search Visibility: Top Tier</p>
                                    <div class="mt-2 flex space-x-2">
                                        <button class="subscribe-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" data-price="12000" data-type="ad" data-duration="12-months" data-visibility="Top Tier">Subscribe</button>
                                        <button class="cancel-btn hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200" data-price="12000" data-type="ad" data-duration="12-months">Cancel Subscription</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Income -->
                <div id="income" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Generated Income</h3>
                    <div class="flex items-center mb-4">
                        <span id="totalIncome" class="mr-2">Total Income: ★★★</span>
                        <button id="toggleIncome" class="text-blue-600 hover:text-blue-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zm6 0c0 5.523-4.477 10-10 10S1 17.523 1 12 5.477 2 11 2s10 4.477 10 10z"></path></svg>
                        </button>
                    </div>
                    <div id="incomeDetails">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-200">
                                    <th class="p-2">Customer</th>
                                    <th class="p-2">Customer Type</th>
                                    <th class="p-2">Service</th>
                                    <th class="p-2">Amount</th>
                                    <th class="p-2">Subscription Type</th>
                                    <th class="p-2">Pending</th>
                                    <th class="p-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">John Doe</td>
                                    <td class="p-2">Parent</td>
                                    <td class="p-2">Tutoring</td>
                                    <td class="p-2">4000 ETB</td>
                                    <td class="p-2">Page (6 Months)</td>
                                    <td class="p-2">0 ETB</td>
                                    <td class="p-2">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2">View Profile</button>
                                        <button class="text-green-600 hover:text-green-800">Generate Invoice</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-2">Jane Smith</td>
                                    <td class="p-2">Student</td>
                                    <td class="p-2">Tutoring</td>
                                    <td class="p-2">3500 ETB</td>
                                    <td class="p-2">Premium (3 Months)</td>
                                    <td class="p-2">0 ETB</td>
                                    <td class="p-2">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2">View Profile</button>
                                        <button class="text-green-600 hover:text-green-800">Generate Invoice</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">Generate Invoice for All</button>
                    </div>
                </div>

                <!-- Bills -->
                <div id="bills" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Bills</h3>
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="p-2">Favorite</th>
                                <th class="p-2">Payer Name</th>
                                <th class="p-2">Payer Type</th>
                                <th class="p-2">Bill Type</th>
                                <th class="p-2">Amount</th>
                                <th class="p-2">To Whom</th>
                                <th class="p-2">Pending</th>
                                <th class="p-2">Date</th>
                                <th class="p-2">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="p-2"><button class="text-yellow-500 hover:text-yellow-600">★</button></td>
                                <td class="p-2">Tutor Inc.</td>
                                <td class="p-2">Company</td>
                                <td class="p-2">Subscription</td>
                                <td class="p-2">500 ETB</td>
                                <td class="p-2">Platform</td>
                                <td class="p-2">0 ETB</td>
                                <td class="p-2">2025-07-01</td>
                                <td class="p-2">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2">View Profile</button>
                                    <button class="text-green-600 hover:text-green-800">Download Invoice</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="p-2"><button class="text-yellow-500 hover:text-yellow-600">★</button></td>
                                <td class="p-2">Ad Corp</td>
                                <td class="p-2">Company</td>
                                <td class="p-2">Advertisement</td>
                                <td class="p-2">750 ETB</td>
                                <td class="p-2">Ad Platform</td>
                                <td class="p-2">250 ETB</td>
                                <td class="p-2">2025-07-10</td>
                                <td class="p-2">
                                    <button class="text-blue-600 hover:text-blue-800 mr-2">View Profile</button>
                                    <button class="text-green-600 hover:text-green-800">Download Invoice</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Analytics -->
                <div id="analytics" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Income and Payments Analytics</h3>
                    <select id="analyticsPeriod" class="w-full p-2 border rounded-md mb-4 focus:ring-2 focus:ring-blue-500">
                        <option value="1-day">1 Day</option>
                        <option value="3-days">3 Days</option>
                        <option value="1-week">1 Week</option>
                        <option value="2-weeks">2 Weeks</option>
                        <option value="1-month">1 Month</option>
                        <option value="3-months">3 Months</option>
                        <option value="6-months">6 Months</option>
                        <option value="1-year">1 Year</option>
                    </select>
                    <div>
                        <p class="mb-2">Total Income: 7500 ETB</p>
                        <p class="mb-2">Total Payments: 3000 ETB</p>
                        <canvas id="analyticsChart" class="w-full h-64"></canvas>
                    </div>
                </div>

                <!-- Set Package -->
                <div id="set-package" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Set Package</h3>
                    <form id="setPackageForm" class="space-y-4">
                        <div id="coursesContainer" class="space-y-4">
                            <!-- Course Entry Template -->
                            <div class="course-entry border p-4 rounded-md bg-gray-50">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-md font-semibold">Course</h4>
                                    <button type="button" class="remove-course-btn text-red-600 hover:text-red-800">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium">Course Name</label>
                                        <input type="text" class="course-name w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter course name" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">Payment Frequency</label>
                                        <select class="payment-frequency w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" required>
                                            <option value="2-weeks">2 Weeks</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">Hourly Rate (ETB)</label>
                                        <input type="number" class="hourly-rate w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter hourly rate" min="0" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">Discounts (%)</label>
                                        <div class="grid grid-cols-3 gap-2">
                                            <input type="number" class="discount-3months w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="3 Months" min="0" max="100" value="0">
                                            <input type="number" class="discount-6months w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="6 Months" min="0" max="100" value="0">
                                            <input type="number" class="discount-yearly w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Yearly" min="0" max="100" value="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="addCourseBtn" class="flex items-center text-blue-600 hover:text-blue-800">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            Add Course
                        </button>
                        <div>
                            <label class="block text-sm font-medium">Bank Name</label>
                            <select id="updateBankName" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                                <option value="cbe">Commercial Bank of Ethiopia</option>
                                <option value="awash">Awash International Bank</option>
                                <option value="dashen">Dashen Bank</option>
                                <option value="abyssinia">Bank of Abyssinia</option>
                                <option value="wegagen">Wegagen Bank</option>
                                <option value="hibret">Hibret Bank</option>
                                <option value="nib">Nib International Bank</option>
                                <option value="coop">Cooperative Bank of Oromia</option>
                                <option value="zemen">Zemen Bank</option>
                                <option value="telebirr">Tele Birr</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Account Number</label>
                            <input id="updateAccountNumber" type="text" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter account number">
                        </div>
                        <div>
                            <label class="flex items-center">
                                <input id="samePaymentDetails" type="checkbox" class="mr-2">
                                <span class="text-sm font-medium">Use same payment details for receiving payments</span>
                            </label>
                        </div>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">Update</button>
                    </form>
                </div>

                <!-- View Package -->
                <div id="view-package" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">View Package</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Days per Week (Set by Parent/Student)</label>
                        <input type="number" id="days-per-week" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter days per week" min="1" max="7" value="3">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Hours per Day</label>
                        <input type="number" id="hours-per-day" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter hours per day" min="1" max="24" value="1">
                    </div>
                    <button id="calculate-fees" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 mb-4">Calculate Fees</button>
                    <div id="coursesDisplay" class="space-y-4">
                        <p class="text-gray-600">No courses have been set.</p>
                    </div>
                    <div class="mt-4">
                        <h4 class="text-lg font-semibold mb-2">Payment Details</h4>
                        <p><strong>Bank Name:</strong> <span id="displayBankName">Not set</span></p>
                        <p><strong>Account Number:</strong> <span id="displayAccountNumber">Not set</span></p>
                    </div>
                </div>

                <!-- Leave Astegni -->
                <div id="leave-astegni" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Leave Astegni</h3>
                    <p class="text-gray-600 mb-4">Are you sure you want to leave Astegni? This action will unverify and deactivate your account.</p>
                    <button id="leaveAstegniBtn" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200">Confirm Leave</button>
                </div>

                <!-- Close Modal Button -->
                <button id="closeModal" class="mt-4 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">Close</button>
            </div>
        </div>
    </div>

    <!-- Switch to Plan Modal -->
    <div id="manageSubscriptionModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4">Switch to Plan</h3>
            <div id="subscriptionOptions" class="space-y-4"></div>
            <button id="closeManageModal" class="mt-4 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">Close</button>
        </div>
    </div>

    <!-- Unsubscribe Modal: Step 1 (Reasons) -->
    <div id="unsubscribeModal1" class="modal">
        <div class="modal-content">
            <h2>Why did you come to this decision? 😢</h2>
            <label><input type="checkbox" name="unsubscribeReason" value="notUseful"> Service not useful</label>
            <label><input type="checkbox" name="unsubscribeReason" value="tooExpensive"> Too expensive</label>
            <label><input type="checkbox" name="unsubscribeReason" value="foundAlternative"> Found an alternative</label>
            <label><input type="checkbox" name="unsubscribeReason" value="privacyConcerns"> Privacy concerns</label>
            <label><input type="checkbox" name="unsubscribeReason" value="notSatisfied"> Not satisfied with features</label>
            <label><input type="checkbox" name="unsubscribeReason" value="other" id="unsubscribeOther"> Other</label>
            <textarea id="otherText" placeholder="Please specify" style="display: none;"></textarea>
            <button id="unsubscribeSubmitBtn" class="bg-blue-600 text-white hover:bg-blue-700">Submit</button>
            <button id="unsubscribeCancelBtn1" class="bg-gray-600 text-white hover:bg-gray-700">Cancel</button>
        </div>
    </div>

    <!-- Unsubscribe Modal: Step 2 (First Confirmation) -->
    <div id="unsubscribeConfirm1" class="modal">
        <div class="modal-content">
            <h2>Confirm Unsubscription</h2>
            <p id="unsubscribeFirstConfirmText">This decision will deactivate your subscription.</p>
            <button id="unsubscribeYesBtn1" class="bg-blue-600 text-white hover:bg-blue-700">Yes</button>
            <button id="unsubscribeCancelBtn2" class="bg-gray-600 text-white hover:bg-gray-700">No</button>
        </div>
    </div>

    <!-- Unsubscribe Modal: Step 3 (Second Confirmation) -->
    <div id="unsubscribeConfirm2" class="modal">
        <div class="modal-content">
            <h2>Confirm Cancellation Fee</h2>
            <p id="unsubscribeSecondConfirmText">Subscription cancellation has a fee of 5%. Are you still sure to cancel subscription?</p>
            <button id="unsubscribeYesBtn2" class="bg-blue-600 text-white hover:bg-blue-700">Yes</button>
            <button id="unsubscribeCancelBtn3" class="bg-gray-600 text-white hover:bg-gray-700">No</button>
        </div>
    </div>

    <!-- Unsubscribe Modal: Step 4 (Password) -->
    <div id="unsubscribePasswordModal" class="modal">
        <div class="modal-content">
            <h2>It's okay, please enter your password to confirm cancellation.</h2>
            <label>Enter Password: <input type="password" id="unsubscribePassword"></label>
            <button id="unsubscribeSubmitPasswordBtn" class="bg-blue-600 text-white hover:bg-blue-700">Submit</button>
            <button id="unsubscribeCancelBtn4" class="bg-gray-600 text-white hover:bg-gray-700">Cancel</button>
        </div>
    </div>

    <!-- Unsubscribe Modal: Step 5 (Final Message) -->
    <div id="unsubscribeModal3" class="modal">
        <div class="modal-content">
            <h2>See you soon! Enjoy your break, and we’ll be here when you’re ready to return. 👋</h2>
            <button id="unsubscribeCloseBtn" class="bg-gray-600 text-white hover:bg-gray-700">Close</button>
        </div>
    </div>

    <!-- Delete Modal: Step 1 (Reasons) -->
    <div id="deleteModal1" class="modal">
        <div class="modal-content">
            <h2>Why did you come to this decision? 😔</h2>
            <label><input type="checkbox" name="deleteReason" value="notUseful"> Service not useful</label>
            <label><input type="checkbox" name="deleteReason" value="tooExpensive"> Too expensive</label>
            <label><input type="checkbox" name="deleteReason" value="foundAlternative"> Found an alternative</label>
            <label><input type="checkbox" name="deleteReason" value="privacyConcerns"> Privacy concerns</label>
            <label><input type="checkbox" name="deleteReason" value="notSatisfied"> Not satisfied with features</label>
            <label><input type="checkbox" name="deleteReason" value="other" id="deleteOther"> Other</label>
            <textarea id="otherTextDelete" placeholder="Please specify" style="display: none;"></textarea>
            <button id="deleteSubmitBtn" class="bg-blue-600 text-white hover:bg-blue-700">Submit</button>
            <button id="deleteCancelBtn1" class="bg-gray-600 text-white hover:bg-gray-700">Cancel</button>
        </div>
    </div>

    <!-- Delete Modal: Step 2 (Verification Check) -->
    <div id="deleteVerifyModal" class="modal">
        <div class="modal-content">
            <h2>Are you sure you want to leave Astegni?</h2>
            <p id="deleteVerifyText">This decision will unverify and deactivate your account. A 15% verification fee (0 ETB) will be charged if applicable.</p>
            <button id="deleteYesBtn" class="bg-blue-600 text-white hover:bg-blue-700">Yes</button>
            <button id="deleteCancelBtn2" class="bg-gray-600 text-white hover:bg-gray-700">No</button>
        </div>
    </div>

    <!-- Delete Modal: Step 3 (Subscription Check) -->
    <div id="deleteSubscriptionCheckModal" class="modal">
        <div class="modal-content">
            <h2>Active Subscriptions Detected</h2>
            <p>Please cancel all active subscriptions before proceeding with account deletion.</p>
            <button id="deleteCancelBtn3" class="bg-gray-600 text-white hover:bg-gray-700">Close</button>
        </div>
    </div>

    <!-- Delete Modal: Step 4 (Password) -->
    <div id="deleteConfirm2" class="modal">
        <div class="modal-content">
            <h2>Final Confirmation</h2>
            <p>Please enter your password to confirm account deletion. This action cannot be undone.</p>
            <label>Enter Password: <input type="password" id="deletePassword"></label>
            <button id="deleteSubmitPasswordBtn" class="bg-blue-600 text-white hover:bg-blue-700">Submit</button>
            <button id="deleteCancelBtn4" class="bg-gray-600 text-white hover:bg-gray-700">Cancel</button>
        </div>
    </div>

    <!-- Delete Modal: Step 5 (Final Message) -->
    <div id="deleteModal3" class="modal">
        <div class="modal-content">
            <h2>Farewell, We very much hope all the success in your next life. 🌟</h2>
            <button id="deleteCloseBtn" class="bg-gray-600 text-white hover:bg-gray-700">Close</button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-verify-profile-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Edit Profile</h3>
            <label class="block mb-2 text-[var(--text)]">Name</label>
            <input type="text" id="profile-name" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter your name">
            <label class="block mb-2 text-[var(--text)]">Gender</label>
            <select id="profile-gender" class="w-full p-2 border rounded-lg mb-4">
                <option value="" disabled selected>Select gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
            <label class="block mb-2 text-[var(--text)]">Phone Number</label>
            <input type="tel" id="profile-phone" class="w-full p-2 border rounded-lg mb-4" placeholder="+251912345678">
            <label class="block mb-2 text-[var(--text)]">Email Address</label>
            <input type="email" id="profile-email" class="w-full p-2 border rounded-lg mb-4" placeholder="example@astegni.com">
            <label class="block mb-2 text-[var(--text)]">What's Your Quote</label>
            <textarea id="profile-quote" class="w-full p-2 border rounded-lg mb-4" rows="3" placeholder="Enter your quote"></textarea>
            <label class="block mb-2 text-[var(--text)]">Address</label>
            <div class="flex gap-2 mb-4">
                <input type="text" id="profile-address" class="w-full p-2 border rounded-lg" placeholder="Enter your address" readonly>
                <button id="use-my-location" class="cta-button px-4 py-2 rounded-lg">Use My Location</button>
            </div>
            <p id="location-error" class="text-red-500 text-sm mb-2 hidden">Unable to get location.</p>
            <label class="block mb-2 text-[var(--text)]">Teaches at</label>
            <div class="relative mb-4">
                <input type="text" id="profile-school" class="w-full p-2 border rounded-lg" placeholder="Search for school">
                <div id="school-suggestions" class="school-suggestions hidden"></div>
                <button id="request-school-btn" class="cta-button px-4 py-2 rounded-lg mt-2 hidden">Request School Listing</button>
            </div>
            <label class="block mb-2 text-[var(--text)]">ID Document (Passport, Driver’s License, FIDA, etc.)</label>
            <input type="file" id="id-input" accept="image/*,application/pdf" class="w-full p-2 border rounded-lg mb-2">
            <p id="id-error" class="text-red-500 text-sm mb-2 hidden">Invalid file (max 5MB, JPEG/PNG/GIF/PDF).</p>
            <div id="id-preview" class="mb-4"></div>
            <label class="block mb-2 text-[var(--text)]">Face Scan (Selfie via Webcam)</label>
            <button id="face-scan-btn" class="cta-button px-4 py-2 rounded-lg mb-2">Capture Selfie</button>
            <p id="face-scan-status" class="text-[var(--text)] mb-2">No selfie captured.</p>
            <div class="flex justify-end gap-2">
                <button id="saveProfileBtn" class="cta-button px-4 py-2 rounded-lg">Save</button>
                <button id="cancelProfileBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Request School Listing Modal -->
    <div id="request-school-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-2xl font-bold mb-4 text-[var(--heading)]">Request School Listing</h3>
            <label class="block mb-2 text-[var(--text)]">School Name</label>
            <input type="text" id="request-school-name" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter school name">
            <label class="block mb-2 text-[var(--text)]">Phone Number</label>
            <input type="tel" id="request-school-phone" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter phone number">
            <label class="block mb-2 text-[var(--text)]">Email Address</label>
            <input type="email" id="request-school-email" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter email address">
            <label class="block mb-2 text-[var(--text)]">Location</label>
            <input type="text" id="request-school-location" class="w-full p-2 border rounded-lg mb-4" placeholder="Enter location">
            <button id="submitSchoolRequestBtn" class="cta-button px-4 py-2 rounded-lg w-full">Submit Request</button>
            <button id="cancelSchoolRequestBtn" class="mt-4 text-[var(--text)] hover:underline">Cancel</button>
        </div>
    </div>

    <script>
        // Store courses, payment details, subscription state, profile, and verification status
        let courses = [];
        let bankDetails = { bankName: 'Not set', accountNumber: 'Not set' };
        let activeSubscriptions = {};
        let profile = {
            name: 'Not set',
            gender: 'Not set',
            phone: 'Not set',
            email: 'Not set',
            quote: 'Not set',
            address: 'Not set',
            school: 'Not set'
        };
        let verificationStatus = 'Not Verified';
        let currentUnsubscribe = null;
        let isAccountDeleted = false;
        let pendingSchools = []; // Track requested schools
        // Mock data from parent/student profile
        let parentStudentRequest = { daysPerWeek: 3, hoursPerDay: 1 }; // Default values
        // Temporary storage for profile data during school request
        let tempProfile = null;

        // Subscription plans data
        const subscriptionPlans = {
            page: [
                { duration: '1-month', price: 390, visibility: 'Standard', originalPrice: 390 },
                { duration: '3-months', price: 1000, visibility: 'Enhanced', originalPrice: 1170 },
                { duration: '6-months', price: 2000, visibility: 'Premium', originalPrice: 2360 },
                { duration: '12-months', price: 4000, visibility: 'Top Tier', originalPrice: 4680 }
            ],
            ad: [
                { duration: '24-hours', price: 300, visibility: 'Boosted', originalPrice: 300 },
                { duration: '3-days', price: 500, visibility: 'Boosted', originalPrice: 600 },
                { duration: '1-week', price: 1400, visibility: 'Boosted', originalPrice: 2100 },
                { duration: '2-weeks', price: 2500, visibility: 'Boosted', originalPrice: 4200 },
                { duration: '1-month', price: 4000, visibility: 'Premium', originalPrice: 5000 },
                { duration: '3-months', price: 12000, visibility: 'Premium', originalPrice: 15000 },
                { duration: '6-months', price: 25000, visibility: 'Premium', originalPrice: 30000 },
                { duration: '12-months', price: 50000, visibility: 'Top Tier', originalPrice: 60000 }
            ]
        };

        // Track previous school value to detect changes
        let previousSchool = profile.school;

        // Levenshtein distance function for typo tolerance
        function levenshteinDistance(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1, // substitution
                            matrix[i][j - 1] + 1,     // insertion
                            matrix[i - 1][j] + 1      // deletion
                        );
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        // Tutor Profile Modal Toggle
        function openManageFinances() {
            document.getElementById('manageFinanceModal').style.display = 'flex';
            showTab('payment-details');
        }

        // Modal Show/Hide Functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Tab Navigation
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('bg-gray-100'));
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) selectedTab.classList.remove('hidden');
            const selectedBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (selectedBtn) selectedBtn.classList.add('bg-gray-100');
        }

        // Initialize Tab Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    showTab(tabId);
                });
            });
        });

        // Edit Profile Form Submission
        function saveProfile() {
            const name = document.getElementById('profile-name').value;
            const gender = document.getElementById('profile-gender').value;
            const phone = document.getElementById('profile-phone').value;
            const email = document.getElementById('profile-email').value;
            const quote = document.getElementById('profile-quote').value;
            const address = document.getElementById('profile-address').value;
            const school = document.getElementById('profile-school').value;
            const idFile = document.getElementById('id-input').files[0];

            if (!name || !gender || !phone || !email || !address || !school) {
                alert('Please fill in all required fields.');
                return;
            }
            if (idFile && idFile.size > 5 * 1024 * 1024) {
                document.getElementById('id-error').classList.remove('hidden');
                return;
            }

            // Store profile data temporarily
            tempProfile = { name, gender, phone, email, quote, address, school };

            // Check if school is not in mock or pending schools (with typo tolerance)
            const mockSchools = ['Addis Ababa University', 'Unity University', 'St. Mary School', 'Hillside School'];
            const isSystemSchool = mockSchools.some(s => s.toLowerCase() === school.toLowerCase() || levenshteinDistance(s.toLowerCase(), school.toLowerCase()) <= 2);
            const isPendingSchool = pendingSchools.some(s => s.toLowerCase() === school.toLowerCase() || levenshteinDistance(s.toLowerCase(), school.toLowerCase()) <= 2);
            
            if (!isSystemSchool && !isPendingSchool) {
                document.getElementById('request-school-name').value = school;
                showModal('request-school-modal');
            } else {
                // Save profile immediately if school is in system or pending
                profile = tempProfile;
                tempProfile = null;
                closeModal('edit-verify-profile-modal');
                updateVerificationCard();
                alert('Profile updated successfully!');
                previousSchool = school;
            }
        }

        // Verification Card Update
        function updateVerificationCard() {
            document.getElementById('tutor-name').textContent = profile.name;
            document.getElementById('tutor-gender').textContent = profile.gender;
            document.getElementById('tutor-phone').textContent = profile.phone;
            document.getElementById('tutor-email').textContent = profile.email;
            document.getElementById('tutor-quote').textContent = profile.quote;
            document.getElementById('tutor-address').textContent = profile.address;
            // Check if school is in mock system and append "(pending)" if not
            const mockSchools = ['Addis Ababa University', 'Unity University', 'St. Mary School', 'Hillside School'];
            const schoolDisplay = mockSchools.includes(profile.school) ? profile.school : `${profile.school} (pending)`;
            document.getElementById('tutor-school').textContent = schoolDisplay;
            document.getElementById('tutor-verification-status').textContent = verificationStatus;
            // Show "Get Verified" button only if tutor data is not set or school has changed
            const isTutorDataNotSet = Object.values(profile).some(value => value === 'Not set');
            const hasSchoolChanged = profile.school !== previousSchool;
            document.getElementById('get-verified-btn').style.display = (isTutorDataNotSet || hasSchoolChanged) ? 'inline-block' : 'none';
        }

        // Get Verified Button
        document.getElementById('get-verified-btn').addEventListener('click', () => {
            // Validate payment details
            if (!bankDetails.bankName || bankDetails.bankName === 'Not set' || !bankDetails.accountNumber || bankDetails.accountNumber === 'Not set') {
                alert('Please fill in all required data first. Set your payment details in the Payment Details tab.');
                return;
            }

            // Check profile fields, ID, and selfie status
            const name = profile.name;
            const gender = profile.gender;
            const phone = profile.phone;
            const email = profile.email;
            const address = profile.address;
            const school = profile.school;
            const idFile = document.getElementById('id-input').files[0];
            const faceScanStatus = document.getElementById('face-scan-status').textContent;

            // If any validation fails, show alert and do not proceed
            if (!name || !gender || !phone || !email || !address || !school || !idFile || idFile.size > 5 * 1024 * 1024 || faceScanStatus !== 'Selfie captured successfully!') {
                alert('Please fill in all required data first. Complete your profile, upload an ID document, and capture a selfie in the Edit Profile section.');
                return;
            }

            // If all validations pass, set status to "Under Verification"
            verificationStatus = 'Under Verification';
            updateVerificationCard();
            alert('Verification request submitted! Your profile is now under verification.');
        });

        // Payment Details Form Submission
        document.getElementById('paymentDetailsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const bankName = document.getElementById('bankName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            if (bankName && accountNumber) {
                bankDetails.bankName = bankName;
                bankDetails.accountNumber = accountNumber;
                alert('Payment details saved successfully!');
                if (document.getElementById('samePaymentDetails').checked) {
                    document.getElementById('updateBankName').value = bankName;
                    document.getElementById('updateAccountNumber').value = accountNumber;
                }
                displayCourses();
            } else {
                alert('Please fill in all payment details.');
            }
        });

        // Auto-fill Payment Details
        document.getElementById('samePaymentDetails').addEventListener('change', (e) => {
            const bankName = document.getElementById('bankName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const updateBankName = document.getElementById('updateBankName');
            const updateAccountNumber = document.getElementById('updateAccountNumber');
            if (e.target.checked) {
                updateBankName.value = bankName;
                updateAccountNumber.value = accountNumber;
                updateBankName.disabled = true;
                updateAccountNumber.disabled = true;
            } else {
                updateBankName.disabled = false;
                updateAccountNumber.disabled = false;
            }
        });

        // Add Course Functionality
        document.getElementById('addCourseBtn').addEventListener('click', () => {
            const coursesContainer = document.getElementById('coursesContainer');
            const courseTemplate = coursesContainer.querySelector('.course-entry').cloneNode(true);
            courseTemplate.querySelector('.course-name').value = '';
            courseTemplate.querySelector('.payment-frequency').value = '2-weeks';
            courseTemplate.querySelector('.hourly-rate').value = '';
            courseTemplate.querySelector('.discount-3months').value = '0';
            courseTemplate.querySelector('.discount-6months').value = '0';
            courseTemplate.querySelector('.discount-yearly').value = '0';
            courseTemplate.querySelector('.remove-course-btn').classList.remove('hidden');
            coursesContainer.appendChild(courseTemplate);
            updateRemoveButtons();
        });

        // Remove Course Functionality
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-course-btn');
            const courseEntries = document.querySelectorAll('.course-entry');
            removeButtons.forEach((btn, index) => {
                btn.classList.toggle('hidden', courseEntries.length === 1);
                btn.onclick = () => {
                    if (courseEntries.length > 1) {
                        btn.closest('.course-entry').remove();
                        updateRemoveButtons();
                    }
                };
            });
        }

        // Initialize Remove Buttons
        updateRemoveButtons();

        // Set Package Form Submission
        document.getElementById('setPackageForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const courseEntries = document.querySelectorAll('.course-entry');
            let valid = true;
            courses = [];
            courseEntries.forEach(entry => {
                const courseName = entry.querySelector('.course-name').value;
                const paymentFrequency = entry.querySelector('.payment-frequency').value;
                const hourlyRate = parseFloat(entry.querySelector('.hourly-rate').value);
                const discount3Months = parseFloat(entry.querySelector('.discount-3months').value) || 0;
                const discount6Months = parseFloat(entry.querySelector('.discount-6months').value) || 0;
                const discountYearly = parseFloat(entry.querySelector('.discount-yearly').value) || 0;

                if (!courseName || isNaN(hourlyRate) || hourlyRate < 0 || 
                    discount3Months < 0 || discount3Months > 100 ||
                    discount6Months < 0 || discount6Months > 100 ||
                    discountYearly < 0 || discountYearly > 100) {
                    valid = false;
                    alert('Please fill in all required fields with valid values for each course.');
                } else {
                    courses.push({
                        courseName,
                        feeType: 'hourly',
                        paymentFrequency,
                        hourlyRate,
                        discount3Months,
                        discount6Months,
                        discountYearly
                    });
                }
            });
            if (valid) {
                bankDetails.bankName = document.getElementById('updateBankName').value;
                bankDetails.accountNumber = document.getElementById('updateAccountNumber').value || 'Not set';
                alert('Package updated successfully!');
                displayCourses();
            }
        });

        function displayCourses() {
            const coursesDisplay = document.getElementById('coursesDisplay');
            const daysPerWeek = parseInt(document.getElementById('days-per-week').value) || parentStudentRequest.daysPerWeek;
            const hoursPerDay = parseInt(document.getElementById('hours-per-day').value) || parentStudentRequest.hoursPerDay;
            const hoursPerWeek = daysPerWeek * hoursPerDay;

            coursesDisplay.innerHTML = '';
            if (courses.length === 0) {
                coursesDisplay.innerHTML = '<p class="text-gray-600">No courses have been set.</p>';
            } else {
                courses.forEach((course, index) => {
                    const courseDiv = document.createElement('div');
                    courseDiv.className = 'border p-4 rounded-md bg-gray-50';
                    const weeksPerCycle = course.paymentFrequency === '2-weeks' ? 2 : 4;
                    const basePricePerCycle = course.hourlyRate * hoursPerWeek * weeksPerCycle;
                    const priceShortTerm = basePricePerCycle * (1 - course.discount3Months / 100);
                    const price3Months = basePricePerCycle * (1 - course.discount3Months / 100);
                    const price6Months = basePricePerCycle * (1 - course.discount6Months / 100);
                    const priceYearly = basePricePerCycle * (1 - course.discountYearly / 100);

                    courseDiv.innerHTML = `
                        <h4 class="text-md font-semibold mb-2">Course ${index + 1}: ${course.courseName}</h4>
                        <p><strong>Fee Type:</strong> Hourly</p>
                        <p><strong>Payment Frequency:</strong> ${course.paymentFrequency === '2-weeks' ? '2 Weeks' : 'Monthly'}</p>
                        <p><strong>Availability:</strong> ${daysPerWeek} days/week, ${hoursPerDay} hours/day (${hoursPerWeek} hours/week)</p>
                        <p><strong>Price (${course.paymentFrequency === '2-weeks' ? '2 Weeks' : '1 Month'}):</strong> 
                            ${course.discount3Months > 0 ? `<s>${basePricePerCycle.toFixed(2)} ETB</s> ` : ''}${priceShortTerm.toFixed(2)} ETB 
                            ${course.discount3Months > 0 ? `(${course.discount3Months}% discount)` : ''}
                        </p>
                        <p><strong>Price (3 Months):</strong> 
                            ${course.discount3Months > 0 ? `<s>${basePricePerCycle.toFixed(2)} ETB</s> ` : ''}${price3Months.toFixed(2)} ETB 
                            ${course.discount3Months > 0 ? `(${course.discount3Months}% discount)` : ''}
                        </p>
                        <p><strong>Price (6 Months):</strong> 
                            ${course.discount6Months > 0 ? `<s>${basePricePerCycle.toFixed(2)} ETB</s> ` : ''}${price6Months.toFixed(2)} ETB 
                            ${course.discount6Months > 0 ? `(${course.discount6Months}% discount)` : ''}
                        </p>
                        <p><strong>Price (Yearly):</strong> 
                            ${course.discountYearly > 0 ? `<s>${basePricePerCycle.toFixed(2)} ETB</s> ` : ''}${priceYearly.toFixed(2)} ETB 
                            ${course.discountYearly > 0 ? `(${course.discountYearly}% discount)` : ''}
                        </p>
                    `;
                    coursesDisplay.appendChild(courseDiv);
                });
            }
            document.getElementById('displayBankName').textContent = bankDetails.bankName;
            document.getElementById('displayAccountNumber').textContent = bankDetails.accountNumber;
        }

        // Calculate Fees Button
        document.getElementById('calculate-fees').addEventListener('click', () => {
            const daysPerWeek = parseInt(document.getElementById('days-per-week').value);
            const hoursPerDay = parseInt(document.getElementById('hours-per-day').value);
            if (isNaN(daysPerWeek) || isNaN(hoursPerDay) || daysPerWeek < 1 || daysPerWeek > 7 || hoursPerDay < 1 || hoursPerDay > 24) {
                alert('Please enter valid values for days per week (1-7) and hours per day (1-24).');
                return;
            }
            parentStudentRequest = { daysPerWeek, hoursPerDay };
            displayCourses();
        });

        // Subscription Button Handling
        document.querySelectorAll('.subscribe-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                // Check verification status before allowing subscription
                if (verificationStatus !== 'Verified') {
                    alert('You must be verified to subscribe to a plan. Please complete verification in the Edit Profile section.');
                    return;
                }

                if (button.textContent === 'Switch to Plan') {
                    const type = button.getAttribute('data-type');
                    const currentDuration = button.getAttribute('data-duration');
                    openManageSubscriptionModal(type, currentDuration);
                } else {
                    const price = parseFloat(button.getAttribute('data-price'));
                    const type = button.getAttribute('data-type');
                    const duration = button.getAttribute('data-duration');
                    // Cancel any existing page subscription if subscribing to an ad plan
                    if (type === 'ad' && activeSubscriptions['page']) {
                        const oldPageSubscribeBtn = document.querySelector(`.subscribe-btn[data-type="page"][data-duration="${activeSubscriptions['page'].duration}"]`);
                        if (oldPageSubscribeBtn) {
                            oldPageSubscribeBtn.textContent = 'Subscribe';
                            oldPageSubscribeBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                            oldPageSubscribeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                            oldPageSubscribeBtn.parentElement.querySelector('.cancel-btn').classList.add('hidden');
                            delete activeSubscriptions['page'];
                        }
                    }
                    button.textContent = 'Switch to Plan';
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-blue-500', 'hover:bg-blue-600');
                    const cancelBtn = button.parentElement.querySelector('.cancel-btn');
                    cancelBtn.classList.remove('hidden');
                    activeSubscriptions[type] = { duration, price };
                    alert(`Subscribed to ${type} plan for ${duration} at ${price} ETB!`);
                }
            });
        });

        // Cancel Subscription Button Handling
        document.querySelectorAll('.cancel-btn').forEach(button => {
            button.addEventListener('click', () => {
                const price = parseFloat(button.getAttribute('data-price'));
                const type = button.getAttribute('data-type');
                const duration = button.getAttribute('data-duration');
                currentUnsubscribe = { button, price, type, duration };
                unsubscribe();
            });
        });

        // Switch to Plan Modal Handling
        function openManageSubscriptionModal(type, currentDuration) {
            // Check verification status before allowing plan switch
            if (verificationStatus !== 'Verified') {
                alert('You must be verified to switch plans. Please complete verification in the Edit Profile section.');
                return;
            }

            const modal = document.getElementById('manageSubscriptionModal');
            const optionsContainer = document.getElementById('subscriptionOptions');
            optionsContainer.innerHTML = '';
            const plans = subscriptionPlans[type].filter(plan => plan.duration !== currentDuration);
            if (plans.length === 0) {
                optionsContainer.innerHTML = '<p class="text-gray-600">No other plans available.</p>';
            } else {
                plans.forEach(plan => {
                    const planDiv = document.createElement('div');
                    planDiv.className = 'border p-4 rounded-md bg-gray-50';
                    planDiv.innerHTML = `
                        <h5 class="text-md font-semibold">${plan.duration.replace('-', ' ')}${plan.duration === '1-month' && type === 'page' ? ' (Basic)' : ''}</h5>
                        <p>Price: ${plan.originalPrice !== plan.price ? `<s>${plan.originalPrice} ETB</s> ${plan.price} ETB` : `${plan.price} ETB`}</p>
                        <p>Page Search Visibility: ${plan.visibility}</p>
                        <p>Video Search Visibility: ${plan.visibility}</p>
                        <button class="switch-plan-btn mt-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200" 
                                data-type="${type}" 
                                data-duration="${plan.duration}" 
                                data-price="${plan.price}" 
                                data-visibility="${plan.visibility}">
                            Switch to Plan
                        </button>
                    `;
                    optionsContainer.appendChild(planDiv);
                });
            }
            modal.style.display = 'flex';
            document.querySelectorAll('.switch-plan-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const newType = btn.getAttribute('data-type');
                    const newDuration = btn.getAttribute('data-duration');
                    const newPrice = parseFloat(btn.getAttribute('data-price'));
                    // Cancel the current plan without payment or questioning
                    const oldSubscribeBtn = document.querySelector(`.subscribe-btn[data-type="${newType}"][data-duration="${activeSubscriptions[newType]?.duration}"]`);
                    if (oldSubscribeBtn) {
                        oldSubscribeBtn.textContent = 'Subscribe';
                        oldSubscribeBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                        oldSubscribeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        oldSubscribeBtn.parentElement.querySelector('.cancel-btn').classList.add('hidden');
                    delete activeSubscriptions[newType];
                    // Cancel any existing page subscription if switching to an ad plan
                    if (newType === 'ad' && activeSubscriptions['page']) {
                        const oldPageSubscribeBtn = document.querySelector(`.subscribe-btn[data-type="page"][data-duration="${activeSubscriptions['page'].duration}"]`);
                        if (oldPageSubscribeBtn) {
                            oldPageSubscribeBtn.textContent = 'Subscribe';
                            oldPageSubscribeBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                            oldPageSubscribeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                            oldPageSubscribeBtn.parentElement.querySelector('.cancel-btn').classList.add('hidden');
                            delete activeSubscriptions['page'];
                        }
                    }
                    // Activate the new plan
                    const newSubscribeBtn = document.querySelector(`.subscribe-btn[data-type="${newType}"][data-duration="${newDuration}"]`);
                    if (newSubscribeBtn) {
                        newSubscribeBtn.textContent = 'Switch to Plan';
                        newSubscribeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                        newSubscribeBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
                        newSubscribeBtn.parentElement.querySelector('.cancel-btn').classList.remove('hidden');
                    }
                    activeSubscriptions[newType] = { duration: newDuration, price: newPrice };
                    alert(`Switched to ${newType} plan for ${newDuration} at ${newPrice} ETB!`);
                    closeModal('manageSubscriptionModal');
                }});
            });
        }

        // Unsubscribe Flow
        function unsubscribe() {
            showModal('unsubscribeModal1');
        }

        // Unsubscribe Modal Step 1: Reasons
        document.getElementById('unsubscribeOther').addEventListener('change', (e) => {
            document.getElementById('otherText').style.display = e.target.checked ? 'block' : 'none';
        });

        document.getElementById('unsubscribeSubmitBtn').addEventListener('click', () => {
            const reasons = Array.from(document.querySelectorAll('input[name="unsubscribeReason"]:checked')).map(input => input.value);
            const otherText = document.getElementById('otherText').value;
            if (reasons.length === 0) {
                alert('Please select at least one reason.');
                return;
            }
            if (reasons.includes('other') && !otherText) {
                alert('Please specify the reason for "Other".');
                return;
            }
            closeModal('unsubscribeModal1');
            document.getElementById('unsubscribeFirstConfirmText').textContent = `This decision will deactivate your ${currentUnsubscribe.type} subscription for ${currentUnsubscribe.duration}.`;
            showModal('unsubscribeConfirm1');
        });

        document.getElementById('unsubscribeCancelBtn1').addEventListener('click', () => {
            closeModal('unsubscribeModal1');
            currentUnsubscribe = null;
        });

        // Unsubscribe Modal Step 2: First Confirmation
        document.getElementById('unsubscribeYesBtn1').addEventListener('click', () => {
            closeModal('unsubscribeConfirm1');
            const fee = currentUnsubscribe.price * 0.05;
            document.getElementById('unsubscribeSecondConfirmText').textContent = `Subscription cancellation has a fee of 5% (${fee.toFixed(2)} ETB). Are you still sure to cancel subscription?`;
            showModal('unsubscribeConfirm2');
        });

        document.getElementById('unsubscribeCancelBtn2').addEventListener('click', () => {
            closeModal('unsubscribeConfirm1');
            currentUnsubscribe = null;
        });

        // Unsubscribe Modal Step 3: Second Confirmation
        document.getElementById('unsubscribeYesBtn2').addEventListener('click', () => {
            closeModal('unsubscribeConfirm2');
            showModal('unsubscribePasswordModal');
        });

        document.getElementById('unsubscribeCancelBtn3').addEventListener('click', () => {
            closeModal('unsubscribeConfirm2');
            currentUnsubscribe = null;
        });

        // Unsubscribe Modal Step 4: Password
        document.getElementById('unsubscribeSubmitPasswordBtn').addEventListener('click', () => {
            const password = document.getElementById('unsubscribePassword').value;
            if (!password) {
                alert('Please enter your password.');
                return;
            }
            // Mock password check
            if (password === 'password123') {
                closeModal('unsubscribePasswordModal');
                const { button, type, duration } = currentUnsubscribe;
                button.textContent = 'Subscribe';
                button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                button.parentElement.querySelector('.cancel-btn').classList.add('hidden');
                delete activeSubscriptions[type];
                showModal('unsubscribeModal3');
                currentUnsubscribe = null;
            } else {
                alert('Incorrect password.');
            }
        });

        document.getElementById('unsubscribeCancelBtn4').addEventListener('click', () => {
            closeModal('unsubscribePasswordModal');
            currentUnsubscribe = null;
        });

        // Unsubscribe Modal Step 5: Final Message
        document.getElementById('unsubscribeCloseBtn').addEventListener('click', () => {
            closeModal('unsubscribeModal3');
        });

        // Delete Account Flow
        document.getElementById('leaveAstegniBtn').addEventListener('click', () => {
            if (isAccountDeleted) {
                alert('Your account is already deleted.');
                return;
            }
            showModal('deleteModal1');
        });

        // Delete Modal Step 1: Reasons
        document.getElementById('deleteOther').addEventListener('change', (e) => {
            document.getElementById('otherTextDelete').style.display = e.target.checked ? 'block' : 'none';
        });

        document.getElementById('deleteSubmitBtn').addEventListener('click', () => {
            const reasons = Array.from(document.querySelectorAll('input[name="deleteReason"]:checked')).map(input => input.value);
            const otherText = document.getElementById('otherTextDelete').value;
            if (reasons.length === 0) {
                alert('Please select at least one reason.');
                return;
            }
            if (reasons.includes('other') && !otherText) {
                alert('Please specify the reason for "Other".');
                return;
            }
            closeModal('deleteModal1');
            // Check verification status and calculate fee
            const verificationFee = verificationStatus === 'Verified' ? 990 * 0.15 : 0;
            document.getElementById('deleteVerifyText').textContent = `This decision will unverify and deactivate your account. A 15% verification fee (${verificationFee.toFixed(2)} ETB) will be charged if applicable.`;
            showModal('deleteVerifyModal');
        });

        document.getElementById('deleteCancelBtn1').addEventListener('click', () => {
            closeModal('deleteModal1');
        });

        // Delete Modal Step 2: Verification Check
        document.getElementById('deleteYesBtn').addEventListener('click', () => {
            closeModal('deleteVerifyModal');
            // Check for active subscriptions
            if (Object.keys(activeSubscriptions).length > 0) {
                showModal('deleteSubscriptionCheckModal');
            } else {
                showModal('deleteConfirm2');
            }
        });

        document.getElementById('deleteCancelBtn2').addEventListener('click', () => {
            closeModal('deleteVerifyModal');
        });

        // Delete Modal Step 3: Subscription Check
        document.getElementById('deleteCancelBtn3').addEventListener('click', () => {
            closeModal('deleteSubscriptionCheckModal');
        });

        // Delete Modal Step 4: Password
        document.getElementById('deleteSubmitPasswordBtn').addEventListener('click', () => {
            const password = document.getElementById('deletePassword').value;
            if (!password) {
                alert('Please enter your password.');
                return;
            }
            // Mock password check
            if (password === 'password123') {
                closeModal('deleteConfirm2');
                isAccountDeleted = true;
                verificationStatus = 'Not Verified';
                activeSubscriptions = {};
                profile = {
                    name: 'Not set',
                    gender: 'Not set',
                    phone: 'Not set',
                    email: 'Not set',
                    quote: 'Not set',
                    address: 'Not set',
                    school: 'Not set'
                };
                updateVerificationCard();
                showModal('deleteModal3');
            } else {
                alert('Incorrect password.');
            }
        });

        document.getElementById('deleteCancelBtn4').addEventListener('click', () => {
            closeModal('deleteConfirm2');
        });

        // Delete Modal Step 5: Final Message
        document.getElementById('deleteCloseBtn').addEventListener('click', () => {
            closeModal('deleteModal3');
        });

        // Analytics Chart
        let analyticsChart = null;
        function updateAnalyticsChart() {
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            const period = document.getElementById('analyticsPeriod').value;
            let labels, incomeData, paymentData;

            switch (period) {
                case '1-day':
                    labels = ['Day 1'];
                    incomeData = [7500];
                    paymentData = [3000];
                    break;
                case '3-days':
                    labels = ['Day 1', 'Day 2', 'Day 3'];
                    incomeData = [2500, 3000, 2000];
                    paymentData = [1000, 1200, 800];
                    break;
                case '1-week':
                    labels = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
                    incomeData = [1000, 1200, 1100, 1300, 1400, 1100, 900];
                    paymentData = [400, 500, 450, 550, 600, 400, 300];
                    break;
                case '2-weeks':
                    labels = Array.from({ length: 14 }, (_, i) => `Day ${i + 1}`);
                    incomeData = Array(14).fill(0).map(() => Math.random() * 1000 + 500);
                    paymentData = Array(14).fill(0).map(() => Math.random() * 400 + 100);
                    break;
                case '1-month':
                    labels = Array.from({ length: 30 }, (_, i) => `Day ${i + 1}`);
                    incomeData = Array(30).fill(0).map(() => Math.random() * 1000 + 500);
                    paymentData = Array(30).fill(0).map(() => Math.random() * 400 + 100);
                    break;
                case '3-months':
                    labels = ['Month 1', 'Month 2', 'Month 3'];
                    incomeData = [7500, 8000, 7000];
                    paymentData = [3000, 3200, 2800];
                    break;
                case '6-months':
                    labels = ['Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6'];
                    incomeData = [7500, 8000, 7000, 7200, 7600, 7400];
                    paymentData = [3000, 3200, 2800, 2900, 3100, 3000];
                    break;
                case '1-year':
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    incomeData = [7500, 8000, 7000, 7200, 7600, 7400, 7800, 7900, 7700, 7500, 7300, 7400];
                    paymentData = [3000, 3200, 2800, 2900, 3100, 3000, 3100, 3200, 3000, 2900, 2800, 3000];
                    break;
                default:
                    labels = ['Day 1'];
                    incomeData = [7000];
                    paymentData = [3000];
            }

            if (analyticsChart) {
                analyticsChart.destroy();
            }

            analyticsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Income (ETB)',
                            data: incomeData,
                            borderColor: 'rgb(75, 192, 192)',
                            fill: false
                        },
                        {
                            label: 'Payments (ETB)',
                            data: paymentData,
                            borderColor: 'rgb(255, 99, 132)',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        document.getElementById('analyticsPeriod').addEventListener('change', updateAnalyticsChart);

        // Toggle Income Visibility
        document.getElementById('toggleIncome').addEventListener('click', () => {
            const totalIncome = document.getElementById('totalIncome');
            totalIncome.textContent = totalIncome.textContent.includes('★★★') ? 'Total Income: 7500 ETB' : 'Total Income: ★★★';
        });

        // Open Manage Finances Modal
        document.getElementById('manage-finance-btn').addEventListener('click', openManageFinances);

        // Close Manage Finances Modal
        document.getElementById('closeModal').addEventListener('click', () => {
            closeModal('manageFinanceModal');
        });

        // Close Manage Subscription Modal
        document.getElementById('closeManageModal').addEventListener('click', () => {
            closeModal('manageSubscriptionModal');
        });

        // Edit Profile Modal Handling
        document.getElementById('edit-verify-profile-btn').addEventListener('click', () => {
            document.getElementById('profile-name').value = profile.name !== 'Not set' ? profile.name : '';
            document.getElementById('profile-gender').value = profile.gender !== 'Not set' ? profile.gender : '';
            document.getElementById('profile-phone').value = profile.phone !== 'Not set' ? profile.phone : '';
            document.getElementById('profile-email').value = profile.email !== 'Not set' ? profile.email : '';
            document.getElementById('profile-quote').value = profile.quote !== 'Not set' ? profile.quote : '';
            document.getElementById('profile-address').value = profile.address !== 'Not set' ? profile.address : '';
            document.getElementById('profile-school').value = profile.school !== 'Not set' ? profile.school : '';
            document.getElementById('face-scan-status').textContent = 'No selfie captured.';
            document.getElementById('id-preview').innerHTML = '';
            showModal('edit-verify-profile-modal');
        });

        // Save Profile Button
        document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);

        // Cancel Profile Button
        document.getElementById('cancelProfileBtn').addEventListener('click', () => {
            closeModal('edit-verify-profile-modal');
        });

        // School Search with Suggestions
        document.getElementById('profile-school').addEventListener('input', (e) => {
            const input = e.target.value.toLowerCase();
            const suggestionsContainer = document.getElementById('school-suggestions');
            const mockSchools = ['Addis Ababa University', 'Unity University', 'St. Mary School', 'Hillside School'];
            suggestionsContainer.innerHTML = '';
            const requestSchoolBtn = document.getElementById('request-school-btn');
            requestSchoolBtn.classList.add('hidden');

            if (input) {
                const filteredSchools = mockSchools.filter(school =>
                    school.toLowerCase().includes(input) || levenshteinDistance(school.toLowerCase(), input) <= 2
                );
                if (filteredSchools.length > 0) {
                    filteredSchools.forEach(school => {
                        const div = document.createElement('div');
                        div.className = 'p-2 hover:bg-gray-100 cursor-pointer';
                        div.textContent = school;
                        div.onclick = () => {
                            document.getElementById('profile-school').value = school;
                            suggestionsContainer.classList.add('hidden');
                        };
                        suggestionsContainer.appendChild(div);
                    });
                    suggestionsContainer.classList.remove('hidden');
                } else {
                    suggestionsContainer.classList.add('hidden');
                    requestSchoolBtn.classList.remove('hidden');
                }
            } else {
                suggestionsContainer.classList.add('hidden');
            }
        });

        // Request School Listing
        document.getElementById('request-school-btn').addEventListener('click', () => {
            document.getElementById('request-school-name').value = document.getElementById('profile-school').value;
            showModal('request-school-modal');
        });

        // Submit School Request
        document.getElementById('submitSchoolRequestBtn').addEventListener('click', () => {
            const schoolName = document.getElementById('request-school-name').value;
            const phone = document.getElementById('request-school-phone').value;
            const email = document.getElementById('request-school-email').value;
            const location = document.getElementById('request-school-location').value;

            if (!schoolName || !phone || !email || !location) {
                alert('Please fill in all required fields.');
                return;
            }

            // Add to pending schools
            pendingSchools.push(schoolName);
            closeModal('request-school-modal');
            if (tempProfile) {
                profile = tempProfile;
                tempProfile = null;
                closeModal('edit-verify-profile-modal');
                updateVerificationCard();
                alert('Profile updated and school request submitted successfully!');
                previousSchool = profile.school;
            } else {
                alert('School request submitted successfully!');
            }
        });

        // Cancel School Request
        document.getElementById('cancelSchoolRequestBtn').addEventListener('click', () => {
            closeModal('request-school-modal');
            if (tempProfile) {
                document.getElementById('profile-school').value = previousSchool;
                tempProfile = null;
            }
        });

        // Use My Location
        document.getElementById('use-my-location').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        // Mock geocoding
                        document.getElementById('profile-address').value = `Lat: ${latitude.toFixed(4)}, Lon: ${longitude.toFixed(4)}`;
                        document.getElementById('location-error').classList.add('hidden');
                    },
                    () => {
                        document.getElementById('location-error').classList.remove('hidden');
                    }
                );
            } else {
                document.getElementById('location-error').classList.remove('hidden');
            }
        });

        // ID File Upload
        document.getElementById('id-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const idError = document.getElementById('id-error');
            const idPreview = document.getElementById('id-preview');
            idPreview.innerHTML = '';
            idError.classList.add('hidden');

            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    idError.classList.remove('hidden');
                    return;
                }
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-full h-32 object-cover rounded-md';
                    idPreview.appendChild(img);
                } else if (file.type === 'application/pdf') {
                    idPreview.innerHTML = `<p>Uploaded PDF: ${file.name}</p>`;
                }
            }
        });

        // Face Scan
        document.getElementById('face-scan-btn').addEventListener('click', () => {
            // Mock face scan
            document.getElementById('face-scan-status').textContent = 'Selfie captured successfully!';
        });

        // Initialize
        updateVerificationCard();
        displayCourses();
        updateAnalyticsChart();
    </script>
</body>
</html>