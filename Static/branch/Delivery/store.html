<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astegni Store</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .sidebar {
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      top: 64px;
      height: calc(100vh - 64px);
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .modal {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    .modal.open {
      opacity: 1;
      display: flex;
    }

    .modal-content {
      overflow-y: auto;
      max-height: 80vh;
      scrollbar-width: thin;
      scrollbar-color: #888 #f1f1f1;
    }

    .modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .modal-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .modal-content::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .book-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .favorite-icon.favorited {
      color: #f1c40f;
      transform: scale(1.2);
      transition: transform 0.2s ease;
    }

    .category-title:hover {
      color: #3498db;
      text-decoration: underline;
      cursor: pointer;
    }

    .ad-placeholder {
      position: sticky;
      top: 80px;
      right: 0;
      width: 300px;
      height: 250px;
      background-color: #dfe4ea;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .category-ad-placeholder {
      width: 100%;
      height: 100px;
      background-color: #dfe4ea;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #333;
      text-align: center;
    }

    .search-input {
      color: #333 !important;
      background-color: #fff !important;
    }

    .search-input::placeholder {
      color: #666;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 50;
    }

    .dropdown-menu.active {
      display: block;
    }

    .notification-icon {
      position: relative;
    }

    .notification-icon::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 8px;
      height: 8px;
      background-color: red;
      border-radius: 50%;
      display: none;
    }

    .notification-icon.active::after {
      display: block;
    }

    .theme-toggle::before {
      content: '‚òÄÔ∏è';
    }

    .dark .theme-toggle::before {
      content: 'üåô';
    }

    .dark {
      background-color: #1a202c;
      color: #e2e8f0;
    }

    .dark .bg-white {
      background-color: #2d3748;
    }

    .dark .bg-gray-100 {
      background-color: #1a202c;
    }

    .dark .bg-gray-800 {
      background-color: #2d3748;
    }

    .dark .text-gray-800 {
      color: #e2e8f0;
    }

    .dark .text-gray-600 {
      color: #a0aec0;
    }

    .dark .category-ad-placeholder {
      background-color: #4a5568;
      color: #e2e8f0;
    }

    .dark .ad-placeholder {
      background-color: #4a5568;
      color: #e2e8f0;
    }

    @media (max-width: 1024px) {
      .ad-placeholder {
        width: 100%;
        height: 100px;
        position: static;
        margin-bottom: 1rem;
      }
    }

    @media (max-width: 640px) {
      .sidebar {
        width: 100%;
        top: 64px;
        height: calc(100vh - 64px);
      }

      .content {
        padding: 1rem;
        margin-top: 64px;
      }

      .nav-container {
        padding: 0.5rem;
      }

      .modal-content {
        width: 95%;
        max-height: 90vh;
      }

      .nav-container .flex.items-center.space-x-4 {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: #333;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: none;
      margin: 0 auto;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body class="font-sans bg-gray-100 relative">
  <!-- Navigation -->
  <nav
    class="bg-gray-800 text-white p-4 fixed top-0 left-0 w-full z-50 shadow-md flex items-center justify-between nav-container">
    <div class="flex items-center space-x-4">
      <button onclick="sidebarToggle()" class="hamburger-icon text-white hover:text-blue-500 focus:outline-none"
        aria-label="Toggle sidebar">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
      <a href="index.html" class="text-lg font-semibold text-white hover:text-blue-400" aria-label="Home">Astegni</a>
    </div>
    <div class="flex items-center space-x-4">
      <input type="text" id="search-input"
        class="search-input p-2 border rounded-lg w-64 focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="Search books..." aria-label="Search books">
      <a href="#" onclick="showStore()" class="text-white hover:text-blue-400" aria-label="Store">Store</a>
      <a href="#" onclick="showBooks()" class="text-white hover:text-blue-400" aria-label="Books">Books</a>
      <a href="#" onclick="showGames()" class="text-white hover:text-blue-400" aria-label="Games">Games</a>
      <a href="News.html" class="text-white hover:text-blue-400" aria-label="Find Tutors">News</a>
      <a href="find-tutors.html" class="text-white hover:text-blue-400" aria-label="Find Tutors">Find Tutors</a>
      <a href="reels.html" class="text-white hover:text-blue-400" aria-label="Reels">Reels</a>
      <a href="find-jobs.html" class="text-white hover:text-blue-400" aria-label="Find Tutors">Find jobs</a>
      <div class="relative">
        <a href="profile.html" class="flex items-center space-x-2 text-white hover:text-blue-400 focus:outline-none"
          aria-label="Profile" onclick="toggleProfileDropdown(event)">
          <img src="https://picsum.photos/seed/profile/32/32" alt="Profile Picture" class="w-8 h-8 rounded-full">
          <span>Profile</span>
        </a>
        <div id="profileDropdown" class="dropdown-menu">
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Notes">Notes</a>
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Manage Finances">Manage
            Finances</a>
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100"
            aria-label="Comment and Rate Astegni">Comment and Rate Astegni</a>
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Books">Books</a>
        </div>
      </div>
      <button onclick="openNotificationModal()"
        class="notification-icon text-white hover:text-blue-400 focus:outline-none" aria-label="Notifications">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
          </path>
        </svg>
      </button>
      <button onclick="toggleTheme()" class="theme-toggle text-white hover:text-blue-400 focus:outline-none"
        aria-label="Toggle Theme"></button>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="sidebar fixed w-64 bg-gray-100 text-gray-800 p-4 z-40 overflow-y-auto shadow-lg" id="sidebar">
    <nav class="flex flex-col space-y-2">
      <a href="#" onclick="showStore()" class="text-gray-800 hover:text-blue-600 font-medium"
        aria-label="Store">Store</a>
      <a href="#" onclick="showBooks()" class="text-gray-800 hover:text-blue-600 font-medium"
        aria-label="Books">Books</a>
      <a href="#" onclick="showCategory('fiction')" class="indent text-gray-800 hover:text-blue-400 pl-4"
        aria-label="Fiction">Fiction</a>
      <a href="#" onclick="showCategory('fantasy')" class="sub-indent text-gray-800 hover:text-blue-400 pl-8"
        aria-label="Fantasy">Fantasy</a>
      <a href="#" onclick="showCategory('scifi')" class="sub-indent text-gray-800 hover:text-blue-400 pl-8"
        aria-label="Sci-Fi">Sci-Fi</a>
      <a href="#" onclick="showCategory('romance')" class="sub-indent text-gray-800 hover:text-blue-400 pl-8"
        aria-label="Romance">Romance</a>
      <a href="#" onclick="showCategory('nonfiction')" class="indent text-gray-800 hover:text-blue-400 pl-4"
        aria-label="Non-Fiction">Non-Fiction</a>
      <a href="#" onclick="showCategory('academics')" class="sub-indent text-gray-800 hover:text-blue-400 pl-8"
        aria-label="Academics">Academics</a>
      <a href="#" onclick="showCategory('theology')" class="sub-indent text-gray-800 hover:text-blue-400 pl-8"
        aria-label="Theology">Theology</a>
      <a href="#" onclick="showGames()" class="text-gray-800 hover:text-blue-600 font-medium"
        aria-label="Games">Games</a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="content max-w-7xl mx-auto pt-20 flex flex-col lg:flex-row gap-6">
    <!-- Books and Filters -->
    <div class="flex-1">
      <div class="filters bg-white p-4 rounded-lg shadow mb-6 hidden" id="bookFilters">
        <div class="flex flex-wrap gap-4 justify-center">
          <label class="flex items-center"><input type="checkbox" onchange="sortBooks('title')" class="mr-2"
              aria-label="Sort by title"> Sort by Title</label>
          <label class="flex items-center"><input type="checkbox" onchange="sortBooks('author')" class="mr-2"
              aria-label="Sort by author"> Sort by Author</label>
          <label class="flex items-center"><input type="checkbox" onchange="sortBooks('rating')" class="mr-2"
              aria-label="Sort by rating"> Sort by Rating</label>
        </div>
      </div>

      <div id="homeSection">
        <div class="category-section">
          <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showStore()"
            aria-label="View store">Store</h2>
          <div class="category-section">
            <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showBooks()"
              aria-label="View all books">Books</h2>
            <div id="noBooksMessage" class="hidden text-center text-gray-600 mb-4">
              <p>No books found.</p>
              <button onclick="openRequestBookModal()"
                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2"
                aria-label="Request a book">Request Book</button>
            </div>
            <div class="category-section">
              <div class="category-ad-placeholder">Trending Fiction Books</div>
              <h3 class="category-title text-xl font-semibold text-gray-800 mb-4" onclick="showCategory('fiction')"
                aria-label="View Fiction books">Fiction</h3>
              <div class="category-section">
                <div class="category-ad-placeholder">This Week's Fantasy Books</div>
                <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('fantasy')"
                  aria-label="View Fantasy books">Fantasy</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="homeFantasyBooks"></div>
              </div>
              <div class="category-section">
                <div class="category-ad-placeholder">This Week's Sci-Fi Books</div>
                <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('scifi')"
                  aria-label="View Sci-Fi books">Sci-Fi</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="homeScifiBooks"></div>
              </div>
              <div class="category-section">
                <div class="category-ad-placeholder">This Week's Romance Books</div>
                <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('romance')"
                  aria-label="View Romance books">Romance</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="homeRomanceBooks"></div>
              </div>
            </div>
            <div class="category-section">
              <div class="category-ad-placeholder">Trending Non-Fiction Books</div>
              <h3 class="category-title text-xl font-semibold text-gray-800 mb-4" onclick="showCategory('nonfiction')"
                aria-label="View Non-Fiction books">Non-Fiction</h3>
              <div class="category-section">
                <div class="category-ad-placeholder">This Week's Academic Books</div>
                <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('academics')"
                  aria-label="View Academics books">Academics</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="homeAcademicsBooks"></div>
              </div>
              <div class="category-section">
                <div class="category-ad-placeholder">This Week's Theology Books</div>
                <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('theology')"
                  aria-label="View Theology books">Theology</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="homeTheologyBooks"></div>
              </div>
            </div>
          </div>
          <div class="category-section">
            <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showGames()"
              aria-label="View all games">Games</h2>
            <div class="coming-soon text-gray-600">Games - Coming Soon</div>
          </div>
        </div>
      </div>

      <div id="booksSection" class="hidden">
        <div class="category-section">
          <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showBooks()"
            aria-label="View all books">Books</h2>
          <div id="noBooksMessageBooks" class="hidden text-center text-gray-600 mb-4">
            <p>No books found.</p>
            <button onclick="openRequestBookModal()"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2"
              aria-label="Request a book">Request Book</button>
          </div>
          <div class="category-section" id="fictionSection">
            <div class="category-ad-placeholder">Trending Fiction Books</div>
            <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showCategory('fiction')"
              aria-label="View Fiction books">Fiction</h2>
            <div class="category-section">
              <div class="category-ad-placeholder">This Week's Fantasy Books</div>
              <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('fantasy')"
                aria-label="View Fantasy books">Fantasy</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="fantasyBooks"></div>
            </div>
            <div class="category-section">
              <div class="category-ad-placeholder">This Week's Sci-Fi Books</div>
              <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('scifi')"
                aria-label="View Sci-Fi books">Sci-Fi</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="scifiBooks"></div>
            </div>
            <div class="category-section">
              <div class="category-ad-placeholder">This Week's Romance Books</div>
              <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('romance')"
                aria-label="View Romance books">Romance</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="romanceBooks"></div>
            </div>
          </div>
          <div class="category-section" id="nonfictionSection">
            <div class="category-ad-placeholder">Trending Non-Fiction Books</div>
            <h2 class="category-title text-2xl font-bold text-gray-800 mb-4" onclick="showCategory('nonfiction')"
              aria-label="View Non-Fiction books">Non-Fiction</h2>
            <div class="category-section">
              <div class="category-ad-placeholder">This Week's Academic Books</div>
              <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('academics')"
                aria-label="View Academics books">Academics</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="academicsBooks"></div>
            </div>
            <div class="category-section">
              <div class="category-ad-placeholder">This Week's Theology Books</div>
              <h3 class="category-title text-lg font-semibold text-gray-800 mb-2" onclick="showCategory('theology')"
                aria-label="View Theology books">Theology</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="theologyBooks"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="gamesSection" class="hidden">
        <div class="coming-soon text-gray-600">Games - Coming Soon</div>
      </div>
    </div>

    <!-- Ad Placeholder -->
    <div class="ad-placeholder hidden lg:flex">
      <p class="text-gray-600">Ad Placeholder (300x250)</p>
    </div>
  </div>

  <!-- Modals -->
  <div id="notificationModal"
    class="modal hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 justify-center items-center z-50">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12 max-w-lg">
      <span class="close text-gray-800 text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close notification modal">√ó</span>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notifications</h2>
      <div id="notificationContent" class="text-gray-600">
        <p>No new notifications.</p>
      </div>
    </div>
  </div>

  <div id="authorModal"
    class="modal hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 justify-center items-center z-50">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12 max-w-3xl">
      <span class="close text-gray-800 text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close modal">√ó</span>
      <div class="spinner" id="modalSpinner"></div>
      <img src="" id="authorCoverPhoto" alt="Author Cover" class="w-full h-40 object-cover rounded mb-4">
      <div class="flex items-center gap-4 mb-4">
        <img src="" id="authorProfilePic" class="profile-pic w-24 h-24 rounded-full border-2 border-blue-500"
          alt="Author Profile">
        <div>
          <h2 id="authorName" class="text-2xl font-semibold text-gray-800"></h2>
          <button id="followButton" onclick="followAuthor()"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2" aria-label="Follow author"></button>
        </div>
      </div>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">About the Author</h3>
      <p id="authorAbout" class="text-gray-600 mb-4"></p>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Quotes</h3>
      <p id="authorQuotes" class="text-gray-600 mb-4"></p>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Socials</h3>
      <p id="authorSocials" class="text-gray-600 mb-4"></p>
      <button onclick="openReviews()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4"
        aria-label="View reviews">View Reviews</button>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Current Book</h3>
      <div id="currentBookDetails" class="mb-4"></div>
      <div class="tabs flex gap-2 mb-4">
        <div class="tab px-4 py-2 rounded bg-gray-200 text-gray-800 cursor-pointer hover:bg-gray-300 active-tab"
          data-tab="videos" onclick="showTab('videos')" aria-label="Show videos">Videos</div>
        <div class="tab px-4 py-2 rounded bg-gray-200 text-gray-800 cursor-pointer hover:bg-gray-300"
          data-tab="otherBooks" onclick="showTab('otherBooks')" aria-label="Show other books">Other Books by <span
            id="authorTabName"></span></div>
      </div>
      <div id="videos" class="tab-content">
        <div id="introVideo" class="mb-4"></div>
        <div class="sub-tabs flex gap-2 mb-4">
          <div
            class="sub-tab px-4 py-2 rounded bg-gray-200 text-gray-800 cursor-pointer hover:bg-gray-300 sub-tab-active"
            data-sub-tab="shorts" onclick="showSubTab('shorts')" aria-label="Show shorts">Shorts</div>
          <div class="sub-tab px-4 py-2 rounded bg-gray-200 text-gray-800 cursor-pointer hover:bg-gray-300"
            data-sub-tab="videos" onclick="showSubTab('videos')" aria-label="Show videos">Videos</div>
          <div class="sub-tab px-4 py-2 rounded bg-gray-200 text-gray-800 cursor-pointer hover:bg-gray-300"
            data-sub-tab="playlists" onclick="showSubTab('playlists')" aria-label="Show playlists">Playlists</div>
        </div>
        <div id="shorts" class="sub-tab-content"></div>
        <div id="videosSub" class="sub-tab-content hidden"></div>
        <div id="playlists" class="sub-tab-content hidden"></div>
      </div>
      <div id="otherBooks" class="tab-content hidden">
        <div id="authorOtherBooks" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
      </div>
    </div>
  </div>

  <div id="bookModal" class="modal hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 justify-center">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12">
      <span class="close text-white text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close modal">√ó</span>
      <div class="modal" id="bookModalSpinner"></div>
      <div id="bookVideo" class="mb-4"></div>
      <h2 id="bookTitle" class="text-2xl font-semibold text-gray-800 mb-2"></h2>
      <p id="bookAuthorLink" class="text-blue-600 hover:underline" aria-label="View author profile"></p>
      <p id="bookDescription" class="text-gray-600 mb-4"></p>
      <div class="flex flex-wrap gap-4 mb-4">
        <p id="bookRating" class="text-gray-600"></p>
        <p id="bookPrice" class="text-gray-600"></p>
        <button onclick="addToCartFromModal()" class="bg-green-600 text-white px-4 py-2 hover:bg-green-700"
          aria-label="Add to cart">Add to Cart</button>
        <button onclick="addToWishlist()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700"
          aria-label="Add to wishlist">Add to Wishlist</button>
        <button onclick="openReviews()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
          aria-label="View reviews">View Reviews</button>
      </div>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">You May Also Like</h3>
      <div id="relatedBooks" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
    </div>
  </div>

  <div id="reviewsModal"
    class="modal hidden fixed top-0 left-0 full-width h-full bg-black bg-opacity-50 justify-center items-center z-50">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12 max-w-lg">
      <span class="close text-gray-800 text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close modal">√ó</span>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Reviews</h2>
      <div id="bookReviews" class="text-gray-600"></div>
    </div>
  </div>

  <div id="ratingCommentModal"
    class="modal hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 justify-center items-center z-50">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12 max-w-lg">
      <span class="close text-gray-800 text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close rating modal">√ó</span>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Rate & Comment</h2>
      <div class="rating-section mb-4">
        <label class="block text-gray-800 mb-2">Rate Author:</label>
        <select id="authorRating" class="w-full p-2 border rounded" aria-label="Select author rating">
          <option value="1">1 Star</option>
          <option value="2">2 Stars</option>
          <option value="3">3 Stars</option>
          <option value="4">4 Stars</option>
          <option value="5">5 Stars</option>
        </select>
        <div class="comment-section mt-2">
          <label class="block text-gray-800 mb-2">Comment on Author:</label>
          <textarea id="authorComment" class="w-full p-2 border rounded" placeholder="Your comment"
            aria-label="Author comment"></textarea>
        </div>
        <button onclick="submitAuthorRatingComment()"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2"
          aria-label="Submit author rating">Submit Author Rating</button>
      </div>
      <div class="rating-section mb-4">
        <label class="block text-gray-800 mb-2">Rate Book:</label>
        <select id="bookRating" class="w-full p-2 border rounded" aria-label="Select book rating">
          <option value="1">1 Star</option>
          <option value="2">2 Stars</option>
          <option value="3">3 Stars</option>
          <option value="4">4 Stars</option>
          <option value="5">5 Stars</option>
        </select>
        <div class="comment-section mt-4">
          <label class="block text-gray-800 mb-2">Comment on Book:</label>
          <textarea id="bookComment" class="w-full p-2 border rounded" placeholder="Your comment"
            aria-label="Book comment"></textarea>
        </div>
        <button onclick="submitBookRatingComment()"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2" aria-label="Submit book rating">Submit
          Book Rating</button>
      </div>
      <button onclick="closeModal()" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-600"
        aria-label="Close rating modal">Close</button>
    </div>
  </div>

  <div id="requestBookModal"
    class="modal hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 justify-center items-center z-50">
    <div class="modal-content bg-white p-6 rounded-lg w-11/12 max-w-lg">
      <span class="close text-gray-800 text-2xl cursor-pointer float-right" onclick="closeModal()"
        aria-label="Close request book modal">√ó</span>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Request a Book</h2>
      <div class="mb-4">
        <label for="requestBookTitle" class="block text-gray-800 mb-2">Book Title (Optional):</label>
        <input type="text" id="requestBookTitle" class="w-full p-2 border rounded" placeholder="Enter book title"
          aria-label="Book title">
      </div>
      <div class="mb-4">
        <label for="requestBookAuthor" class="block text-gray-800 mb-2">Author (Optional):</label>
        <input type="text" id="requestBookAuthor" class="w-full p-2 border rounded" placeholder="Enter author name"
          aria-label="Author name">
      </div>
      <div class="mb-4">
        <label for="requestPublishedYear" class="block text-gray-800 mb-2">Published Year (Optional):</label>
        <input type="text" id="requestPublishedYear" class="w-full p-2 border rounded"
          placeholder="Enter publication year" aria-label="Published year">
      </div>
      <div class="mb-4">
        <label for="requestBookDescription" class="block text-gray-800 mb-2">Description (Optional):</label>
        <textarea id="requestBookDescription" class="w-full p-2 border rounded" placeholder="Enter book description"
          aria-label="Book description"></textarea>
      </div>
      <button onclick="submitBookRequest()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        aria-label="Submit book request">Submit Request</button>
      <button onclick="closeModal()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-300 mt-2"
        aria-label="Close modal">Cancel</button>
    </div>
  </div>

  <script>
    // Mock Data
    const books = [
      { id: 'b1', title: "The Dragon's Quest", author: 'Elara Stone', authorId: 'author1', genre: 'fiction', subGenre: 'fantasy', bookstore: 'Knowledge Hub', price: 19.99, rating: 4.58, raters: 123, cover: 'https://picsum.photos/seed/fantasy1/200/300', description: 'An epic journey through a mythical land.' },
      { id: 'b2', title: 'Sword of Destiny', author: 'Elara Stone', authorId: 'author1', genre: 'fiction', subGenre: 'fantasy', bookstore: 'Knowledge Hub', price: 22.50, rating: 4.77, raters: 89, cover: 'https://picsum.photos/seed/fantasy2/200/300', description: 'A tale of courage and fate, centered on a legendary sword.' },
      { id: 'b3', title: 'The Enchanted Realm', author: 'Mira Vale', authorId: 'author2', genre: 'fiction', subGenre: 'fantasy', bookstore: 'Magic Reads', price: 18.99, rating: 4.6, raters: 156, cover: 'https://picsum.photos/seed/fantasy3/200/300', description: 'A magical world filled with wonder and danger.' },
      { id: 'b4', title: 'Crown of Shadows', author: 'Mira Vale', authorId: 'author2', genre: 'fiction', subGenre: 'fantasy', bookstore: 'Magic Reads', price: 20.99, rating: 4.88, raters: 101, cover: 'https://picsum.photos/seed/fantasy4/200/300', description: 'A dark fantasy saga of power and betrayal.' },
      { id: 'b5', title: 'Starship Chronicles', author: 'Jaxon Reed', authorId: 'author3', genre: 'fiction', subGenre: 'scifi', bookstore: 'Learn & Play', price: 24.99, rating: 4.22, raters: 78, cover: 'https://picsum.photos/seed/scifi1/200/300', description: 'Adventures aboard a starship exploring unknown galaxies.' },
      { id: 'b6', title: 'Galactic Outlaws', author: 'Jaxon Reed', authorId: 'author3', genre: 'fiction', subGenre: 'scifi', bookstore: 'Learn & Play', price: 23.99, rating: 4.33, raters: 90, cover: 'https://picsum.photos/seed/scifi2/200/300', description: 'A thrilling sci-fi tale of rebels and rogues.' },
      { id: 'b7', title: 'Time Vortex', author: 'Luna Starr', authorId: 'author4', genre: 'fiction', subGenre: 'scifi', bookstore: 'Sci-Fi Store', price: 21.99, rating: 4.5, raters: 100, cover: 'https://picsum.photos/seed/scifi3/200/300', description: 'A mind-bending journey through time and space.' },
      { id: 'b8', title: 'Cyber Dawn', author: 'Luna Starr', authorId: 'author4', genre: 'fiction', subGenre: 'scifi', bookstore: 'Sci-Fi Store', price: 22.99, rating: 4.44, raters: 85, cover: 'https://picsum.photos/seed/scifi4/200/300', description: 'A futuristic world where technology rules.' },
      { id: 'b9', title: 'Quantum Mechanics', author: 'John Doe', authorId: 'author5', genre: 'nonfiction', subGenre: 'academics', bookstore: 'Learn & Play', price: 29.99, rating: 4.88, raters: 200, cover: 'https://picsum.photos/seed/quantum/200/300', description: 'A comprehensive guide to quantum physics.' },
      { id: 'b10', title: 'Relativity Explained', author: 'John Doe', authorId: 'author5', genre: 'nonfiction', subGenre: 'academics', bookstore: 'Learn & Play', price: 27.99, rating: 4.77, raters: 180, cover: 'https://picsum.photos/seed/relativity/200/300', description: 'An accessible introduction to Einstein‚Äôs theories.' },
      { id: 'b11', title: 'The Universe Unveiled', author: 'Emma Wright', authorId: 'author6', genre: 'nonfiction', subGenre: 'academics', bookstore: 'Science Reads', price: 25.99, rating: 4.99, raters: 150, cover: 'https://picsum.photos/seed/universe/200/300', description: 'Exploring the mysteries of the cosmos.' },
      { id: 'b12', title: 'Biology Today', author: 'Emma Wright', authorId: 'author6', genre: 'nonfiction', subGenre: 'academics', bookstore: 'Science Reads', price: 26.99, rating: 4.66, raters: 130, cover: 'https://picsum.photos/seed/biology/200/300', description: 'Modern insights into biological sciences.' },
      { id: 'b13', title: 'Mere Christianity', author: 'C.S. Lewis', authorId: 'author7', genre: 'nonfiction', subGenre: 'theology', bookstore: 'Faith Books', price: 14.99, rating: 4.88, raters: 300, cover: 'https://picsum.photos/seed/theology1/200/300', description: 'A classic exploration of Christian faith.' },
      { id: 'b14', title: 'The Screwtape Letters', author: 'C.S. Lewis', authorId: 'author7', genre: 'nonfiction', subGenre: 'theology', bookstore: 'Faith Books', price: 15.99, rating: 4.7, raters: 250, cover: 'https://picsum.photos/seed/theology2/200/300', description: 'A satirical take on spiritual warfare.' },
      { id: 'b15', title: 'Faith and Reason', author: 'Thomas Kane', authorId: 'author8', genre: 'nonfiction', subGenre: 'theology', bookstore: 'Faith Books', price: 16.99, rating: 4.5, raters: 160, cover: 'https://picsum.photos/seed/theology3/200/300', description: 'Bridging faith and rational thought.' },
      { id: 'b16', title: 'Spiritual Journeys', author: 'Thomas Kane', authorId: 'author8', genre: 'nonfiction', subGenre: 'theology', bookstore: 'Faith Books', price: 17.99, rating: 4.6, raters: 140, cover: 'https://picsum.photos/seed/theology4/200/300', description: 'Personal stories of spiritual growth.' },
      { id: 'b17', title: 'Hearts Entwined', author: 'Clara Rose', authorId: 'author9', genre: 'fiction', subGenre: 'romance', bookstore: 'Love Reads', price: 15.99, rating: 4.3, raters: 95, cover: 'https://picsum.photos/seed/romance1/200/300', description: 'A passionate tale of love overcoming obstacles.' },
      { id: 'b18', title: 'Whispers of Forever', author: 'Clara Rose', authorId: 'author9', genre: 'fiction', subGenre: 'romance', bookstore: 'Love Reads', price: 16.99, rating: 4.4, raters: 110, cover: 'https://picsum.photos/seed/romance2/200/300', description: 'A story of enduring love across time.' },
      { id: 'b19', title: 'Love‚Äôs Last Chance', author: 'Lila Hart', authorId: 'author10', genre: 'fiction', subGenre: 'romance', bookstore: 'Love Reads', price: 14.99, rating: 4.2, raters: 85, cover: 'https://picsum.photos/seed/romance3/200/300', description: 'A heartfelt journey of second chances.' },
      { id: 'b20', title: 'Eternal Embrace', author: 'Lila Hart', authorId: 'author10', genre: 'fiction', subGenre: 'romance', bookstore: 'Love Reads', price: 17.99, rating: 4.5, raters: 120, cover: 'https://picsum.photos/seed/romance4/200/300', description: 'A romantic saga of unbreakable bonds.' }
    ];

    const authorData = {
      'author1': {
        name: 'Elara Stone',
        about: 'Renowned fantasy author with a passion for mythical worlds.',
        quotes: ['Imagination is the key to adventure.', 'Magic lies in every story.'],
        socials: { twitter: 'elara_stone', instagram: 'elara.stone' },
        reviews: ['Inspiring and creative!', 'Epic storytelling.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author1/100/100',
        coverPhoto: 'https://picsum.photos/seed/author1/600/150'
      },
      'author2': {
        name: 'Mira Vale',
        about: 'Fantasy author known for intricate worlds and compelling characters.',
        quotes: ['Every tale weaves a new destiny.', 'Dreams shape reality.'],
        socials: { twitter: 'mira_vale', instagram: 'mira.vale' },
        reviews: ['Captivating narratives!', 'A master of fantasy.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author2/100/100',
        coverPhoto: 'https://picsum.photos/seed/author2/600/150'
      },
      'author3': {
        name: 'Jaxon Reed',
        about: 'Sci-fi visionary exploring the cosmos.',
        quotes: ['The stars are our destiny.', 'Technology shapes the future.'],
        socials: { twitter: 'jaxon_reed', instagram: 'jaxon_reed' },
        reviews: ['Mind-bending narratives!', 'Innovative sci-fi plots.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author3/100/100',
        coverPhoto: 'https://picsum.photos/seed/author3/600/150'
      },
      'author4': {
        name: 'Luna Starr',
        about: 'Sci-fi author with a focus on time travel and cybernetics.',
        quotes: ['Time is a river we navigate.', 'The future is now.'],
        socials: { twitter: 'luna_starr', instagram: 'luna.starr' },
        reviews: ['Thrilling and thought-provoking!', 'A sci-fi gem.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author4/100/100',
        coverPhoto: 'https://picsum.photos/seed/author4/600/150'
      },
      'author5': {
        name: 'John Doe',
        about: 'Physicist and educator specializing in quantum mechanics.',
        quotes: ['Science unlocks the universe.', 'Knowledge is power.'],
        socials: { twitter: 'john_doe', instagram: 'john.doe' },
        reviews: ['Clear and insightful!', 'A must-read for science enthusiasts.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author5/100/100',
        coverPhoto: 'https://picsum.photos/seed/author5/600/150'
      },
      'author6': {
        name: 'Emma Wright',
        about: 'Academic author with expertise in cosmology and biology.',
        quotes: ['The universe is a book to read.', 'Life is the ultimate experiment.'],
        socials: { twitter: 'emma_wright', instagram: 'emma_wright' },
        reviews: ['Brilliant and accessible!', 'Deeply informative.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author6/100/100',
        coverPhoto: 'https://picsum.photos/seed/author6/600/150'
      },
      'author7': {
        name: 'C.S. Lewis',
        about: 'Theologian and author of inspirational works.',
        quotes: ['Faith shapes the soul.', 'Love is the greatest adventure.'],
        socials: { twitter: 'cs_lewis', instagram: 'cs_lewis' },
        reviews: ['Profound and thought-provoking!', 'Timeless wisdom.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author7/100/100',
        coverPhoto: 'https://picsum.photos/seed/author7/600/150'
      },
      'author8': {
        name: 'Thomas Kane',
        about: 'Theologian exploring the intersection of faith and reason.',
        quotes: ['Reason leads to faith.', 'Spirituality is a journey.'],
        socials: { twitter: 'thomas_kane', instagram: 'thomas_kane' },
        reviews: ['Insightful and inspiring!', 'A fresh perspective on theology.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author8/100/100',
        coverPhoto: 'https://picsum.photos/seed/author8/600/150'
      },
      'author9': {
        name: 'Clara Rose',
        about: 'Romance novelist with a flair for heartfelt stories.',
        quotes: ['Love conquers all.', 'Every heart has a story.'],
        socials: { twitter: 'clara_rose', instagram: 'clara.rose' },
        reviews: ['Heartwarming and emotional!', 'A romantic masterpiece.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author9/100/100',
        coverPhoto: 'https://picsum.photos/seed/author9/600/150'
      },
      'author10': {
        name: 'Lila Hart',
        about: 'Author of captivating romance novels.',
        quotes: ['Love is the ultimate adventure.', 'Hearts find a way.'],
        socials: { twitter: 'lila_hart', instagram: 'lila.hart' },
        reviews: ['Touching and beautifully written!', 'A romance classic.'],
        videos: { intro: ['https://www.youtube.com/embed/dQw4w9WgXcQ'], shorts: [], videos: [], playlists: [] },
        profilePic: 'https://picsum.photos/seed/author10/100/100',
        coverPhoto: 'https://picsum.photos/seed/author10/600/150'
      }
    };

    // Initialize currentUser with fallback
    let currentUser;
    try {
      const storedUser = localStorage.getItem('currentUser');
      currentUser = storedUser ? JSON.parse(storedUser) : { id: 'user1', favorites: [], following: [], ratings: [], profileType: 'default' };
      currentUser.favorites = Array.isArray(currentUser.favorites) ? currentUser.favorites : [];
      currentUser.following = Array.isArray(currentUser.following) ? currentUser.following : [];
      currentUser.ratings = Array.isArray(currentUser.ratings) ? currentUser.ratings : [];
      currentUser.profileType = currentUser.profileType || 'default';
    } catch (error) {
      console.error('Error parsing localStorage:', error);
      currentUser = { id: 'user1', favorites: [], following: [], ratings: [], profileType: 'default' };
    }

    let currentBookId = null;
    let currentAuthorId = null;
    let currentCategory = null;

    // Utility Functions
    const sanitizeInput = input => {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    };

    const showNotification = (message, type = 'info') => {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white ${type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'} z-50`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    };

    // Dynamic Profile Dropdown
    function updateProfileDropdown() {
      const dropdown = document.getElementById('profileDropdown');
      if (!dropdown) {
        console.error('Profile dropdown not found');
        return;
      }
      const defaultItems = `
        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Notes">Notes</a>
        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Manage Finances">Manage Finances</a>
        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Comment and Rate Astegni">Comment and Rate Astegni</a>
        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Books">Books</a>
      `;
      let additionalItems = '';
      if (currentUser.profileType === 'tutor') {
        additionalItems = `
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Tools">Tools</a>
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Take a Quiz">Take a Quiz</a>
        `;
      } else if (currentUser.profileType === 'student') {
        additionalItems = `
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Tools">Tools</a>
          <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" aria-label="Become a Tutor">Become a Tutor</a>
        `;
      }
      dropdown.innerHTML = defaultItems + additionalItems;
    }

    // Book Card Creation
    function createBookCard(book) {
      const isFavorited = Array.isArray(currentUser.favorites) && currentUser.favorites.includes(book.id);
      return `
        <div class="book-card bg-white rounded-lg shadow relative">
          <button class="favorite-icon absolute top-2 right-2 text-2xl ${isFavorited ? 'favorited' : ''}" onclick="addToFavorites('${book.id}')" aria-label="${isFavorited ? 'Remove from' : 'Add to'} favorites">${isFavorited ? '‚òÖ' : '‚òÜ'}</button>
          <img src="${book.cover}" alt="${sanitizeInput(book.title)} cover" class="w-full h-48 object-cover rounded-t-lg" loading="lazy">
          <div class="book-card-content p-4">
            <h3 class="text-lg font-semibold text-gray-800">${sanitizeInput(book.title)}</h3>
            <p class="text-gray-600">by <a href="#" class="author-link text-blue-600 hover:underline" onclick="openAuthorModal('${book.authorId}', '${book.id}')" aria-label="View ${sanitizeInput(book.author)}'s profile">${sanitizeInput(book.author)}</a></p>
            <p class="text-gray-600 italic">Posted by: <a href="view-bookstore.html" class="text-purple-600 hover:underline" aria-label="View bookstore ${sanitizeInput(book.bookstore)}">${sanitizeInput(book.bookstore)}</a></p>
            <p class="text-gray-600">Price: $${book.price.toFixed(2)}</p>
            <p class="text-gray-600">Rating: ${book.rating.toFixed(1)} <span class="text-yellow-500">‚òÖ</span> (${book.raters || 0})</p>
            <div class="actions flex gap-2 mt-2">
              <a href="#" onclick="openBookModal('${book.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex-1 text-center" aria-label="View details of ${sanitizeInput(book.title)}">View Details</a>
              <button onclick="addToCart('${book.id}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex-1" aria-label="Add ${sanitizeInput(book.title)} to cart">Add to Cart</button>
            </div>
          </div>
        </div>
      `;
    }

    // Populate Books
    function populateBooks(category = null, filteredBooks = books) {
      const containers = {
        homeFantasyBooks: filteredBooks.filter(b => b.subGenre === 'fantasy').slice(0, 3),
        homeScifiBooks: filteredBooks.filter(b => b.subGenre === 'scifi').slice(0, 3),
        homeRomanceBooks: filteredBooks.filter(b => b.subGenre === 'romance').slice(0, 3),
        homeAcademicsBooks: filteredBooks.filter(b => b.subGenre === 'academics').slice(0, 3),
        homeTheologyBooks: filteredBooks.filter(b => b.subGenre === 'theology').slice(0, 3),
        fantasyBooks: filteredBooks.filter(b => b.subGenre === 'fantasy'),
        scifiBooks: filteredBooks.filter(b => b.subGenre === 'scifi'),
        romanceBooks: filteredBooks.filter(b => b.subGenre === 'romance'),
        academicsBooks: filteredBooks.filter(b => b.subGenre === 'academics'),
        theologyBooks: filteredBooks.filter(b => b.subGenre === 'theology')
      };

      const noBooksMessages = [document.getElementById('noBooksMessage'), document.getElementById('noBooksMessageBooks')];

      if (filteredBooks.length === 0) {
        Object.keys(containers).forEach(id => {
          const container = document.getElementById(id);
          if (container) container.innerHTML = '';
        });
        noBooksMessages.forEach(msg => {
          if (msg) msg.classList.remove('hidden');
        });
        return;
      } else {
        noBooksMessages.forEach(msg => {
          if (msg) msg.classList.add('hidden');
        });
      }

      const categorySubGenres = {
        fiction: ['fantasy', 'scifi', 'romance'],
        nonfiction: ['academics', 'theology'],
        fantasy: ['fantasy'],
        scifi: ['scifi'],
        romance: ['romance'],
        academics: ['academics'],
        theology: ['theology']
      };

      Object.keys(containers).forEach(id => {
        const container = document.getElementById(id);
        if (!container) {
          console.warn(`Container with ID ${id} not found`);
          return;
        }
        if (category) {
          const subGenres = categorySubGenres[category] || [];
          const containerSubGenre = id.replace(/^(home|Books)/, '').toLowerCase();
          if (subGenres.includes(containerSubGenre)) {
            container.innerHTML = containers[id].map(book => createBookCard(book)).join('');
            container.parentElement.classList.remove('hidden');
          } else {
            container.innerHTML = '';
            container.parentElement.classList.add('hidden');
          }
        } else {
          container.innerHTML = containers[id].map(book => createBookCard(book)).join('');
          container.parentElement.classList.remove('hidden');
        }
      });
    }

    // Sort and Filter Books
    function sortBooks(criteria = null) {
      const searchInput = document.getElementById('search-input');
      const searchQuery = searchInput?.value?.toLowerCase() || '';
      let filteredBooks = [...books];
      if (searchQuery) {
        filteredBooks = filteredBooks.filter(b =>
          b.title.toLowerCase().includes(searchQuery) ||
          b.author.toLowerCase().includes(searchQuery) ||
          b.bookstore.toLowerCase().includes(searchQuery) ||
          b.description.toLowerCase().includes(searchQuery)
        );
      }
      if (criteria) {
        filteredBooks.sort((a, b) => {
          if (criteria === 'title') return a.title.localeCompare(b.title);
          if (criteria === 'author') return a.author.localeCompare(b.author);
          if (criteria === 'rating') return b.rating - a.rating;
          return 0;
        });
      }
      populateBooks(currentCategory, filteredBooks);
    }

    // Navigation Functions
    function showStore() {
      const sections = ['homeSection', 'booksSection', 'gamesSection'];
      const homeSection = document.getElementById('homeSection');
      const bookFilters = document.getElementById('bookFilters');
      const sidebar = document.getElementById('sidebar');
      const fictionSection = document.getElementById('fictionSection');
      const nonfictionSection = document.getElementById('nonfictionSection');
      if (homeSection && bookFilters && sidebar && fictionSection && nonfictionSection) {
        sections.forEach(id => {
          const section = document.getElementById(id);
          if (section) section.classList.add('hidden');
        });
        homeSection.classList.remove('hidden');
        bookFilters.classList.remove('hidden', 'lg:hidden');
        fictionSection.classList.remove('hidden');
        nonfictionSection.classList.remove('hidden');
        sidebar.classList.remove('active');
        currentCategory = null;
        populateBooks();
        sortBooks();
      } else {
        console.error('One or more section elements not found');
      }
    }

    function showBooks() {
      const sections = ['homeSection', 'booksSection', 'gamesSection'];
      const booksSection = document.getElementById('booksSection');
      const bookFilters = document.getElementById('bookFilters');
      const sidebar = document.getElementById('sidebar');
      const fictionSection = document.getElementById('fictionSection');
      const nonfictionSection = document.getElementById('nonfictionSection');
      if (booksSection && bookFilters && sidebar && fictionSection && nonfictionSection) {
        sections.forEach(id => {
          const section = document.getElementById(id);
          if (section) section.classList.add('hidden');
        });
        booksSection.classList.remove('hidden');
        bookFilters.classList.remove('hidden', 'lg:hidden');
        fictionSection.classList.remove('hidden');
        nonfictionSection.classList.remove('hidden');
        sidebar.classList.remove('active');
        currentCategory = null;
        populateBooks();
        sortBooks();
      } else {
        console.error('One or more books section elements not found');
      }
    }

    function showGames() {
      const sections = ['homeSection', 'booksSection', 'gamesSection'];
      const gamesSection = document.getElementById('gamesSection');
      const bookFilters = document.getElementById('bookFilters');
      const sidebar = document.getElementById('sidebar');
      if (gamesSection && bookFilters && sidebar) {
        sections.forEach(id => {
          const section = document.getElementById(id);
          if (section) section.classList.add('hidden');
        });
        gamesSection.classList.remove('hidden');
        bookFilters.classList.add('hidden', 'lg:hidden');
        sidebar.classList.remove('active');
        currentCategory = null;
      } else {
        console.error('One or more games section elements not found');
      }
    }

    function showCategory(category) {
      const booksSection = document.getElementById('booksSection');
      const homeSection = document.getElementById('homeSection');
      const gamesSection = document.getElementById('gamesSection');
      const bookFilters = document.getElementById('bookFilters');
      const sidebar = document.getElementById('sidebar');
      const fictionSection = document.getElementById('fictionSection');
      const nonfictionSection = document.getElementById('nonfictionSection');
      if (booksSection && homeSection && gamesSection && bookFilters && sidebar && fictionSection && nonfictionSection) {
        homeSection.classList.add('hidden');
        booksSection.classList.remove('hidden');
        gamesSection.classList.add('hidden');
        bookFilters.classList.remove('hidden', 'lg:hidden');
        sidebar.classList.remove('active');

        currentCategory = category;

        const subGenreSections = ['fantasy', 'scifi', 'romance', 'academics', 'theology'].map(s => document.getElementById(`${s}Books`)?.parentElement);
        subGenreSections.forEach(section => {
          if (section) section.classList.add('hidden');
        });

        if (category === 'fiction') {
          fictionSection.classList.remove('hidden');
          nonfictionSection.classList.add('hidden');
          ['fantasy', 'scifi', 'romance'].forEach(subGenre => {
            const subGenreSection = document.getElementById(`${subGenre}Books`)?.parentElement;
            if (subGenreSection) subGenreSection.classList.remove('hidden');
          });
        } else if (category === 'nonfiction') {
          fictionSection.classList.add('hidden');
          nonfictionSection.classList.remove('hidden');
          ['academics', 'theology'].forEach(subGenre => {
            const subGenreSection = document.getElementById(`${subGenre}Books`)?.parentElement;
            if (subGenreSection) subGenreSection.classList.remove('hidden');
          });
        } else {
          fictionSection.classList.remove('hidden');
          nonfictionSection.classList.remove('hidden');
          const subGenreSection = document.getElementById(`${category}Books`)?.parentElement;
          if (subGenreSection) {
            subGenreSection.classList.remove('hidden');
            subGenreSection.scrollIntoView({ behavior: 'smooth' });
          }
        }
        populateBooks(category);
        sortBooks();
      } else {
        console.error(`Category section or elements not found for ${category}`);
      }
    }

    // Modal Functions
    function openNotificationModal() {
      const modal = document.getElementById('notificationModal');
      if (modal) {
        modal.classList.add('open');
        const notificationIcon = document.querySelector('.notification-icon');
        if (notificationIcon) notificationIcon.classList.remove('active');
      } else {
        console.error('Notification modal not found');
        showNotification('Error: Notification modal not found', 'error');
      }
    }

    function openAuthorModal(authorId, bookId) {
      currentAuthorId = authorId;
      currentBookId = bookId;
      const modal = document.getElementById('authorModal');
      const modalSpinner = document.getElementById('modalSpinner');
      if (!modal || !modalSpinner) {
        console.error('Author modal or spinner not found:', { modal, modalSpinner });
        showNotification('Error: Author modal not found', 'error');
        return;
      }
      modalSpinner.style.display = 'block';
      setTimeout(() => {
        const data = authorData[authorId] || {};
        const book = books.find(b => b.id === bookId);
        const isFavorited = Array.isArray(currentUser.favorites) && currentUser.favorites.includes(bookId);

        const authorCoverPhoto = document.getElementById('authorCoverPhoto');
        const authorProfilePic = document.getElementById('authorProfilePic');
        const authorName = document.getElementById('authorName');
        const authorAbout = document.getElementById('authorAbout');
        const authorQuotes = document.getElementById('authorQuotes');
        const authorSocials = document.getElementById('authorSocials');
        const followButton = document.getElementById('followButton');
        const currentBookDetails = document.getElementById('currentBookDetails');
        const introVideo = document.getElementById('introVideo');
        const shorts = document.getElementById('shorts');
        const videosSub = document.getElementById('videosSub');
        const playlists = document.getElementById('playlists');
        const authorOtherBooks = document.getElementById('authorOtherBooks');
        const authorTabName = document.getElementById('authorTabName');

        if (!authorCoverPhoto || !authorProfilePic || !authorName || !authorAbout || !authorQuotes ||
          !authorSocials || !followButton || !currentBookDetails || !introVideo || !shorts ||
          !videosSub || !playlists || !authorOtherBooks || !authorTabName) {
          console.error('One or more author modal elements not found');
          showNotification('Error: Author modal elements missing', 'error');
          modalSpinner.style.display = 'none';
          return;
        }

        const coverPhotoUrl = data.coverPhoto && /^https:\/\/picsum\.photos\/seed\/[^/]+\/\d+\/\d+$/.test(data.coverPhoto)
          ? data.coverPhoto
          : 'https://picsum.photos/600/150';
        authorCoverPhoto.src = coverPhotoUrl;
        authorProfilePic.src = data.profilePic || 'https://picsum.photos/100/100';
        authorName.textContent = data.name || 'Unknown Author';
        authorAbout.textContent = data.about || 'No information available.';
        authorQuotes.textContent = data.quotes?.join(', ') || 'No quotes available.';
        authorSocials.innerHTML = Object.entries(data.socials || []).map(([key, value]) =>
          `<a href="https://${key}.com/${value}" target="_blank" class="text-blue-600 hover:underline" aria-label="Visit ${data.name || 'Author'}'s ${key}">${key}</a>`
        ).join(' | ') || 'No socials available.';
        followButton.textContent = Array.isArray(currentUser.following) && currentUser.following.includes(authorId) ? 'Unfollow' : 'Follow';

        currentBookDetails.innerHTML = book ? `
          <div class="flex gap-4 mb-4">
            <img src="${book.cover}" alt="${sanitizeInput(book.title)} cover" class="w-32 h-48 object-cover rounded" loading="lazy">
            <div class="flex-1">
              <h4 class="text-base font-semibold text-gray-800">${sanitizeInput(book.title)}</h4>
              <p class="text-gray-600">Rating: ${sanitizeInput(book.rating.toFixed(1))} <span class="text-yellow-500">‚òÖ</span> (${sanitizeInput((book.raters || 0).toString())})</p>
              <button class="text-2xl ${isFavorited ? 'favorited text-yellow-500' : 'text-gray-500'}" onclick="addToFavorites('${book.id}')" aria-label="${isFavorited ? 'Remove from' : 'Add to'} favorites">${isFavorited ? '‚òÖ' : '‚òÜ'}</button>
              <p class="text-gray-600">Price: $${sanitizeInput(book.price.toFixed(2))}</p>
              <p class="text-gray-600">Posted by: <a href="view-bookstore.html" class="text-purple-600 hover:underline" aria-label="View bookstore ${sanitizeInput(book.bookstore)}">${sanitizeInput(book.bookstore)}</a></p>
              <div class="flex gap-2 mt-2">
                <button onclick="addToCartFromModal('${bookId}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" aria-label="Add ${sanitizeInput(book.title)} to cart">Add to Cart</button>
                <a href="#" onclick="openBookModal('${bookId}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" aria-label="View details of ${sanitizeInput(book.title)}">View Details</a>
              </div>
            </div>
          </div>
        ` : '<p>No book details available.</p>';

        introVideo.innerHTML = (data.videos?.intro || []).map(video =>
          `<iframe class="w-full h-48" src="${video}" frameborder="0" allowfullscreen aria-label="Author introduction video"></iframe>`
        ).join('') || '<p>No introduction video.</p>';
        shorts.innerHTML = (data.videos?.shorts || []).map(video => `<p>${sanitizeInput(video)}</p>`).join('') || '<p>No shorts available.</p>';
        videosSub.innerHTML = (data.videos?.videos || []).map(video => `<p>${sanitizeInput(video)}</p>`).join('') || '<p>No videos available.</p>';
        playlists.innerHTML = (data.videos?.playlists || []).map(video => `<p>${sanitizeInput(video)}</p>`).join('') || '<p>No playlists available.</p>';
        authorOtherBooks.innerHTML = books.filter(b => b.authorId === authorId && b.id !== bookId).map(b => createBookCard(b)).join('') || '<p>No other books found.</p>';
        authorTabName.textContent = data.name || '';

        const tabs = document.querySelectorAll('.tabs .tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const videoTab = document.querySelector('.tab[data-tab="videos"]');
        const subTabs = document.querySelectorAll('.sub-tabs .sub-tab');
        const subTabContents = document.querySelectorAll('.sub-tab-content');
        const shortsSubTab = document.querySelector('.sub-tab[data-sub-tab="shorts"]');

        if (!tabs || !tabContents || !videoTab || !subTabs || !subTabContents || !shortsSubTab) {
          console.error('Tab or sub-tab elements not found');
          showNotification('Error: Tab elements missing', 'error');
          modalSpinner.style.display = 'none';
          return;
        }

        tabs.forEach(tab => {
          tab.classList.remove('active-tab');
          tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active-tab'));
            tab.classList.add('active-tab');
            tabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(tab.dataset.tab).classList.remove('hidden');
          });
        });
        videoTab.classList.add('active-tab');
        tabContents.forEach(content => content.classList.add('hidden'));
        document.getElementById('videos').classList.remove('hidden');

        subTabs.forEach(subTab => {
          subTab.classList.remove('sub-tab-active');
          subTab.addEventListener('click', () => {
            subTabs.forEach(st => st.classList.remove('sub-tab-active'));
            subTab.classList.add('sub-tab-active');
            subTabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(subTab.dataset.subTab).classList.remove('hidden');
          });
        });
        shortsSubTab.classList.add('sub-tab-active');
        subTabContents.forEach(content => content.classList.add('hidden'));
        document.getElementById('shorts').classList.remove('hidden');

        modal.classList.add('open');
        modalSpinner.style.display = 'none';
      }, 500);
    }

    function openBookModal(bookId) {
      currentBookId = bookId;
      const modal = document.getElementById('bookModal');
      const modalSpinner = document.getElementById('bookModalSpinner');
      if (!modal || !modalSpinner) {
        console.error('Book modal or spinner not found:', { modal, modalSpinner });
        showNotification('Error: Book modal not found', 'error');
        return;
      }
      modalSpinner.style.display = 'block';
      setTimeout(() => {
        const book = books.find(b => b.id === bookId);
        if (!book) {
          console.error('Book not found:', bookId);
          showNotification('Error: Book not found', 'error');
          modalSpinner.style.display = 'none';
          return;
        }
        const bookVideo = document.getElementById('bookVideo');
        const bookTitle = document.getElementById('bookTitle');
        const bookAuthorLink = document.getElementById('bookAuthorLink');
        const bookDescription = document.getElementById('bookDescription');
        const bookRating = document.getElementById('bookRating');
        const bookPrice = document.getElementById('bookPrice');
        const relatedBooks = document.getElementById('relatedBooks');
        if (!bookVideo || !bookTitle || !bookAuthorLink || !bookDescription || !bookRating || !bookPrice || !relatedBooks) {
          console.error('One or more book modal elements not found');
          showNotification('Error: Book modal elements missing', 'error');
          modalSpinner.style.display = 'none';
          return;
        }
        bookVideo.innerHTML = `<iframe class="w-full h-48" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen aria-label="Book introduction video"></iframe>`;
        bookTitle.textContent = book.title || 'Unknown Title';
        bookAuthorLink.innerHTML = `<a href="#" onclick="openAuthorModal('${book.authorId}', '${book.id}')" class="text-blue-600 hover:underline" aria-label="View ${sanitizeInput(book.author)}'s profile">${sanitizeInput(book.author)}</a>`;
        bookDescription.textContent = book.description || 'No description available.';
        bookRating.textContent = `Rating: ${book.rating.toFixed(1)} ‚òÖ (${book.raters || 0})`;
        bookPrice.textContent = `Price: $${book.price.toFixed(2)}`;
        relatedBooks.innerHTML = books
          .filter(b => b.subGenre === book.subGenre && b.id !== bookId)
          .slice(0, 3)
          .map(b => createBookCard(b))
          .join('') || '<p>No related books found.</p>';
        modal.classList.add('open');
        modalSpinner.style.display = 'none';
      }, 500);
    }

    function openRequestBookModal() {
      const modal = document.getElementById('requestBookModal');
      if (modal) {
        modal.classList.add('open');
        document.getElementById('requestBookTitle').value = '';
        document.getElementById('requestBookAuthor').value = '';
        document.getElementById('requestPublishedYear').value = '';
        document.getElementById('requestBookDescription').value = '';
      } else {
        console.error('Request book modal not found');
        showNotification('Error: Request book modal not found', 'error');
      }
    }

    function submitBookRequest() {
      const title = document.getElementById('requestBookTitle')?.value;
      const author = document.getElementById('requestBookAuthor')?.value;
      const year = document.getElementById('requestPublishedYear')?.value;
      const description = document.getElementById('requestBookDescription')?.value;
      if (!title && !author && !description) {
        showNotification('Please provide at least one of title, author, or description', 'error');
        return;
      }
      const request = { title, author, year, description, timestamp: new Date().toISOString() };
      let requests = JSON.parse(localStorage.getItem('bookRequests') || '[]');
      requests.push(request);
      localStorage.setItem('bookRequests', JSON.stringify(requests));
      showNotification('Book request submitted successfully', 'success');
      closeModal();
    }

    function openReviews() {
      const modal = document.getElementById('reviewsModal');
      const bookReviews = document.getElementById('bookReviews');
      if (!modal || !bookReviews) {
        console.error('Reviews modal or content not found');
        showNotification('Error: Reviews modal not found', 'error');
        return;
      }
      const reviews = currentBookId
        ? books.find(b => b.id === currentBookId)?.reviews || []
        : authorData[currentAuthorId]?.reviews || [];
      bookReviews.innerHTML = reviews.length
        ? reviews.map(r => `<p class="mb-2">${sanitizeInput(r)}</p>`).join('')
        : '<p>No reviews available.</p>';
      modal.classList.add('open');
    }

    function closeModal() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => modal.classList.remove('open'));
      document.getElementById('ratingCommentModal')?.classList.remove('open');
      document.getElementById('requestBookModal')?.classList.remove('open');
      document.getElementById('notificationModal')?.classList.remove('open');
    }

    function addToCart(bookId) {
      currentUser.cart = currentUser.cart || [];
      if (!currentUser.cart.includes(bookId)) {
        currentUser.cart.push(bookId);
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showNotification('Added to cart', 'success');
      } else {
        showNotification('Book already in cart', 'error');
      }
    }

    function addToCartFromModal() {
      if (currentBookId) addToCart(currentBookId);
    }

    function addToWishlist() {
      if (!currentBookId) {
        console.error('No book selected for wishlist');
        showNotification('Error: No book selected', 'error');
        return;
      }
      addToFavorites(currentBookId);
    }

    function addToFavorites(bookId) {
      const index = currentUser.favorites.indexOf(bookId);
      if (index === -1) {
        currentUser.favorites.push(bookId);
        showNotification('Added to favorites', 'success');
      } else {
        currentUser.favorites.splice(index, 1);
        showNotification('Removed from favorites', 'success');
      }
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      populateBooks(currentCategory);
      const modalFavoriteButton = document.querySelector(`#currentBookDetails button[aria-label*='favorites']`);
      if (modalFavoriteButton) {
        const isFavorited = currentUser.favorites.includes(bookId);
        modalFavoriteButton.textContent = isFavorited ? '‚òÖ' : '‚òÜ';
        modalFavoriteButton.classList.toggle('favorited', isFavorited);
        modalFavoriteButton.classList.toggle('text-yellow-500', isFavorited);
        modalFavoriteButton.classList.toggle('text-gray-500', !isFavorited);
        modalFavoriteButton.setAttribute('aria-label', isFavorited ? 'Remove from favorites' : 'Add to favorites');
      }
    }

    function followAuthor() {
      if (!currentAuthorId) {
        console.error('No author selected to follow');
        showNotification('Error: No author selected', 'error');
        return;
      }
      const index = currentUser.following.indexOf(currentAuthorId);
      const followButton = document.getElementById('followButton');
      if (index === -1) {
        currentUser.following.push(currentAuthorId);
        showNotification(`Followed ${authorData[currentAuthorId].name}`);
      } else {
        currentUser.following.splice(index, 1);
        showNotification(`Unfollowed ${authorData[currentAuthorId].name}`);
      }
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      if (followButton) {
        followButton.textContent = index === -1 ? 'Unfollow' : 'Follow';
      } else {
        console.error('Follow button not found');
        showNotification('Error: Follow button not found', 'error');
      }
    }

    function submitAuthorRatingComment() {
      const rating = document.getElementById('authorRating')?.value;
      const comment = document.getElementById('authorComment')?.value;
      if (!rating || !comment) {
        showNotification('Please provide both rating and comment', 'error');
        return;
      }
      if (currentAuthorId && authorData[currentAuthorId]) {
        authorData[currentAuthorId].reviews = authorData[currentAuthorId].reviews || [];
        authorData[currentAuthorId].reviews.push(`Rating: ${rating} ‚òÖ - ${sanitizeInput(comment)}`);
        currentUser.ratings = currentUser.ratings || [];
        currentUser.ratings.push({ authorId: currentAuthorId, rating, comment });
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showNotification('Author rating submitted successfully', 'success');
        closeModal();
      } else {
        console.error('Author not found for rating:', currentAuthorId);
        showNotification('Error: Author not found', 'error');
      }
    }

    function submitBookRatingComment() {
      const rating = document.getElementById('bookRating')?.value;
      const comment = document.getElementById('bookComment')?.value;
      if (!rating || !comment) {
        showNotification('Please provide both rating and comment', 'error');
        return;
      }
      const book = books.find(b => b.id === currentBookId);
      if (book) {
        book.raters = (book.raters || 0) + 1;
        book.rating = ((book.rating * (book.raters - 1) + parseInt(rating)) / book.raters).toFixed(1);
        book.reviews = book.reviews || [];
        book.reviews.push(`Rating: ${rating} ‚òÖ - ${sanitizeInput(comment)}`);
        currentUser.ratings = currentUser.ratings || [];
        currentUser.ratings.push({ bookId: currentBookId, rating, comment });
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showNotification('Book rating submitted successfully', 'success');
        closeModal();
        populateBooks(currentCategory);
      } else {
        console.error('Book not found for rating:', currentBookId);
        showNotification('Error: Book not found', 'error');
      }
    }

    function toggleProfileDropdown(event) {
      event.preventDefault(); // Prevent navigation to profile.html when clicking to toggle dropdown
      const dropdown = document.getElementById('profileDropdown');
      if (dropdown) {
        dropdown.classList.toggle('active');
      } else {
        console.error('Profile dropdown not found');
        showNotification('Error: Profile dropdown not found', 'error');
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    function sidebarToggle() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar) {
        sidebar.classList.toggle('active');
      } else {
        console.error('Sidebar not found');
        showNotification('Error: Sidebar not found', 'error');
      }
    }

    // Search Functionality
    document.getElementById('search-input')?.addEventListener('input', (e) => {
      const searchQuery = e.target.value.toLowerCase();
      if (!searchQuery) {
        showBooks();
        populateBooks();
      } else {
        sortBooks();
      }
    });

    // Initialize Page
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
      }
      // Simulate determining profile type based on referrer
      const referrer = document.referrer || '';
      if (referrer.includes('tutor-profile.html')) {
        currentUser.profileType = 'tutor';
      } else if (referrer.includes('student-profile.html')) {
        currentUser.profileType = 'student';
      } else if (referrer.includes('parents-profile.html') ||
        referrer.includes('advertiser-profile.html') ||
        referrer.includes('training-center-profile.html') ||
        referrer.includes('bookstore-profile.html')) {
        currentUser.profileType = 'other';
      } else {
        currentUser.profileType = 'default';
      }
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      updateProfileDropdown();
      showStore();
      populateBooks();
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          const searchQuery = e.target.value.toLowerCase();
          if (!searchQuery) {
            showBooks();
            populateBooks();
          } else {
            sortBooks();
          }
        });
      } else {
        console.warn('Search input not found');
      }
    });

    // Keyboard Accessibility
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown) dropdown.classList.remove('active');
      }
    });
  </script>
</body>

</html>