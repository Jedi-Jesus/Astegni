# Connection Role Badges - Visual Guide

## Quick Visual Reference

### How Profile-Based Badges Work

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AHMED'S PERSPECTIVE                              â”‚
â”‚                    (Student, user_id: 50)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When Ahmed opens the Community Modal, he sees:

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Community Modal - My Connections                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚  [Sara's Photo]     â”‚  â”‚  [Daniel's Photo]   â”‚              â•‘
â•‘  â”‚                     â”‚  â”‚                     â”‚              â•‘
â•‘  â”‚  Sara Tadesse       â”‚  â”‚  Daniel Girma       â”‚              â•‘
â•‘  â”‚  ğŸ·ï¸ Tutor           â”‚  â”‚  ğŸ·ï¸ Tutor           â”‚              â•‘
â•‘  â”‚                     â”‚  â”‚                     â”‚              â•‘
â•‘  â”‚  Connected 15 days  â”‚  â”‚  Connected 8 days   â”‚              â•‘
â•‘  â”‚  ago                â”‚  â”‚  ago                â”‚              â•‘
â•‘  â”‚  [Message] [View]   â”‚  â”‚  [Message] [View]   â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚  [Abebe's Photo]    â”‚  â”‚  [Tigist's Photo]   â”‚              â•‘
â•‘  â”‚                     â”‚  â”‚                     â”‚              â•‘
â•‘  â”‚  Abebe Bekele       â”‚  â”‚  Tigist Haile       â”‚              â•‘
â•‘  â”‚  ğŸ·ï¸ Student         â”‚  â”‚  ğŸ·ï¸ Parent          â”‚              â•‘
â•‘  â”‚                     â”‚  â”‚                     â”‚              â•‘
â•‘  â”‚  Connected 22 days  â”‚  â”‚  Connected 10 days  â”‚              â•‘
â•‘  â”‚  ago                â”‚  â”‚  ago                â”‚              â•‘
â•‘  â”‚  [Message] [View]   â”‚  â”‚  [Message] [View]   â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Each badge shows the OTHER person's profile type!
```

---

## Database Records Behind The Scenes

### Connection 1: Ahmed â†’ Sara

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ connections table - Record #1                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id_1:       50              (Ahmed)                â”‚
â”‚ profile_id_1:    12              (Ahmed's student ID)   â”‚
â”‚ profile_type_1:  "student"       (Ahmed's role)         â”‚
â”‚                                                          â”‚
â”‚ user_id_2:       75              (Sara)                 â”‚
â”‚ profile_id_2:    85              (Sara's tutor ID)      â”‚
â”‚ profile_type_2:  "tutor"         â† BADGE SOURCE! ğŸ¯     â”‚
â”‚                                                          â”‚
â”‚ status:          "connected"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ahmed sees: "Tutor" badge (Sara's profile_type_2)
Sara sees: "Student" badge (Ahmed's profile_type_1)
```

### Connection 2: Ahmed â†’ Daniel

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ connections table - Record #2                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id_1:       50              (Ahmed)                â”‚
â”‚ profile_id_1:    12              (Ahmed's student ID)   â”‚
â”‚ profile_type_1:  "student"       (Ahmed's role)         â”‚
â”‚                                                          â”‚
â”‚ user_id_2:       90              (Daniel)               â”‚
â”‚ profile_id_2:    95              (Daniel's tutor ID)    â”‚
â”‚ profile_type_2:  "tutor"         â† BADGE SOURCE! ğŸ¯     â”‚
â”‚                                                          â”‚
â”‚ status:          "connected"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ahmed sees: "Tutor" badge (Daniel's profile_type_2)
Daniel sees: "Student" badge (Ahmed's profile_type_1)
```

---

## Code Flow Visualization

### Step 1: API Request

```javascript
// Frontend requests connections
fetch('http://localhost:8000/api/connections/my', {
    headers: { 'Authorization': 'Bearer ' + token }
})
```

### Step 2: Backend Response

```json
{
    "id": 1,
    "user_id_1": 50,               // Ahmed (current viewer)
    "profile_id_1": 12,
    "profile_type_1": "student",   // Ahmed's profile type

    "user_id_2": 75,               // Sara (other person)
    "profile_id_2": 85,
    "profile_type_2": "tutor",     // â† THIS becomes the badge!

    "user_2_name": "Sara Tadesse",
    "user_2_profile_picture": "sara.jpg",
    "status": "connected"
}
```

### Step 3: Frontend Processing

```javascript
function getProfileBadge(connection) {
    const currentUserId = 50;  // Ahmed

    if (connection.user_id_1 === currentUserId) {
        // Ahmed is user_id_1, so show user_2's profile type
        return connection.profile_type_2;  // "tutor"
    }
}
```

### Step 4: UI Rendering

```html
<div class="connection-card">
    <img src="sara.jpg" alt="Sara Tadesse">
    <h4>Sara Tadesse</h4>
    <p>
        <span class="role-badge">Tutor</span>  â† Displayed!
    </p>
</div>
```

---

## Multi-Role User Example

### Scenario: Abebe Has TWO Profiles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ABEBE (user_id: 100)                                       â”‚
â”‚  â”œâ”€ Student Profile (profile_id: 20)                        â”‚
â”‚  â””â”€ Tutor Profile (profile_id: 80)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Connection as Student

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection #10: Student Abebe â†’ Tutor Tigist            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id_1:       100             (Abebe)                â”‚
â”‚ profile_id_1:    20              (Abebe's STUDENT ID)   â”‚
â”‚ profile_type_1:  "student"                              â”‚
â”‚                                                          â”‚
â”‚ user_id_2:       110             (Tigist)               â”‚
â”‚ profile_id_2:    90              (Tigist's tutor ID)    â”‚
â”‚ profile_type_2:  "tutor"         â† BADGE: "Tutor" ğŸ¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When Abebe (as student) views: Badge shows "Tutor"
Context: Mentor-mentee relationship
```

### Connection as Tutor

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection #11: Tutor Abebe â†’ Tutor Tigist              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id_1:       100             (Abebe)                â”‚
â”‚ profile_id_1:    80              (Abebe's TUTOR ID)     â”‚
â”‚ profile_type_1:  "tutor"                                â”‚
â”‚                                                          â”‚
â”‚ user_id_2:       110             (Tigist)               â”‚
â”‚ profile_id_2:    90              (Tigist's tutor ID)    â”‚
â”‚ profile_type_2:  "tutor"         â† BADGE: "Tutor" ğŸ¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When Abebe (as tutor) views: Badge shows "Tutor"
Context: Professional network
```

**Key Insight:** Same user (Abebe) can have DIFFERENT connections with the same person (Tigist) based on which profile they're using!

---

## Filter Buttons in Community Modal

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Filters:  [All]  [ğŸ‘¨â€ğŸ“ Students]  [ğŸ‘ª Parents]  [ğŸ‘” Tutors]  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### How Filters Work

**Click "Students":**
```javascript
// Shows connections where OTHER person's profile type is "student"
connections.filter(conn => {
    const otherProfileType = (conn.user_id_1 === currentUserId)
        ? conn.profile_type_2
        : conn.profile_type_1;
    return otherProfileType === 'student';
});
```

**Click "Tutors":**
```javascript
// Shows connections where OTHER person's profile type is "tutor"
connections.filter(conn => {
    const otherProfileType = (conn.user_id_1 === currentUserId)
        ? conn.profile_type_2
        : conn.profile_type_1;
    return otherProfileType === 'tutor';
});
```

---

## Before vs After Comparison

### âŒ WRONG WAY (User-Based)

```javascript
// Don't do this!
function getProfileBadge(connection) {
    return user.roles[0];  // âŒ Shows current user's role
}

// Result: Ahmed sees "Student" for all connections (his own role)
```

### âœ… CORRECT WAY (Profile-Based)

```javascript
// Do this!
function getProfileBadge(connection) {
    if (connection.user_id_1 === currentUserId) {
        return connection.profile_type_2;  // âœ… Shows OTHER person's role
    } else {
        return connection.profile_type_1;  // âœ… Shows OTHER person's role
    }
}

// Result: Ahmed sees "Tutor" for Sara, "Student" for Abebe, etc.
```

---

## Badge Mapping

```javascript
const profileTypeMap = {
    'tutor':      'Tutor',      // From tutor_profiles table
    'student':    'Student',    // From student_profiles table
    'parent':     'Parent',     // From parent_profiles table
    'advertiser': 'Advertiser'  // From advertiser_profiles table
};
```

---

## Summary Diagram

```
DATABASE                API RESPONSE            FRONTEND LOGIC           UI DISPLAY
â•â•â•â•â•â•â•â•â•â•â•            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•

connections            ConnectionResponse       getProfileBadge()       Connection Card
table                  {                        â†“                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             profile_type_2:        Determines OTHER        â”‚ [Photo]     â”‚
â”‚profile_ â”‚             "tutor"                person's type           â”‚             â”‚
â”‚type_2:  â”‚  â”€â”€â”€â”€â”€â”€â”€â†’  }                       â†“                       â”‚ Sara T.     â”‚
â”‚"tutor"  â”‚                                    Returns "Tutor"         â”‚ ğŸ·ï¸ Tutor    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â†“                       â”‚             â”‚
                                               Badge = "Tutor"         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Checklist

### âœ… Verify Badge Accuracy

1. **Login as student:**
   - View tutor connection â†’ Should show "Tutor" badge âœ…
   - View parent connection â†’ Should show "Parent" badge âœ…
   - View student connection â†’ Should show "Student" badge âœ…

2. **Login as tutor:**
   - View student connection â†’ Should show "Student" badge âœ…
   - View other tutor connection â†’ Should show "Tutor" badge âœ…
   - View parent connection â†’ Should show "Parent" badge âœ…

3. **Test filters:**
   - Click "Students" filter â†’ Only shows connections with "Student" badge âœ…
   - Click "Tutors" filter â†’ Only shows connections with "Tutor" badge âœ…
   - Click "Parents" filter â†’ Only shows connections with "Parent" badge âœ…

4. **Multi-role user:**
   - User with student + tutor profiles
   - Should have separate connections for each role âœ…
   - Badges should reflect the OTHER person's role in each context âœ…

---

## Quick Reference Table

| Viewer Role | Connection With | Badge Shown | Source Field |
|-------------|----------------|-------------|--------------|
| Student | Tutor | "Tutor" | profile_type_2 |
| Student | Parent | "Parent" | profile_type_2 |
| Student | Student | "Student" | profile_type_2 |
| Tutor | Student | "Student" | profile_type_2 |
| Tutor | Tutor | "Tutor" | profile_type_2 |
| Parent | Tutor | "Tutor" | profile_type_2 |
| Parent | Student | "Student" | profile_type_2 |

**Rule:** Always shows the OTHER person's profile type, never the current viewer's role!

---

## Files to Check

If you want to verify the implementation yourself:

1. **Database Schema:**
   - File: `astegni-backend/app.py modules/models.py`
   - Look for: `class Connection(Base)` (line 739)

2. **API Response:**
   - File: `astegni-backend/app.py modules/models.py`
   - Look for: `class ConnectionResponse(BaseModel)` (line 1165)

3. **Badge Function:**
   - File: `js/tutor-profile/global-functions.js`
   - Look for: `function getProfileBadge(connection)` (line 1722)

4. **Card Rendering:**
   - File: `js/tutor-profile/global-functions.js`
   - Look for: `function renderConnectionCard(connection)` (line 1955)

5. **Modal HTML:**
   - File: `profile-pages/tutor-profile.html`
   - Look for: `<div id="communityModal"` (line 3345)

---

## Conclusion

âœ… **The connection role badges are 100% profile-based and accurate!**

Each badge shows the OTHER person's actual profile type from the database, ensuring context-aware and meaningful connections throughout the Astegni platform.
