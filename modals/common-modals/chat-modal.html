<!--
  Modal: chatModal
  Purpose: Full-featured chat modal for messaging between users (tutors, students, parents, institutes)
  Features: Real-time messaging, voice/video calls, file sharing, voice recording, emoji/GIF support
-->

<div id="chatModal" class="modal hidden" style="display: none; z-index: 10001;">
    <div class="modal-overlay" onclick="closeChatModal()"></div>

    <!-- Main Chat Container -->
    <div class="chat-modal-container">
        <!-- Top Header with Toggle and Window Controls -->
        <div class="chat-main-header">
            <!-- Toggle Sidebar Button -->
            <button class="toggle-sidebar-btn" id="toggleChatSidebar" onclick="toggleChatSidebar()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"></path>
                </svg>
            </button>

            <!-- Window Controls (Minimize/Close) -->
            <div class="window-controls">
                <button class="minimize-btn" onclick="minimizeChatModal()" title="Minimize">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14"></path>
                    </svg>
                </button>
                <button class="close-btn" onclick="closeChatModal()" title="Close">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Left Sidebar - Contacts List -->
        <div class="chat-sidebar" id="chatSidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="sidebar-user-profile">
                    <img src="" alt="Your Profile" class="sidebar-user-avatar" id="chatCurrentUserAvatar">
                    <div class="sidebar-user-info">
                        <h3 id="chatCurrentUserName">You</h3>
                        <span class="user-occupation" id="chatCurrentUserRole">User</span>
                    </div>
                </div>
                <button class="sidebar-header-settings-btn" onclick="toggleChatSettings()" title="Chat Settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>

            <!-- Search Bar -->
            <div class="sidebar-search">
                <input type="text" id="chatContactSearch" placeholder="Search conversations..." class="search-input">
                <button class="search-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>

            <!-- Tabs -->
            <div class="sidebar-tabs">
                <button class="tab-btn active" data-tab="all"><i class="fas fa-comments"></i> All</button>
                <button class="tab-btn" data-tab="requests"><i class="fas fa-user-plus"></i> Requests</button>
                <button class="tab-btn" data-tab="personal"><i class="fas fa-user"></i> Personal</button>
                <button class="tab-btn" data-tab="groups"><i class="fas fa-users"></i> Groups</button>
                <button class="tab-btn" data-tab="channels"><i class="fas fa-bullhorn"></i> Channels</button>
                <button class="tab-btn" data-tab="archived"><i class="fas fa-archive"></i> Archived</button>
                <button class="tab-btn" data-tab="blocked"><i class="fas fa-ban"></i> Blocked</button>
            </div>

            <!-- Contacts List -->
            <div class="contacts-list" id="chatContactsList">
                <!-- Loading state -->
                <div class="chat-loading" id="chatContactsLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading conversations...</p>
                </div>
                <!-- Contacts will be dynamically loaded here -->
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer" id="chatSidebarFooter" style="display: none;">
                <button class="sidebar-action-btn" id="createGroupChannelBtn" onclick="ChatModalManager.showCreateGroupChannel()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"></path>
                    </svg>
                    <span id="createGroupChannelLabel">Create Group</span>
                </button>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main" id="chatMain">
            <!-- Empty State (when no chat selected) -->
            <div class="chat-empty-state" id="chatEmptyState">
                <div class="empty-state-icon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <h3>Select a conversation</h3>
                <p>Choose from your existing conversations or start a new one</p>
            </div>

            <!-- Chat Content (hidden until chat selected) -->
            <div class="chat-content" id="chatContent" style="display: none;">
                <!-- User Info Header -->
                <div class="user-info">
                    <div class="user-avatar">
                        <img src="" alt="" id="chatUserAvatar">
                        <div class="online-indicator" id="chatUserOnlineIndicator"></div>
                    </div>
                    <div class="user-basic-info">
                        <a href="#" id="chatUserNameLink" class="chat-user-name-link" title="View profile">
                            <h2 id="chatUserName">User Name</h2>
                        </a>
                        <span class="user-occupation-header" id="chatUserRole">Role</span>
                        <span class="last-seen" id="chatLastSeen">Last seen recently</span>
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" onclick="toggleChatSearch()" title="Search">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                        <button class="header-btn read-messages" id="chatReadMessagesBtn" onclick="toggleReadMessages()" title="Read Messages Aloud">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                        </button>
                        <button id="chatVoiceCallBtn" class="header-btn voice-call" onclick="startChatVoiceCall()" title="Voice Call">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </button>
                        <button id="chatVideoCallBtn" class="header-btn" onclick="startChatVideoCall()" title="Video Call">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                        </button>
                        <button class="header-btn translate-btn" id="chatTranslateBtn" onclick="toggleTranslatePanel()" title="Translate Messages">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 8l6 6"></path>
                                <path d="M4 14l6-6 2-3"></path>
                                <path d="M2 5h12"></path>
                                <path d="M7 2v3"></path>
                                <path d="M22 22l-5-10-5 10"></path>
                                <path d="M14 18h6"></path>
                            </svg>
                        </button>
                        <button class="header-btn" id="chatInfoBtn" onclick="toggleChatInfo()" title="Info">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4M12 8h.01"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Search Container -->
                <div class="search-container" id="chatSearchContainer">
                    <input type="text" class="search-bar" id="chatSearchBar" placeholder="Search messages...">
                    <div class="search-nav-buttons" id="searchNavButtons" style="display: none;">
                        <button class="search-nav-btn" onclick="navigateSearchPrev()" title="Previous (Shift+Enter)">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                        <button class="search-nav-btn" onclick="navigateSearchNext()" title="Next (Enter)">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>
                    <button class="search-close" onclick="toggleChatSearch()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Pinned Messages -->
                <div id="chatPinnedMessages" class="pinned-messages">
                    <h3>Pinned Messages</h3>
                    <div class="pinned-messages-list"></div>
                </div>

                <!-- Chat Area -->
                <div class="chat-area" id="chatArea">
                    <!-- Messages will be dynamically added here -->

                    <!-- Other Party Typing Indicator (left side, like received message) -->
                    <div class="message typing-message" id="chatTypingIndicator">
                        <img src="" alt="" class="message-avatar" id="typingUserAvatar">
                        <div class="message-content">
                            <div class="message-bubble typing-bubble">
                                <div class="typing-dots-wave">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Self Typing Indicator (right side, like sent message) -->
                    <div class="message sent typing-message" id="selfTypingIndicator">
                        <div class="message-content">
                            <div class="message-bubble typing-bubble">
                                <div class="typing-dots-wave">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blocked Contact Overlay -->
                <div class="chat-blocked-overlay" id="chatBlockedOverlay" style="display: none;">
                    <div class="blocked-content">
                        <div class="blocked-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="m4.93 4.93 14.14 14.14"></path>
                            </svg>
                        </div>
                        <h3>Contact Blocked</h3>
                        <p>You have blocked this contact. You won't receive messages from them.</p>
                        <button class="unblock-btn" onclick="unblockChatContact()">Unblock Contact</button>
                    </div>
                </div>

                <!-- File Preview -->
                <div class="file-preview" id="chatFilePreview"></div>

                <!-- Reply Preview -->
                <div class="reply-preview" id="chatReplyPreview">
                    <div class="reply-content">
                        <span class="reply-label">Replying to</span>
                        <p class="reply-text"></p>
                    </div>
                    <button class="reply-close" onclick="cancelChatReply()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <!-- Normal Text Input (shown by default) -->
                        <div class="input-wrapper" id="chatInputWrapper">
                            <textarea
                                class="message-input"
                                id="chatMessageInput"
                                placeholder="Type a message..."
                                rows="1"></textarea>
                            <div class="input-actions">
                                <button class="emoji-btn" onclick="openChatEmojiModal()" title="Emoji">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                        <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                        <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                    </svg>
                                </button>
                                <label class="file-btn" title="Attach File">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                    </svg>
                                    <input type="file" id="chatFileInput" class="file-input" accept="image/*,video/*,audio/*,application/pdf,.doc,.docx" multiple>
                                </label>
                            </div>
                        </div>

                        <!-- Voice Recording UI (replaces input when recording) -->
                        <div class="voice-input-wrapper" id="chatVoiceInputRecording" style="display: none;">
                            <span class="recording-time" id="chatRecordingTime">0:00</span>
                            <div class="recording-wave">
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                                <div class="wave-bar"></div>
                            </div>
                            <button class="cancel-recording" onclick="cancelChatRecording()" title="Cancel">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 6L6 18M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Voice Preview UI (replaces input after recording) -->
                        <div class="voice-input-wrapper voice-preview-mode" id="chatVoiceInputPreview" style="display: none;">
                            <button class="voice-preview-play" id="voicePreviewPlayBtn" onclick="toggleVoicePreviewPlay()">
                                <svg class="play-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                <svg class="pause-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                                    <rect x="6" y="4" width="4" height="16"></rect>
                                    <rect x="14" y="4" width="4" height="16"></rect>
                                </svg>
                            </button>
                            <div class="voice-preview-waveform">
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                            </div>
                            <span class="voice-preview-duration" id="voicePreviewDuration">0:00</span>
                            <button class="voice-preview-cancel" onclick="cancelVoicePreview()" title="Discard">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 6L6 18M6 6l12 12"></path>
                                </svg>
                            </button>
                            <audio id="voicePreviewAudio" style="display: none;"></audio>
                        </div>

                        <button class="media-btn" id="chatVoiceRecordBtn" onclick="toggleChatVoiceRecordingWithMode()" ondblclick="toggleVoiceRecordMode(event)" title="Record Voice (Double-click for Voice-to-Text mode)">
                            <!-- Normal mic icon (Recording mode) -->
                            <svg class="voice-icon-normal" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                            <!-- VTT mode icon (Voice-to-Text) - keyboard with mic -->
                            <svg class="voice-icon-vtt" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                                <line x1="6" y1="8" x2="6.01" y2="8"></line>
                                <line x1="10" y1="8" x2="10.01" y2="8"></line>
                                <line x1="14" y1="8" x2="14.01" y2="8"></line>
                                <line x1="18" y1="8" x2="18.01" y2="8"></line>
                                <line x1="8" y1="12" x2="8.01" y2="12"></line>
                                <line x1="12" y1="12" x2="12.01" y2="12"></line>
                                <line x1="16" y1="12" x2="16.01" y2="12"></line>
                                <line x1="7" y1="16" x2="17" y2="16"></line>
                            </svg>
                        </button>
                        <button class="media-btn video-btn" id="chatVideoRecordBtn" onclick="toggleVideoRecording()" title="Record Video">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                        </button>
                        <button class="send-btn" onclick="handleSendMessage()" ondblclick="toggleSendMode(event)" id="chatSendBtn" title="Send (Double-click to toggle TTS mode)">
                            <!-- Normal send icon -->
                            <svg class="send-icon-normal" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            <!-- TTS send icon (hidden by default) -->
                            <svg class="send-icon-tts" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                        </button>

                        <!-- Send Options Context Menu -->
                        <div class="send-options-menu" id="chatSendOptionsMenu">
                            <button onclick="setSendMode('text')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                                Send (Normal)
                            </button>
                            <button onclick="setSendMode('tts')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                </svg>
                                Send with TTS (Coming Soon)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Info Panel -->
            <div class="chat-info-panel" id="chatInfoPanel">
                <div class="info-panel-header">
                    <h3>Contact Info</h3>
                </div>

                <div class="info-panel-content">
                    <div class="info-profile">
                        <img src="" alt="" id="chatInfoPanelAvatar">
                        <h3 id="chatInfoPanelName">User Name</h3>
                        <p id="chatInfoPanelRole">Role</p>
                        <p class="info-location" id="chatInfoLocation" style="display: none;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span class="info-value"></span>
                        </p>
                        <p id="chatInfoPanelLastSeen">Last seen today</p>
                    </div>
                    
                    <!-- Action Cards Row -->
                    <div class="info-actions-row">
                        <div class="info-action-card" id="infoPanelMuteCard" onclick="ChatModalManager.toggleMuteFromInfoPanel()">
                            <div class="action-card-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <span class="action-card-title">Mute</span>
                        </div>
                        <div class="info-action-card" id="infoPanelPinCard" onclick="ChatModalManager.togglePinFromInfoPanel()">
                            <div class="action-card-icon">
                                <i class="fas fa-thumbtack"></i>
                            </div>
                            <span class="action-card-title">Pin</span>
                        </div>
                        <div class="info-action-card" id="infoPanelArchiveCard" onclick="ChatModalManager.toggleArchiveFromInfoPanel()">
                            <div class="action-card-icon">
                                <i class="fas fa-archive"></i>
                            </div>
                            <span class="action-card-title">Archive</span>
                        </div>
                    </div>

                    <div class="info-section info-quote-section">
                        <h4>Quote</h4>
                        <p class="info-quote" id="chatInfoPanelQuote">No quote available</p>
                    </div>

                    <!-- Media Tabs -->
                    <div class="info-section">
                        <div class="media-tabs">
                            <button class="media-tab active" onclick="showChatMediaTab('images')">Images</button>
                            <button class="media-tab" onclick="showChatMediaTab('videos')">Videos</button>
                            <button class="media-tab" onclick="showChatMediaTab('files')">Files</button>
                            <button class="media-tab" onclick="showChatMediaTab('links')">Links</button>
                            <button class="media-tab" onclick="showChatMediaTab('members')" id="chatMembersTabBtn" style="display: none;">Members</button>
                            <button class="media-tab" onclick="showChatMediaTab('polls')" id="chatPollsTabBtn" style="display: none;">Polls</button>
                        </div>

                        <div class="media-content">
                            <div id="chatImagesTab" class="media-tab-content active">
                                <div class="media-grid" id="chatMediaGrid">
                                    <!-- Images will be loaded here -->
                                    <p class="no-media">No shared images</p>
                                </div>
                            </div>

                            <div id="chatVideosTab" class="media-tab-content">
                                <div class="media-grid" id="chatVideosGrid">
                                    <!-- Videos will be loaded here -->
                                    <p class="no-media">No shared videos</p>
                                </div>
                            </div>

                            <div id="chatFilesTab" class="media-tab-content">
                                <div class="docs-list" id="chatFilesList">
                                    <p class="no-media">No shared files</p>
                                </div>
                            </div>

                            <div id="chatLinksTab" class="media-tab-content">
                                <div class="links-list" id="chatLinksList">
                                    <p class="no-media">No shared links</p>
                                </div>
                            </div>

                            <!-- Members Tab (for groups/channels only) -->
                            <div id="chatMembersTab" class="media-tab-content">
                                <button class="add-member-btn" id="chatAddMemberBtn" onclick="openAddMemberModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="8.5" cy="7" r="4"></circle>
                                        <line x1="20" y1="8" x2="20" y2="14"></line>
                                        <line x1="23" y1="11" x2="17" y2="11"></line>
                                    </svg>
                                    Add Member
                                </button>
                                <button class="leave-group-btn" id="chatLeaveGroupBtn" onclick="leaveGroupOrChannel()" style="display: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                        <polyline points="16 17 21 12 16 7"></polyline>
                                        <line x1="21" y1="12" x2="9" y2="12"></line>
                                    </svg>
                                    <span id="chatLeaveGroupBtnText">Leave Group</span>
                                </button>
                                <div class="members-header">
                                    <h4><i class="fas fa-users"></i> Members</h4>
                                    <span class="members-count" id="chatMembersCount">0 members</span>
                                </div>
                                <div class="members-list" id="chatMembersList">
                                    <!-- Members will be loaded dynamically -->
                                    <p class="no-media">No members</p>
                                </div>
                            </div>

                            <!-- Polls Tab -->
                            <div id="chatPollsTab" class="media-tab-content">
                                <button class="create-poll-btn" onclick="openCreatePollModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 5v14M5 12h14"></path>
                                    </svg>
                                    Create Poll
                                </button>
                                <div class="polls-list" id="chatPollsList">
                                    <!-- Polls will be loaded dynamically -->
                                    <p class="no-media">No polls yet</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-actions">
                        <button class="info-action-btn danger" id="chatBlockBtn" onclick="blockChatContact()">
                            <span class="block-text">Block Contact</span>
                            <span class="unblock-text" style="display: none;">Unblock Contact</span>
                        </button>
                        <button class="info-action-btn danger" onclick="showDeleteContactConfirmation()">Delete Contact</button>
                    </div>
                </div>
            </div>

            <!-- Right Translate Panel (slide-out like info panel) -->
            <div class="chat-translate-panel" id="chatTranslatePanel">
                <div class="translate-panel-header">
                    <h3>Translate Messages</h3>
                </div>
                <div class="translate-panel-content">
                    <p class="translate-description">Select a language to translate incoming messages:</p>

                    <!-- Language Search Bar -->
                    <div class="language-search">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" id="languageSearchInput" placeholder="Search languages..." oninput="filterLanguages(this.value)">
                    </div>

                    <div class="language-list" id="languageList">
                        <button class="language-option active" data-lang="none" data-name="no translation disable off" onclick="setTranslateLanguage('none')">
                            <span class="lang-flag">ðŸš«</span>
                            <span class="lang-name">No Translation</span>
                        </button>
                        <button class="language-option" data-lang="en" data-name="english uk gb britain" onclick="setTranslateLanguage('en')">
                            <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
                            <span class="lang-name">English</span>
                        </button>
                        <button class="language-option" data-lang="am" data-name="amharic ethiopia ethiopian" onclick="setTranslateLanguage('am')">
                            <span class="lang-flag">ðŸ‡ªðŸ‡¹</span>
                            <span class="lang-name">Amharic</span>
                        </button>
                        <button class="language-option" data-lang="om" data-name="oromo oromiffa ethiopia ethiopian" onclick="setTranslateLanguage('om')">
                            <span class="lang-flag">ðŸ‡ªðŸ‡¹</span>
                            <span class="lang-name">Oromo</span>
                        </button>
                        <button class="language-option" data-lang="ti" data-name="tigrinya tigray ethiopia ethiopian eritrea" onclick="setTranslateLanguage('ti')">
                            <span class="lang-flag">ðŸ‡ªðŸ‡¹</span>
                            <span class="lang-name">Tigrinya</span>
                        </button>
                        <button class="language-option" data-lang="fr" data-name="french france francais" onclick="setTranslateLanguage('fr')">
                            <span class="lang-flag">ðŸ‡«ðŸ‡·</span>
                            <span class="lang-name">French</span>
                        </button>
                        <button class="language-option" data-lang="ar" data-name="arabic arab saudi arabia" onclick="setTranslateLanguage('ar')">
                            <span class="lang-flag">ðŸ‡¸ðŸ‡¦</span>
                            <span class="lang-name">Arabic</span>
                        </button>
                        <button class="language-option" data-lang="es" data-name="spanish espanol spain" onclick="setTranslateLanguage('es')">
                            <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
                            <span class="lang-name">Spanish</span>
                        </button>
                        <button class="language-option" data-lang="pt" data-name="portuguese portugal brasil brazil" onclick="setTranslateLanguage('pt')">
                            <span class="lang-flag">ðŸ‡µðŸ‡¹</span>
                            <span class="lang-name">Portuguese</span>
                        </button>
                        <button class="language-option" data-lang="zh" data-name="chinese china mandarin" onclick="setTranslateLanguage('zh')">
                            <span class="lang-flag">ðŸ‡¨ðŸ‡³</span>
                            <span class="lang-name">Chinese</span>
                        </button>
                        <button class="language-option" data-lang="hi" data-name="hindi india indian" onclick="setTranslateLanguage('hi')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡³</span>
                            <span class="lang-name">Hindi</span>
                        </button>
                        <button class="language-option" data-lang="sw" data-name="swahili kiswahili kenya tanzania africa" onclick="setTranslateLanguage('sw')">
                            <span class="lang-flag">ðŸ‡°ðŸ‡ª</span>
                            <span class="lang-name">Swahili</span>
                        </button>
                        <button class="language-option" data-lang="de" data-name="german germany deutsch" onclick="setTranslateLanguage('de')">
                            <span class="lang-flag">ðŸ‡©ðŸ‡ª</span>
                            <span class="lang-name">German</span>
                        </button>
                        <button class="language-option" data-lang="it" data-name="italian italy italiano" onclick="setTranslateLanguage('it')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡¹</span>
                            <span class="lang-name">Italian</span>
                        </button>
                        <button class="language-option" data-lang="ja" data-name="japanese japan nihongo" onclick="setTranslateLanguage('ja')">
                            <span class="lang-flag">ðŸ‡¯ðŸ‡µ</span>
                            <span class="lang-name">Japanese</span>
                        </button>
                        <button class="language-option" data-lang="ko" data-name="korean korea hangul" onclick="setTranslateLanguage('ko')">
                            <span class="lang-flag">ðŸ‡°ðŸ‡·</span>
                            <span class="lang-name">Korean</span>
                        </button>
                        <button class="language-option" data-lang="ru" data-name="russian russia" onclick="setTranslateLanguage('ru')">
                            <span class="lang-flag">ðŸ‡·ðŸ‡º</span>
                            <span class="lang-name">Russian</span>
                        </button>
                        <button class="language-option" data-lang="tr" data-name="turkish turkey" onclick="setTranslateLanguage('tr')">
                            <span class="lang-flag">ðŸ‡¹ðŸ‡·</span>
                            <span class="lang-name">Turkish</span>
                        </button>
                        <button class="language-option" data-lang="nl" data-name="dutch netherlands holland" onclick="setTranslateLanguage('nl')">
                            <span class="lang-flag">ðŸ‡³ðŸ‡±</span>
                            <span class="lang-name">Dutch</span>
                        </button>
                        <button class="language-option" data-lang="pl" data-name="polish poland" onclick="setTranslateLanguage('pl')">
                            <span class="lang-flag">ðŸ‡µðŸ‡±</span>
                            <span class="lang-name">Polish</span>
                        </button>
                        <button class="language-option" data-lang="vi" data-name="vietnamese vietnam" onclick="setTranslateLanguage('vi')">
                            <span class="lang-flag">ðŸ‡»ðŸ‡³</span>
                            <span class="lang-name">Vietnamese</span>
                        </button>
                        <button class="language-option" data-lang="th" data-name="thai thailand" onclick="setTranslateLanguage('th')">
                            <span class="lang-flag">ðŸ‡¹ðŸ‡­</span>
                            <span class="lang-name">Thai</span>
                        </button>
                        <button class="language-option" data-lang="id" data-name="indonesian indonesia" onclick="setTranslateLanguage('id')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡©</span>
                            <span class="lang-name">Indonesian</span>
                        </button>
                        <button class="language-option" data-lang="ms" data-name="malay malaysia" onclick="setTranslateLanguage('ms')">
                            <span class="lang-flag">ðŸ‡²ðŸ‡¾</span>
                            <span class="lang-name">Malay</span>
                        </button>
                        <button class="language-option" data-lang="he" data-name="hebrew israel" onclick="setTranslateLanguage('he')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡±</span>
                            <span class="lang-name">Hebrew</span>
                        </button>
                        <button class="language-option" data-lang="uk" data-name="ukrainian ukraine" onclick="setTranslateLanguage('uk')">
                            <span class="lang-flag">ðŸ‡ºðŸ‡¦</span>
                            <span class="lang-name">Ukrainian</span>
                        </button>
                        <button class="language-option" data-lang="bn" data-name="bengali bangladesh bangla" onclick="setTranslateLanguage('bn')">
                            <span class="lang-flag">ðŸ‡§ðŸ‡©</span>
                            <span class="lang-name">Bengali</span>
                        </button>
                        <button class="language-option" data-lang="ur" data-name="urdu pakistan" onclick="setTranslateLanguage('ur')">
                            <span class="lang-flag">ðŸ‡µðŸ‡°</span>
                            <span class="lang-name">Urdu</span>
                        </button>
                        <button class="language-option" data-lang="ta" data-name="tamil india sri lanka" onclick="setTranslateLanguage('ta')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡³</span>
                            <span class="lang-name">Tamil</span>
                        </button>
                        <button class="language-option" data-lang="te" data-name="telugu india" onclick="setTranslateLanguage('te')">
                            <span class="lang-flag">ðŸ‡®ðŸ‡³</span>
                            <span class="lang-name">Telugu</span>
                        </button>
                        <button class="language-option" data-lang="yo" data-name="yoruba nigeria" onclick="setTranslateLanguage('yo')">
                            <span class="lang-flag">ðŸ‡³ðŸ‡¬</span>
                            <span class="lang-name">Yoruba</span>
                        </button>
                        <button class="language-option" data-lang="ig" data-name="igbo nigeria" onclick="setTranslateLanguage('ig')">
                            <span class="lang-flag">ðŸ‡³ðŸ‡¬</span>
                            <span class="lang-name">Igbo</span>
                        </button>
                        <button class="language-option" data-lang="ha" data-name="hausa nigeria niger" onclick="setTranslateLanguage('ha')">
                            <span class="lang-flag">ðŸ‡³ðŸ‡¬</span>
                            <span class="lang-name">Hausa</span>
                        </button>
                        <button class="language-option" data-lang="zu" data-name="zulu south africa" onclick="setTranslateLanguage('zu')">
                            <span class="lang-flag">ðŸ‡¿ðŸ‡¦</span>
                            <span class="lang-name">Zulu</span>
                        </button>
                        <button class="language-option" data-lang="af" data-name="afrikaans south africa" onclick="setTranslateLanguage('af')">
                            <span class="lang-flag">ðŸ‡¿ðŸ‡¦</span>
                            <span class="lang-name">Afrikaans</span>
                        </button>
                    </div>

                    <p class="no-languages-found" id="noLanguagesFound" style="display: none;">No languages found</p>
                </div>
            </div>

        </div>
    </div>

    <!-- Two-Step Verification Modal (shown when 2FA is enabled) -->
    <div class="two-step-verify-modal" id="twoStepVerifyModal" style="display: none;">
        <div class="two-step-verify-overlay"></div>
        <div class="two-step-verify-content">
            <div class="two-step-verify-header">
                <div class="two-step-verify-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        <path d="M9 12l2 2 4-4"></path>
                    </svg>
                </div>
                <h3>Two-Step Verification</h3>
                <p>Enter your chat security password to continue</p>
            </div>
            <div class="two-step-verify-body">
                <div class="two-step-verify-form">
                    <div class="form-group">
                        <label>Security Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="twoStepVerifyPassword" placeholder="Enter your security password" class="settings-input" autocomplete="off">
                            <button type="button" class="toggle-password-btn" onclick="toggleTwoStepPasswordVisibility()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-off-icon" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                        <span class="form-error" id="twoStepVerifyError" style="display: none;">Incorrect password. Please try again.</span>
                    </div>
                    <button class="settings-action-btn primary full-width" id="twoStepVerifyBtn" onclick="verifyTwoStepPassword()">
                        <span id="twoStepVerifyBtnText">Verify & Continue</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                </div>
                <div class="two-step-verify-footer">
                    <a href="javascript:void(0)" onclick="forgotTwoStepPassword()" class="forgot-password-link">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        Forgot password?
                    </a>
                </div>
            </div>
            <button class="two-step-verify-close" onclick="closeChatModalCompletely()" title="Cancel and close chat">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Forgot Two-Step Password Modal -->
    <div class="forgot-two-step-modal" id="forgotTwoStepModal" style="display: none;">
        <div class="forgot-two-step-overlay" onclick="closeForgotTwoStepModal()"></div>
        <div class="forgot-two-step-content">
            <div class="forgot-two-step-header">
                <div class="forgot-two-step-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                </div>
                <h3>Reset Security Password</h3>
                <p id="forgotTwoStepDesc">We'll send a reset code to your account email</p>
            </div>
            <div class="forgot-two-step-body">
                <!-- Step 1: Show account email and send code -->
                <div class="forgot-step" id="forgotStep1">
                    <div class="recovery-email-display">
                        <span class="recovery-label">Account email:</span>
                        <span class="recovery-email" id="recoveryEmailDisplay">j***@gmail.com</span>
                    </div>
                    <button class="settings-action-btn primary full-width" onclick="sendTwoStepResetCode()">
                        <span id="sendResetCodeBtnText">Send Reset Code</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    <div class="no-recovery-email" id="noRecoveryEmail" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <p>No email found for your account. Please contact support to reset your security password.</p>
                    </div>
                </div>

                <!-- Step 2: Enter code and new password -->
                <div class="forgot-step" id="forgotStep2" style="display: none;">
                    <div class="form-group">
                        <label>Enter the 6-digit code sent to your email</label>
                        <div class="otp-input-group">
                            <input type="text" maxlength="1" class="otp-input" data-index="0" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                            <input type="text" maxlength="1" class="otp-input" data-index="1" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                            <input type="text" maxlength="1" class="otp-input" data-index="2" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                            <input type="text" maxlength="1" class="otp-input" data-index="3" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                            <input type="text" maxlength="1" class="otp-input" data-index="4" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                            <input type="text" maxlength="1" class="otp-input" data-index="5" oninput="handleOtpInput(this)" onkeydown="handleOtpKeydown(event, this)">
                        </div>
                        <span class="form-error" id="otpError" style="display: none;">Invalid code. Please try again.</span>
                    </div>
                    <div class="form-group">
                        <label>New Security Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="newTwoStepPassword" placeholder="Enter new password (min 6 characters)" class="settings-input">
                            <button type="button" class="toggle-password-btn" onclick="toggleSetupPasswordVisibility('newTwoStepPassword', this)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-off-icon" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="confirmNewTwoStepPassword" placeholder="Confirm new password" class="settings-input">
                            <button type="button" class="toggle-password-btn" onclick="toggleSetupPasswordVisibility('confirmNewTwoStepPassword', this)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-icon">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-off-icon" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                        <span class="form-error" id="newPasswordError" style="display: none;">Passwords don't match</span>
                    </div>
                    <button class="settings-action-btn primary full-width" onclick="resetTwoStepPassword()">
                        <span id="resetPasswordBtnText">Reset Password</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    <div class="resend-code-section">
                        <span>Didn't receive the code?</span>
                        <button class="resend-code-btn" onclick="sendTwoStepResetCode()" id="resendCodeBtn">Resend</button>
                        <span class="resend-countdown" id="resendCountdown" style="display: none;">Resend in <span id="countdownTimer">60</span>s</span>
                    </div>
                </div>

                <!-- Step 3: Success -->
                <div class="forgot-step" id="forgotStep3" style="display: none;">
                    <div class="success-message">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        <h4>Password Reset Successfully!</h4>
                        <p>Your security password has been updated. You can now access your chats.</p>
                        <button class="settings-action-btn primary" onclick="closeForgotTwoStepModal(); verifyTwoStepPassword();">Continue to Chat</button>
                    </div>
                </div>
            </div>
            <button class="forgot-two-step-close" onclick="closeForgotTwoStepModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Chat Settings Modal (separate from main chat modal) -->
    <div class="chat-settings-modal" id="chatSettingsModal">
        <div class="chat-settings-modal-overlay" onclick="toggleChatSettings()"></div>
        <div class="chat-settings-modal-content">
            <div class="settings-modal-header">
                <h3>Chat Settings</h3>
                <button class="settings-modal-close" onclick="toggleChatSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="settings-modal-body">
                    <!-- Privacy & Security Section -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            Privacy & Security
                        </h4>

                        <!-- Subsection: Visibility -->
                        <div class="settings-subsection">
                            <span class="subsection-label">Visibility</span>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Last seen</span>
                                    <span class="option-desc">Who can see when you were last active</span>
                                </div>
                                <select class="settings-select" id="settingLastSeenVisibility" onchange="updateChatSetting('last_seen_visibility', this.value)">
                                    <option value="everyone">Everyone</option>
                                    <option value="connections">Connections only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Online status</span>
                                    <span class="option-desc">Show when you're online</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingOnlineStatus" checked onchange="updateChatSetting('online_status', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Read receipts</span>
                                    <span class="option-desc">Show when you've read messages</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingReadReceipts" checked onchange="updateChatSetting('read_receipts', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Typing indicators</span>
                                    <span class="option-desc">Show when you're typing</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingTypingIndicators" checked onchange="updateChatSetting('typing_indicators', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Subsection: Messaging -->
                        <div class="settings-subsection">
                            <span class="subsection-label">Messaging</span>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Who can message me</span>
                                    <span class="option-desc">Control who can start conversations</span>
                                </div>
                                <select class="settings-select" id="settingWhoCanMessage" onchange="updateChatSetting('who_can_message', this.value)">
                                    <option value="everyone">Everyone</option>
                                    <option value="connections">Connections only</option>
                                    <option value="none">No one</option>
                                </select>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Who can call me</span>
                                    <span class="option-desc">Control who can make voice/video calls</span>
                                </div>
                                <select class="settings-select" id="settingAllowCallsFrom" onchange="updateChatSetting('allow_calls_from', this.value)">
                                    <option value="everyone">Everyone</option>
                                    <option value="connections">Connections only</option>
                                    <option value="none">No one</option>
                                </select>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Who can add me to groups</span>
                                    <span class="option-desc">Control who can add you to group chats</span>
                                </div>
                                <select class="settings-select" id="settingAllowGroupAdds" onchange="updateChatSetting('allow_group_adds', this.value)">
                                    <option value="everyone">Everyone</option>
                                    <option value="connections">Connections only</option>
                                    <option value="none">No one</option>
                                </select>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Who can add me to channels</span>
                                    <span class="option-desc">Control who can add you to channels</span>
                                </div>
                                <select class="settings-select" id="settingAllowChannelAdds" onchange="updateChatSetting('allow_channel_adds', this.value)">
                                    <option value="everyone">Everyone</option>
                                    <option value="connections">Connections only</option>
                                    <option value="none">No one</option>
                                </select>
                            </div>
                        </div>

                        <!-- Subsection: Message Protection -->
                        <div class="settings-subsection">
                            <span class="subsection-label">Message Protection</span>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Block screenshots</span>
                                    <span class="option-desc">Prevent others from taking screenshots of your chats</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingBlockScreenshots" onchange="updateChatSetting('block_screenshots', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Disable message forwarding</span>
                                    <span class="option-desc">Prevent your messages from being forwarded</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="settingDisableForwarding" onchange="updateChatSetting('disable_forwarding', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Subsection: Account Security -->
                        <div class="settings-subsection">
                            <span class="subsection-label">Account Security</span>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Two-step verification</span>
                                    <span class="option-desc">Add an extra layer of security to your account</span>
                                </div>
                                <button class="settings-action-btn" id="settingTwoStepBtn" onclick="openTwoStepVerification()">
                                    <span id="twoStepBtnText">Set Up</span>
                                </button>
                            </div>
                            <div class="settings-option">
                                <div class="option-info">
                                    <span class="option-label">Active sessions</span>
                                    <span class="option-desc">Manage devices where you're logged in</span>
                                </div>
                                <button class="settings-action-btn" onclick="openActiveSessionsPanel()">
                                    <span id="activeSessionsCount">View</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Active Sessions Panel (slides in) -->
                    <div class="active-sessions-panel" id="activeSessionsPanel">
                        <div class="active-sessions-header">
                            <button class="active-sessions-back" onclick="closeActiveSessionsPanel()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <h4>Active Sessions</h4>
                        </div>
                        <div class="active-sessions-content">
                            <div class="current-session-card">
                                <div class="session-device-icon current">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                        <line x1="8" y1="21" x2="16" y2="21"></line>
                                        <line x1="12" y1="17" x2="12" y2="21"></line>
                                    </svg>
                                </div>
                                <div class="session-info">
                                    <span class="session-device-name">This device</span>
                                    <span class="session-details" id="currentSessionDetails">Loading...</span>
                                    <span class="session-status active">Online now</span>
                                </div>
                            </div>

                            <div class="other-sessions-header">
                                <span>Other sessions</span>
                                <button class="terminate-all-btn" onclick="terminateAllOtherSessions()">Terminate all</button>
                            </div>

                            <div class="other-sessions-list" id="otherSessionsList">
                                <div class="sessions-loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading sessions...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Two-Step Verification Panel (slides in) -->
                    <div class="two-step-panel" id="twoStepPanel">
                        <div class="two-step-header">
                            <button class="two-step-back" onclick="closeTwoStepPanel()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <h4>Two-Step Verification</h4>
                        </div>
                        <div class="two-step-content">
                            <div class="two-step-status" id="twoStepStatus">
                                <div class="two-step-icon disabled">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                    </svg>
                                </div>
                                <h5 id="twoStepStatusTitle">Two-Step Verification is Off</h5>
                                <p id="twoStepStatusDesc">Set up an additional password to protect your account.</p>
                            </div>

                            <div class="two-step-form" id="twoStepForm">
                                <div class="form-group">
                                    <label>Create a password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="twoStepPassword" placeholder="Enter password (min 6 characters)" class="settings-input">
                                        <button type="button" class="toggle-password-btn" onclick="toggleSetupPasswordVisibility('twoStepPassword', this)">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-icon">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-off-icon" style="display: none;">
                                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                                <line x1="1" y1="1" x2="23" y2="23"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Confirm password</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="twoStepConfirmPassword" placeholder="Re-enter password" class="settings-input">
                                        <button type="button" class="toggle-password-btn" onclick="toggleSetupPasswordVisibility('twoStepConfirmPassword', this)">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-icon">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="eye-off-icon" style="display: none;">
                                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                                <line x1="1" y1="1" x2="23" y2="23"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group form-hint-only">
                                    <span class="form-hint">If you forget your password, a reset code will be sent to your account email.</span>
                                </div>
                                <button class="settings-action-btn primary full-width" onclick="enableTwoStepVerification()">Enable Two-Step Verification</button>
                            </div>

                            <div class="two-step-enabled" id="twoStepEnabled" style="display: none;">
                                <div class="two-step-option">
                                    <span>Change password</span>
                                    <button class="settings-action-btn" onclick="changeTwoStepPassword()">Change</button>
                                </div>
                                <div class="two-step-option danger">
                                    <span>Turn off two-step verification</span>
                                    <button class="settings-action-btn danger" onclick="disableTwoStepVerification()">Disable</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Section -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            Notifications
                        </h4>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Message notifications</span>
                                <span class="option-desc">Get notified for new messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="settingMessageNotifications" checked onchange="updateChatSetting('message_notifications', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Sound alerts</span>
                                <span class="option-desc">Play sound for new messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="settingSoundAlerts" checked onchange="updateChatSetting('sound_alerts', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Mute all chats</span>
                                <span class="option-desc">Temporarily mute notifications</span>
                            </div>
                            <select class="settings-select" id="settingMuteAll" onchange="updateChatSetting('mute_duration', this.value)">
                                <option value="off">Off</option>
                                <option value="1h">For 1 hour</option>
                                <option value="8h">For 8 hours</option>
                                <option value="24h">For 24 hours</option>
                                <option value="forever">Until I turn back on</option>
                            </select>
                        </div>
                    </div>

                    <!-- Appearance Section -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="4"></circle>
                                <line x1="21.17" y1="8" x2="12" y2="8"></line>
                                <line x1="3.95" y1="6.06" x2="8.54" y2="14"></line>
                                <line x1="10.88" y1="21.94" x2="15.46" y2="14"></line>
                            </svg>
                            Appearance
                        </h4>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Chat bubble style</span>
                                <span class="option-desc">Choose message bubble shape</span>
                            </div>
                            <select class="settings-select" id="settingBubbleStyle" onchange="updateChatSetting('bubble_style', this.value)">
                                <option value="rounded">Rounded</option>
                                <option value="square">Square</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Font size</span>
                                <span class="option-desc">Adjust message text size</span>
                            </div>
                            <select class="settings-select" id="settingFontSize" onchange="updateChatSetting('font_size', this.value)">
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Message density</span>
                                <span class="option-desc">Spacing between messages</span>
                            </div>
                            <select class="settings-select" id="settingDensity" onchange="updateChatSetting('message_density', this.value)">
                                <option value="compact">Compact</option>
                                <option value="comfortable" selected>Comfortable</option>
                                <option value="spacious">Spacious</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Enter key behavior</span>
                                <span class="option-desc">What Enter key does</span>
                            </div>
                            <select class="settings-select" id="settingEnterKey" onchange="updateChatSetting('enter_key', this.value)">
                                <option value="send">Send message</option>
                                <option value="newline">New line</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Typing indicator style</span>
                                <span class="option-desc">Shape of typing animation dots</span>
                            </div>
                            <select class="settings-select" id="settingTypingStyle" onchange="updateChatSetting('typing_indicator_style', this.value)">
                                <option value="circle" selected>Circle</option>
                                <option value="square">Square</option>
                            </select>
                        </div>
                    </div>

                    <!-- Media & Storage Section (Coming Soon) -->
                    <div class="settings-section coming-soon-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                            </svg>
                            Media & Storage
                            <span class="coming-soon-badge">Coming Soon</span>
                        </h4>
                        <div class="settings-option" onclick="showComingSoonPanel('Media & Storage')">
                            <div class="option-info">
                                <span class="option-label">Auto-download media</span>
                                <span class="option-desc">Automatically download images/videos</span>
                            </div>
                            <select class="settings-select" disabled>
                                <option value="wifi">Wi-Fi only</option>
                            </select>
                        </div>
                        <div class="settings-option" onclick="showComingSoonPanel('Media & Storage')">
                            <div class="option-info">
                                <span class="option-label">Image quality</span>
                                <span class="option-desc">Quality when sending images</span>
                            </div>
                            <select class="settings-select" disabled>
                                <option value="compressed">Compressed</option>
                            </select>
                        </div>
                        <div class="settings-option storage-info" onclick="showComingSoonPanel('Media & Storage')">
                            <div class="option-info">
                                <span class="option-label">Storage used</span>
                                <span class="option-desc">Calculating...</span>
                            </div>
                            <button class="settings-action-btn" disabled>Clear Cache</button>
                        </div>
                    </div>

                    <!-- Voice Preferences Section -->
                    <div class="settings-section" id="voicePreferencesSection">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                            </svg>
                            Voice Preferences
                        </h4>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Text-to-speech voice</span>
                                <span class="option-desc">Voice for reading messages aloud</span>
                            </div>
                            <select class="settings-select" id="settingTTSVoice" onchange="handleVoiceSelection(this.value)">
                                <option value="none">Off</option>
                                <option value="synthetic" selected>Synthetic Voice</option>
                                <option value="truevoice">TrueVoice (Sender's Voice)</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Speech rate</span>
                                <span class="option-desc">Speed of text-to-speech playback</span>
                            </div>
                            <select class="settings-select" id="settingSpeechRate" onchange="updateChatSetting('speech_rate', this.value)">
                                <option value="0.75">0.75x (Slow)</option>
                                <option value="1" selected>1x (Normal)</option>
                                <option value="1.25">1.25x (Fast)</option>
                                <option value="1.5">1.5x (Faster)</option>
                                <option value="2">2x (Very Fast)</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Auto-play voice messages</span>
                                <span class="option-desc">Automatically play received voice messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="settingAutoPlayVoice" onchange="updateChatSetting('auto_play_voice', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Language & Translation Section -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 8l6 6"></path>
                                <path d="M4 14l6-6 2-3"></path>
                                <path d="M2 5h12"></path>
                                <path d="M7 2v3"></path>
                                <path d="M22 22l-5-10-5 10"></path>
                                <path d="M14 18h6"></path>
                            </svg>
                            Language & Translation
                        </h4>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Default translation language</span>
                                <span class="option-desc">Language for translating messages</span>
                            </div>
                            <select class="settings-select" id="settingDefaultTranslation" onchange="ChatModalManager.updateTranslationSetting('default_translation', this.value)">
                                <option value="none">No translation</option>
                                <option value="en">English</option>
                                <option value="am">Amharic</option>
                                <option value="om">Oromo</option>
                                <option value="ti">Tigrinya</option>
                                <option value="fr">French</option>
                                <option value="ar">Arabic</option>
                                <option value="es">Spanish</option>
                                <option value="pt">Portuguese</option>
                                <option value="zh">Chinese</option>
                                <option value="hi">Hindi</option>
                                <option value="sw">Swahili</option>
                                <option value="de">German</option>
                                <option value="it">Italian</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="ru">Russian</option>
                                <option value="tr">Turkish</option>
                            </select>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Auto-translate messages</span>
                                <span class="option-desc">Automatically translate incoming messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="settingAutoTranslate" onchange="ChatModalManager.updateTranslationSetting('auto_translate', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Translation service status</span>
                                <span class="option-desc" id="translationServiceStatus">Checking...</span>
                            </div>
                            <span class="status-indicator" id="translationStatusIndicator">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <!-- Data & Backup Section -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Data & Backup
                        </h4>
                        <div class="settings-option">
                            <div class="option-info">
                                <span class="option-label">Export chat history</span>
                                <span class="option-desc">Download all your conversations</span>
                            </div>
                            <button class="settings-action-btn" onclick="exportChatHistory()">Export</button>
                        </div>
                        <div class="settings-option danger-option">
                            <div class="option-info">
                                <span class="option-label">Delete all chat data</span>
                                <span class="option-desc">Permanently delete all messages</span>
                            </div>
                            <button class="settings-action-btn danger" onclick="deleteAllChatData()">Delete All</button>
                        </div>
                    </div>
            </div>

            <!-- Coming Soon Slide Panel -->
            <div class="coming-soon-panel" id="comingSoonPanel">
                <div class="coming-soon-panel-header">
                    <button class="coming-soon-back-btn" onclick="hideComingSoonPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h3 id="comingSoonPanelTitle">Coming Soon</h3>
                </div>
                <div class="coming-soon-panel-content">
                    <div class="coming-soon-icon">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <h4>Feature Coming Soon</h4>
                    <p id="comingSoonPanelDesc">This feature is currently under development and will be available in a future update.</p>
                    <div class="coming-soon-features">
                        <span class="feature-tag">In Development</span>
                    </div>
                </div>
            </div>

            <!-- TrueVoice Setup Slide Panel -->
            <div class="coming-soon-panel truevoice-setup-panel" id="truevoiceSetupPanel">
                <div class="coming-soon-panel-header">
                    <button class="coming-soon-back-btn" onclick="hideTrueVoiceSetupPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h3>TrueVoice Setup</h3>
                    <span class="truevoice-new-badge">NEW</span>
                </div>
                <div class="coming-soon-panel-content truevoice-setup-content">
                    <div class="truevoice-setup-icon">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </div>
                    <h4>Create Your TrueVoice</h4>
                    <p>Let others hear your messages in your own voice! Record a few sentences to create your unique voice profile.</p>
                    <div class="truevoice-features-list">
                        <div class="truevoice-feature-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            <span>Record 5 short sentences</span>
                        </div>
                        <div class="truevoice-feature-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            <span>Takes about 2 minutes</span>
                        </div>
                        <div class="truevoice-feature-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            <span>Your voice, your messages</span>
                        </div>
                    </div>
                    <button class="truevoice-start-btn" onclick="startTrueVoiceSetup()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        </svg>
                        Start Recording
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Chat Modal -->
    <div id="chatExportModal" class="chat-export-modal" style="display: none;">
        <div class="export-modal-overlay" onclick="ChatModalManager.closeExportModal()"></div>
        <div class="export-modal-content">
            <div class="export-modal-header">
                <h3>Export Chat History</h3>
                <button class="export-modal-close" onclick="ChatModalManager.closeExportModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="export-modal-body">
                <div class="export-two-column-layout">
                    <!-- Left Column: Options -->
                    <div class="export-left-column">
                        <!-- Date Range Options -->
                        <div class="export-options">
                            <h4>Date Range</h4>
                            <div class="export-date-range-options">
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="all" checked onchange="ChatModalManager.onDateRangeChange('all')">
                                    <span class="export-radio-custom"></span>
                                    <span>All time</span>
                                </label>
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="7days" onchange="ChatModalManager.onDateRangeChange('7days')">
                                    <span class="export-radio-custom"></span>
                                    <span>Last 7 days</span>
                                </label>
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="30days" onchange="ChatModalManager.onDateRangeChange('30days')">
                                    <span class="export-radio-custom"></span>
                                    <span>Last 30 days</span>
                                </label>
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="3months" onchange="ChatModalManager.onDateRangeChange('3months')">
                                    <span class="export-radio-custom"></span>
                                    <span>Last 3 months</span>
                                </label>
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="1year" onchange="ChatModalManager.onDateRangeChange('1year')">
                                    <span class="export-radio-custom"></span>
                                    <span>Last year</span>
                                </label>
                                <label class="export-radio-label">
                                    <input type="radio" name="exportDateRange" value="custom" onchange="ChatModalManager.onDateRangeChange('custom')">
                                    <span class="export-radio-custom"></span>
                                    <span>Custom range</span>
                                </label>
                            </div>
                            <!-- Custom Date Range Inputs -->
                            <div class="export-custom-date-range" id="exportCustomDateRange" style="display: none;">
                                <div class="export-date-input-group">
                                    <label for="exportDateFrom">From</label>
                                    <input type="date" id="exportDateFrom" class="export-date-input">
                                </div>
                                <div class="export-date-input-group">
                                    <label for="exportDateTo">To</label>
                                    <input type="date" id="exportDateTo" class="export-date-input">
                                </div>
                            </div>
                        </div>

                        <!-- Export Options -->
                        <div class="export-options">
                            <h4>Export Options</h4>
                            <div class="export-option-row">
                                <label class="export-checkbox-label">
                                    <input type="checkbox" id="exportIncludeMedia" checked>
                                    <span class="export-checkbox-custom"></span>
                                    <span>Include media file names</span>
                                </label>
                            </div>
                            <div class="export-option-row">
                                <label class="export-checkbox-label">
                                    <input type="checkbox" id="exportIncludeTimestamps" checked>
                                    <span class="export-checkbox-custom"></span>
                                    <span>Include timestamps</span>
                                </label>
                            </div>
                            <div class="export-option-row">
                                <label class="export-checkbox-label">
                                    <input type="checkbox" id="exportIncludeSenderNames" checked>
                                    <span class="export-checkbox-custom"></span>
                                    <span>Include sender names</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Search and List -->
                    <div class="export-right-column">
                        <!-- Search -->
                        <div class="export-search-container">
                            <input type="text" id="exportChatSearch" class="export-search-input" placeholder="Search conversations..." oninput="ChatModalManager.filterExportChats(this.value)">
                        </div>

                        <!-- Select All Option -->
                        <div class="export-select-all">
                            <label class="export-checkbox-label">
                                <input type="checkbox" id="exportSelectAll" onchange="ChatModalManager.toggleSelectAllExport(this.checked)">
                                <span class="export-checkbox-custom"></span>
                                <span>Select All Conversations</span>
                            </label>
                        </div>

                        <!-- Conversations List -->
                        <div class="export-conversations-list" id="exportConversationsList">
                            <!-- Conversations will be loaded here -->
                            <div class="export-loading">Loading conversations...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="export-modal-footer">
                <span class="export-selected-count" id="exportSelectedCount">0 conversations selected</span>
                <div class="export-footer-buttons">
                    <button class="export-btn-cancel" onclick="ChatModalManager.closeExportModal()">Cancel</button>
                    <button class="export-btn-primary" id="exportConfirmBtn" onclick="ChatModalManager.confirmExport()" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export as .txt
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Modal -->
    <div id="chatEmojiModal" class="emoji-gif-modal">
        <div class="emoji-gif-content">
            <button class="emoji-gif-close" onclick="closeChatEmojiModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
            <div class="tabs">
                <button class="tab active" onclick="showChatEmojiTab('emoji')">Emojis</button>
                <button class="tab" onclick="showChatEmojiTab('gif')">GIFs</button>
            </div>
            <div id="chatEmojiTab" class="tab-content active">
                <!-- Emojis will be populated dynamically -->
            </div>
            <div id="chatGifTab" class="tab-content">
                <div class="gif-search">
                    <input type="text" placeholder="Search GIFs..." id="chatGifSearch">
                </div>
                <div class="gif-grid" id="chatGifGrid">
                    <!-- GIFs will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="chatContextMenu" class="context-menu">
        <div class="context-menu-content">
            <button id="chatReplyMsgBtn" onclick="replyChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 17 4 12 9 7"></polyline>
                    <path d="M20 18v-2a4 4 0 0 0-4-4H4"></path>
                </svg>
                Reply
            </button>
            <button onclick="copyChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
            </button>
            <button id="chatForwardMsgBtn" onclick="forwardChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 17 20 12 15 7"></polyline>
                    <path d="M4 18v-2a4 4 0 0 1 4-4h12"></path>
                </svg>
                Forward
            </button>
            <button id="chatTranslateMsgBtn" onclick="translateChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 8l6 6"></path>
                    <path d="M4 14l6-6 2-3"></path>
                    <path d="M2 5h12"></path>
                    <path d="M7 2v3"></path>
                    <path d="M22 22l-5-10-5 10"></path>
                    <path d="M14 18h6"></path>
                </svg>
                Translate
            </button>
            <hr>
            <button id="chatEditMsgBtn" onclick="editChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit
            </button>
            <button id="chatDeleteMsgBtn" onclick="deleteChatMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
            </button>
            <button id="chatPinMsgBtn" style="display: none;">
                <i class="fas fa-thumbtack"></i>
                Pin Message
            </button>
            <hr>
            <div class="reaction-buttons">
                <button onclick="reactToChatMessage('heart')">&#10084;</button>
                <button onclick="reactToChatMessage('thumbsup')">&#128077;</button>
                <button onclick="reactToChatMessage('laugh')">&#128514;</button>
                <button onclick="reactToChatMessage('wow')">&#128558;</button>
                <button onclick="reactToChatMessage('sad')">&#128546;</button>
            </div>
        </div>
    </div>

    <!-- Call Modal -->
    <div id="chatCallModal" class="call-modal">
        <div class="call-modal-content">
            <!-- Incoming Call Screen -->
            <div class="incoming-call-screen" id="chatIncomingCallScreen" style="display: none;">
                <div class="incoming-call-avatar">
                    <img src="" alt="" id="chatIncomingCallAvatar">
                    <div class="call-pulse-ring"></div>
                    <div class="call-pulse-ring delay-1"></div>
                </div>
                <h2 id="chatIncomingCallerName">Incoming Call</h2>
                <p class="incoming-call-type" id="chatIncomingCallType">Voice Call</p>
                <p class="incoming-call-status">Ringing...</p>
                <div class="incoming-call-actions">
                    <button class="call-action-btn decline-btn" onclick="ChatModalManager.declineIncomingCall()" title="Decline">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </button>
                    <button class="call-action-btn accept-btn" onclick="ChatModalManager.acceptIncomingCall()" title="Accept">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Active Call Screen -->
            <div class="active-call-screen" id="chatActiveCallScreen">
                <div class="call-header">
                    <div class="call-user-info">
                        <img src="" alt="" id="chatCallUserAvatar">
                        <div>
                            <h2 id="chatCallUserName">User Name</h2>
                            <p id="chatCallUserRole">Role</p>
                            <p class="call-status" id="chatCallStatus">Connecting...</p>
                        </div>
                    </div>
                    <div class="call-header-controls">
                        <button class="call-close-btn" onclick="ChatModalManager.endChatCall()" title="Close">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="call-timer" id="chatCallTimer">00:00</div>

                <div class="call-video" id="chatCallVideo">
                    <!-- Single participant view (1-on-1 call) -->
                    <video id="chatRemoteVideo" autoplay playsinline class="main-video"></video>
                    <video id="chatLocalVideo" autoplay muted playsinline class="pip-video"></video>

                    <!-- Multi-participant grid (group call) -->
                    <div class="call-participants-grid" id="chatParticipantsGrid" style="display: none;">
                        <!-- Participant videos will be added here dynamically -->
                    </div>

                    <div class="voice-call-animation" id="chatVoiceCallAnimation">
                        <div class="voice-wave">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>

                    <!-- Participant list overlay -->
                    <div class="call-participants-list" id="chatParticipantsList">
                        <div class="participants-header">
                            <span>Participants (<span id="chatParticipantsCount">1</span>)</span>
                        </div>
                        <div class="participants-items" id="chatParticipantsItems">
                            <!-- Participants will be listed here -->
                        </div>
                    </div>
                </div>

                <div class="call-controls" id="chatCallControls">
                    <button id="chatSwitchVideoModeBtn" onclick="ChatModalManager.toggleChatCallVideo()" title="Toggle Video">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                    </button>
                    <button id="chatSwitchCallModeBtn" onclick="ChatModalManager.switchCallMode()" title="Switch to Video">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                        </svg>
                    </button>
                    <button id="chatMuteBtn" onclick="ChatModalManager.toggleChatMute()" title="Toggle Mute">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <line x1="23" y1="9" x2="17" y2="15"></line>
                            <line x1="17" y1="9" x2="23" y2="15"></line>
                        </svg>
                    </button>
                    <button id="chatAddParticipantBtn" onclick="ChatModalManager.addParticipantToCall()" title="Add Participant">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                    </button>
                    <button id="chatEndCallBtn" onclick="ChatModalManager.endChatCall()" title="End Call" class="end-call">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Recording Preview Modal -->
    <div id="chatVideoPreviewModal" class="video-preview-modal">
        <div class="video-preview-content">
            <div class="video-preview-header">
                <h3>Record Video Message</h3>
                <button class="video-preview-close" onclick="closeVideoPreview()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="video-preview-body">
                <video id="chatVideoPreview" autoplay muted playsinline></video>
                <div class="video-recording-indicator" id="videoRecordingIndicator">
                    <span class="recording-dot"></span>
                    <span class="recording-text">REC</span>
                    <span class="recording-timer" id="videoRecordingTimer">0:00</span>
                </div>
            </div>
            <div class="video-preview-controls">
                <button class="video-control-btn cancel" onclick="closeVideoPreview()" title="Cancel">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
                <button class="video-control-btn record" id="videoRecordToggleBtn" onclick="toggleVideoRecordingInPreview()" title="Start Recording">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                </button>
                <button class="video-control-btn send" id="videoSendBtn" onclick="sendRecordedVideo()" title="Send Video" disabled>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="chat-toast-container" id="chatToastContainer"></div>

    <!-- Create Group/Channel Modal -->
    <div class="create-group-modal" id="createGroupChannelModal">
        <div class="create-group-modal-overlay" onclick="ChatModalManager.closeCreateGroupModal()"></div>
        <div class="create-group-modal-content">
            <div class="create-group-header">
                <h3 id="createGroupModalTitle">Create Group</h3>
                <button class="create-group-close" onclick="ChatModalManager.closeCreateGroupModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="create-group-body">
                <!-- Group/Channel Name Input -->
                <div class="create-group-name-section">
                    <div class="group-icon-picker" onclick="ChatModalManager.pickGroupIcon()">
                        <i class="fas fa-camera"></i>
                    </div>
                    <input type="text" id="createGroupNameInput" placeholder="Group name" maxlength="50">
                    <input type="file" id="groupIconInput" accept="image/*" style="display: none;" onchange="ChatModalManager.handleGroupIconChange(event)">
                </div>

                <!-- Description (for channels) -->
                <div class="create-group-desc-section" id="channelDescSection" style="display: none;">
                    <textarea id="createChannelDescInput" placeholder="Channel description (optional)" maxlength="200"></textarea>
                </div>

                <!-- Search Contacts -->
                <div class="create-group-search">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="createGroupContactSearch" placeholder="Search contacts..." oninput="ChatModalManager.searchGroupContacts(this.value)">
                </div>

                <!-- Selected Members -->
                <div class="selected-members" id="selectedMembersList">
                    <!-- Selected members will appear here as chips -->
                </div>

                <!-- Contact List -->
                <div class="create-group-contacts" id="createGroupContactsList">
                    <div class="contacts-loading">
                        <div class="loading-spinner"></div>
                        <p>Loading contacts...</p>
                    </div>
                </div>
            </div>
            <div class="create-group-footer">
                <span class="selected-count" id="selectedMembersCount">0 members selected</span>
                <button class="create-group-btn" id="createGroupSubmitBtn" onclick="ChatModalManager.submitCreateGroup()" disabled>
                    <span id="createGroupSubmitLabel">Create Group</span>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Contact Confirmation Modal -->
    <div class="delete-contact-modal" id="deleteContactModal">
        <div class="delete-contact-modal-overlay" onclick="hideDeleteContactConfirmation()"></div>
        <div class="delete-contact-modal-content">
            <div class="delete-contact-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <line x1="18" y1="8" x2="23" y2="13"></line>
                    <line x1="23" y1="8" x2="18" y2="13"></line>
                </svg>
            </div>
            <h3>Delete Contact?</h3>
            <p id="deleteContactMessage">Are you sure you want to delete this contact? This will remove the connection and delete all chat history. This action cannot be undone.</p>
            <div class="delete-contact-user" id="deleteContactUserInfo">
                <img src="" alt="" id="deleteContactAvatar">
                <span id="deleteContactName">Contact Name</span>
            </div>
            <div class="delete-contact-actions">
                <button class="delete-contact-btn cancel" onclick="hideDeleteContactConfirmation()">Cancel</button>
                <button class="delete-contact-btn confirm" onclick="confirmDeleteContact()">Delete Contact</button>
            </div>
        </div>
    </div>

    <!-- Add Participant to Call Modal -->
    <div id="chatAddParticipantModal" class="chat-add-participant-modal" style="display: none;">
        <div class="add-participant-content">
            <div class="add-participant-header">
                <h3>Add to Call</h3>
                <button class="add-participant-close" onclick="ChatModalManager.closeAddParticipantModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="add-participant-search">
                <input type="text" id="addParticipantSearch" placeholder="Search contacts..." oninput="ChatModalManager.filterParticipantList(this.value)">
            </div>
            <div class="add-participant-list" id="addParticipantList">
                <!-- Contacts will be loaded here -->
            </div>
        </div>
    </div>
</div>
