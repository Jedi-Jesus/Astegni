<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Page Persistence Debug</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #58a6ff;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #8b949e;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
        }

        .panel-header {
            font-weight: bold;
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-grid {
            display: grid;
            gap: 10px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #0d1117;
            border-radius: 4px;
            border: 1px solid #21262d;
        }

        .status-label {
            color: #8b949e;
            font-size: 13px;
        }

        .status-value {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #7ee787;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .status-value.error {
            color: #f85149;
        }

        .status-value.warning {
            color: #d29922;
        }

        .status-value.success {
            color: #7ee787;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: #238636;
            color: white;
        }

        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        .btn-danger {
            background: #da3633;
            color: white;
        }

        .btn-light {
            background: #f6f8fa;
            color: #24292f;
        }

        .btn-dark {
            background: #24292f;
            color: #f6f8fa;
            border: 1px solid #444c56;
        }

        .log-container {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 3px;
            border-left: 3px solid transparent;
        }

        .log-entry.info {
            color: #58a6ff;
            border-left-color: #58a6ff;
            background: rgba(88, 166, 255, 0.05);
        }

        .log-entry.success {
            color: #7ee787;
            border-left-color: #7ee787;
            background: rgba(126, 231, 135, 0.05);
        }

        .log-entry.warning {
            color: #d29922;
            border-left-color: #d29922;
            background: rgba(210, 153, 34, 0.05);
        }

        .log-entry.error {
            color: #f85149;
            border-left-color: #f85149;
            background: rgba(248, 81, 73, 0.05);
        }

        .log-entry.nav {
            color: #bc8cff;
            border-left-color: #bc8cff;
            background: rgba(188, 140, 255, 0.05);
        }

        .timestamp {
            color: #6e7681;
            margin-right: 8px;
        }

        .page-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .page-link {
            display: block;
            padding: 15px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #58a6ff;
            text-decoration: none;
            text-align: center;
            transition: all 0.2s;
        }

        .page-link:hover {
            background: #21262d;
            border-color: #58a6ff;
            transform: translateY(-2px);
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid;
        }

        .alert-info {
            background: rgba(88, 166, 255, 0.1);
            border-color: #58a6ff;
            color: #58a6ff;
        }

        .alert-success {
            background: rgba(126, 231, 135, 0.1);
            border-color: #7ee787;
            color: #7ee787;
        }

        .alert-warning {
            background: rgba(210, 153, 34, 0.1);
            border-color: #d29922;
            color: #d29922;
        }

        .alert-error {
            background: rgba(248, 81, 73, 0.1);
            border-color: #f85149;
            color: #f85149;
        }

        .consistency-check {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #0d1117;
            border-radius: 4px;
        }

        .check-icon {
            font-size: 20px;
        }

        .check-text {
            flex: 1;
            font-size: 13px;
        }

        code {
            background: #0d1117;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #79c0ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Cross-Page Persistence Debug Console</h1>
        <p class="subtitle">Test appearance theme persistence across page navigation</p>

        <div id="alert-container"></div>

        <!-- Navigation Links -->
        <div class="panel">
            <div class="panel-header">üåê Test Navigation</div>
            <p style="color: #8b949e; font-size: 13px; margin-bottom: 15px;">
                Click a page to navigate and test persistence. Debug data will be logged automatically.
            </p>
            <div class="page-links">
                <a href="index.html" class="page-link">üè† Index</a>
                <a href="branch/find-tutors.html" class="page-link">üîç Find Tutors</a>
                <a href="profile-pages/advertiser-profile.html" class="page-link">üì¢ Advertiser Profile</a>
                <a href="profile-pages/tutor-profile.html" class="page-link">üë®‚Äçüè´ Tutor Profile</a>
                <a href="profile-pages/student-profile.html" class="page-link">üë®‚Äçüéì Student Profile</a>
                <a href="profile-pages/parent-profile.html" class="page-link">üë®‚Äçüë©‚Äçüëß Parent Profile</a>
                <a href="profile-pages/user-profile.html" class="page-link">üë§ User Profile</a>
            </div>
        </div>

        <!-- Current State -->
        <div class="grid">
            <div class="panel">
                <div class="panel-header">üìä Current State</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Current Page:</span>
                        <span class="status-value" id="current-page">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">HTML data-theme:</span>
                        <span class="status-value" id="html-theme">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">HTML classList:</span>
                        <span class="status-value" id="html-class">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Body classList:</span>
                        <span class="status-value" id="body-class">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">localStorage.theme:</span>
                        <span class="status-value" id="ls-theme">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">appearance_settings:</span>
                        <span class="status-value" id="ls-appearance" style="max-width: none; white-space: pre-wrap; word-break: break-all;">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Manager Loaded:</span>
                        <span class="status-value" id="manager-loaded">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Manager Settings:</span>
                        <span class="status-value" id="manager-settings" style="max-width: none; white-space: pre-wrap; word-break: break-all;">-</span>
                    </div>
                </div>

                <div class="btn-grid">
                    <button class="btn-primary" onclick="refreshState()">üîÑ Refresh</button>
                    <button class="btn-secondary" onclick="checkConsistency()">‚úÖ Check Consistency</button>
                    <button class="btn-secondary" onclick="copyResults()">üìã Copy Results</button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">‚ö° Quick Actions</div>
                <div class="btn-grid">
                    <button class="btn-light" onclick="applyTheme('light')">‚òÄÔ∏è Apply Light</button>
                    <button class="btn-dark" onclick="applyTheme('dark')">üåô Apply Dark</button>
                    <button class="btn-secondary" onclick="applyTheme('system')">üíª Apply System</button>
                    <button class="btn-danger" onclick="clearAllStorage()">üóëÔ∏è Clear All</button>
                    <button class="btn-primary" onclick="reapplySettings()">‚úÖ Reapply</button>
                    <button class="btn-secondary" onclick="exportDebugReport()">üìÑ Export Report</button>
                </div>

                <div class="panel-header" style="margin-top: 20px;">üé® Test Scenarios</div>
                <div class="btn-grid">
                    <button class="btn-secondary" onclick="runScenario1()">Test 1: Light ‚Üí Navigate</button>
                    <button class="btn-secondary" onclick="runScenario2()">Test 2: Dark ‚Üí Navigate</button>
                    <button class="btn-secondary" onclick="runScenario3()">Test 3: Clear ‚Üí Navigate</button>
                </div>
            </div>
        </div>

        <!-- Consistency Checks -->
        <div class="panel">
            <div class="panel-header">‚úÖ Consistency Checks</div>
            <div class="consistency-check" id="consistency-container">
                <p style="color: #8b949e; font-size: 13px;">Click "Check Consistency" to run validation...</p>
            </div>
        </div>

        <!-- Event Log -->
        <div class="panel">
            <div class="panel-header">üìù Event Log</div>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button class="btn-secondary" onclick="clearLogs()">üßπ Clear Logs</button>
                <button class="btn-secondary" onclick="toggleAutoRefresh()">
                    <span id="auto-refresh-text">‚è±Ô∏è Auto-Refresh (OFF)</span>
                </button>
            </div>
            <div class="log-container" id="log-container">
                <div class="log-entry info">
                    <span class="timestamp">[--:--:--]</span>
                    <span>Debug console loaded. Click Refresh to see current state.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        let autoRefreshInterval = null;

        // Log function
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                timestamp,
                message,
                type,
                page: window.location.pathname
            };
            logs.push(entry);

            const logContainer = document.getElementById('log-container');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span><span>${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;

            console.log(`[${type.toUpperCase()}] ${message}`);

            // Store in sessionStorage for cross-page tracking
            const sessionLogs = JSON.parse(sessionStorage.getItem('debug_logs') || '[]');
            sessionLogs.push(entry);
            sessionStorage.setItem('debug_logs', JSON.stringify(sessionLogs));
        }

        // Refresh state
        function refreshState() {
            log('Refreshing state...', 'info');

            // Current page
            document.getElementById('current-page').textContent = window.location.pathname;

            // HTML theme
            const htmlTheme = document.documentElement.getAttribute('data-theme');
            const htmlThemeEl = document.getElementById('html-theme');
            htmlThemeEl.textContent = htmlTheme || 'NOT SET';
            htmlThemeEl.className = `status-value ${htmlTheme ? 'success' : 'error'}`;

            // HTML class
            const htmlClass = document.documentElement.className || 'none';
            document.getElementById('html-class').textContent = htmlClass;

            // Body class
            const bodyClass = document.body.className || 'none';
            document.getElementById('body-class').textContent = bodyClass;

            // localStorage.theme
            const lsTheme = localStorage.getItem('theme');
            const lsThemeEl = document.getElementById('ls-theme');
            lsThemeEl.textContent = lsTheme || 'NOT SET';
            lsThemeEl.className = `status-value ${lsTheme ? 'success' : 'error'}`;

            // appearance_settings
            const lsAppearance = localStorage.getItem('appearance_settings');
            const lsAppearanceEl = document.getElementById('ls-appearance');
            if (lsAppearance) {
                try {
                    const parsed = JSON.parse(lsAppearance);
                    lsAppearanceEl.textContent = JSON.stringify(parsed, null, 2);
                    lsAppearanceEl.className = 'status-value success';
                } catch (e) {
                    lsAppearanceEl.textContent = 'PARSE ERROR';
                    lsAppearanceEl.className = 'status-value error';
                }
            } else {
                lsAppearanceEl.textContent = 'NOT SET';
                lsAppearanceEl.className = 'status-value error';
            }

            // Manager loaded
            const managerLoaded = typeof appearanceModalManager !== 'undefined';
            const managerEl = document.getElementById('manager-loaded');
            managerEl.textContent = managerLoaded ? 'YES ‚úì' : 'NO ‚úó';
            managerEl.className = `status-value ${managerLoaded ? 'success' : 'error'}`;

            // Manager settings
            const managerSettingsEl = document.getElementById('manager-settings');
            if (managerLoaded && appearanceModalManager.settings) {
                managerSettingsEl.textContent = JSON.stringify(appearanceModalManager.settings, null, 2);
                managerSettingsEl.className = 'status-value success';
            } else {
                managerSettingsEl.textContent = 'NOT AVAILABLE';
                managerSettingsEl.className = 'status-value error';
            }

            log('State refreshed', 'success');
        }

        // Check consistency
        function checkConsistency() {
            log('Running consistency checks...', 'info');

            const container = document.getElementById('consistency-container');
            container.innerHTML = '';

            const checks = [];

            // Get values
            const htmlTheme = document.documentElement.getAttribute('data-theme');
            const lsTheme = localStorage.getItem('theme');
            const lsAppearance = localStorage.getItem('appearance_settings');
            let appearanceTheme = null;

            if (lsAppearance) {
                try {
                    appearanceTheme = JSON.parse(lsAppearance).theme;
                } catch (e) {
                    checks.push({
                        pass: false,
                        message: 'appearance_settings has invalid JSON'
                    });
                }
            }

            const managerLoaded = typeof appearanceModalManager !== 'undefined';
            const managerTheme = managerLoaded ? appearanceModalManager.settings?.theme : null;

            // Check 1: HTML theme matches localStorage
            if (appearanceTheme) {
                const match = htmlTheme === appearanceTheme || (appearanceTheme === 'system' && (htmlTheme === 'light' || htmlTheme === 'dark'));
                checks.push({
                    pass: match,
                    message: `HTML data-theme (${htmlTheme}) ${match ? 'matches' : 'does NOT match'} appearance_settings.theme (${appearanceTheme})`
                });
            }

            // Check 2: Manager settings match localStorage
            if (managerLoaded && managerTheme && appearanceTheme) {
                const match = managerTheme === appearanceTheme;
                checks.push({
                    pass: match,
                    message: `Manager settings.theme (${managerTheme}) ${match ? 'matches' : 'does NOT match'} appearance_settings.theme (${appearanceTheme})`
                });
            }

            // Check 3: HTML has theme attribute
            checks.push({
                pass: !!htmlTheme,
                message: htmlTheme ? `HTML has data-theme="${htmlTheme}"` : 'HTML missing data-theme attribute'
            });

            // Check 4: localStorage has appearance_settings
            checks.push({
                pass: !!lsAppearance,
                message: lsAppearance ? 'localStorage has appearance_settings' : 'localStorage missing appearance_settings'
            });

            // Check 5: Manager is loaded
            checks.push({
                pass: managerLoaded,
                message: managerLoaded ? 'appearanceModalManager is loaded' : 'appearanceModalManager is NOT loaded'
            });

            // Check 6: HTML classList includes theme (optional for debug page)
            const hasThemeClass = document.documentElement.classList.contains('dark') || document.documentElement.classList.contains('light');
            const isDebugPage = window.location.pathname.includes('cross-page-persistence-debug');
            checks.push({
                pass: hasThemeClass || isDebugPage,
                message: hasThemeClass
                    ? 'HTML classList includes theme class'
                    : (isDebugPage ? 'HTML classList missing theme class (OK for debug page)' : 'HTML classList missing theme class')
            });

            // Render checks
            checks.forEach(check => {
                const item = document.createElement('div');
                item.className = 'check-item';
                item.innerHTML = `
                    <span class="check-icon">${check.pass ? '‚úÖ' : '‚ùå'}</span>
                    <span class="check-text">${check.message}</span>
                `;
                container.appendChild(item);
            });

            const allPassed = checks.every(c => c.pass);
            log(`Consistency check: ${allPassed ? 'ALL PASSED ‚úì' : 'FAILURES DETECTED ‚úó'}`, allPassed ? 'success' : 'error');

            // Show alert
            showAlert(
                allPassed ? 'All consistency checks passed!' : 'Some consistency checks failed. See details above.',
                allPassed ? 'success' : 'error'
            );

            return checks;
        }

        // Copy results to clipboard
        function copyResults() {
            log('Copying results to clipboard...', 'info');

            // Get current state
            const htmlTheme = document.documentElement.getAttribute('data-theme');
            const htmlClass = document.documentElement.className;
            const bodyClass = document.body.className;
            const lsTheme = localStorage.getItem('theme');
            const lsAppearance = localStorage.getItem('appearance_settings');
            const managerLoaded = typeof appearanceModalManager !== 'undefined';
            const managerSettings = managerLoaded && appearanceModalManager.settings
                ? JSON.stringify(appearanceModalManager.settings, null, 2)
                : 'NOT AVAILABLE';

            // Format results
            const results = `
=== CROSS-PAGE PERSISTENCE DEBUG RESULTS ===
Generated: ${new Date().toLocaleString()}
Page: ${window.location.pathname}

--- CURRENT STATE ---
HTML data-theme: ${htmlTheme || 'NOT SET'}
HTML classList: ${htmlClass || 'none'}
Body classList: ${bodyClass || 'none'}
localStorage.theme: ${lsTheme || 'NOT SET'}
localStorage.appearance_settings: ${lsAppearance || 'NOT SET'}
Manager Loaded: ${managerLoaded ? 'YES ‚úì' : 'NO ‚úó'}
Manager Settings: ${managerSettings}

--- CONSISTENCY CHECKS ---
${document.getElementById('consistency-container').innerText || 'Run "Check Consistency" first'}

--- EVENT LOG (Last 10) ---
${logs.slice(-10).map(l => `[${l.timestamp}] [${l.type.toUpperCase()}] ${l.message}`).join('\n')}

=== END RESULTS ===
            `.trim();

            // Copy to clipboard
            navigator.clipboard.writeText(results).then(() => {
                log('Results copied to clipboard!', 'success');
                showAlert('Results copied to clipboard!', 'success');
            }).catch(err => {
                log('Failed to copy: ' + err, 'error');
                // Fallback: show results in alert
                alert('Copy failed. Results:\n\n' + results);
            });
        }

        // Apply theme
        function applyTheme(theme) {
            log(`Applying ${theme.toUpperCase()} theme...`, 'info');

            if (typeof appearanceModalManager !== 'undefined') {
                appearanceModalManager.applyTheme(theme);
                appearanceModalManager.settings.theme = theme;
                appearanceModalManager.saveSettings();
                log(`${theme.toUpperCase()} theme applied via manager`, 'success');
            } else {
                const effectiveTheme = theme === 'system'
                    ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
                    : theme;
                document.documentElement.setAttribute('data-theme', effectiveTheme);
                localStorage.setItem('appearance_settings', JSON.stringify({ theme }));
                log(`${theme.toUpperCase()} theme applied manually (manager not available)`, 'warning');
            }

            refreshState();
            checkConsistency();
        }

        // Clear storage
        function clearAllStorage() {
            log('Clearing all localStorage...', 'warning');
            localStorage.removeItem('theme');
            localStorage.removeItem('appearance_settings');
            localStorage.removeItem('colorPalette');
            log('All localStorage cleared', 'success');
            refreshState();
        }

        // Reapply settings
        function reapplySettings() {
            log('Reapplying all settings...', 'info');
            if (typeof appearanceModalManager !== 'undefined') {
                appearanceModalManager.applySettings();
                log('Settings reapplied via manager', 'success');
            } else {
                log('Manager not available - cannot reapply', 'error');
            }
            refreshState();
        }

        // Export report
        function exportDebugReport() {
            const report = {
                timestamp: new Date().toISOString(),
                page: window.location.pathname,
                state: {
                    htmlTheme: document.documentElement.getAttribute('data-theme'),
                    htmlClass: document.documentElement.className,
                    bodyClass: document.body.className,
                    lsTheme: localStorage.getItem('theme'),
                    lsAppearance: localStorage.getItem('appearance_settings'),
                    managerLoaded: typeof appearanceModalManager !== 'undefined',
                    managerSettings: typeof appearanceModalManager !== 'undefined' ? appearanceModalManager.settings : null
                },
                logs: logs
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            log('Debug report exported', 'success');
        }

        // Clear logs
        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
            logs = [];
            sessionStorage.removeItem('debug_logs');
            log('Logs cleared', 'info');
        }

        // Toggle auto-refresh
        function toggleAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                document.getElementById('auto-refresh-text').textContent = '‚è±Ô∏è Auto-Refresh (OFF)';
                log('Auto-refresh disabled', 'warning');
            } else {
                autoRefreshInterval = setInterval(() => refreshState(), 1000);
                document.getElementById('auto-refresh-text').textContent = '‚è±Ô∏è Auto-Refresh (ON)';
                log('Auto-refresh enabled (1s)', 'success');
            }
        }

        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        // Test scenarios
        function runScenario1() {
            log('=== SCENARIO 1: Light Theme ‚Üí Navigate ===', 'nav');
            applyTheme('light');
            setTimeout(() => {
                log('Navigate to tutor-profile in 3 seconds...', 'nav');
                showAlert('Navigate to tutor-profile manually and check if theme persists', 'info');
            }, 1000);
        }

        function runScenario2() {
            log('=== SCENARIO 2: Dark Theme ‚Üí Navigate ===', 'nav');
            applyTheme('dark');
            setTimeout(() => {
                log('Navigate to student-profile in 3 seconds...', 'nav');
                showAlert('Navigate to student-profile manually and check if theme persists', 'info');
            }, 1000);
        }

        function runScenario3() {
            log('=== SCENARIO 3: Clear ‚Üí Navigate ===', 'nav');
            clearAllStorage();
            setTimeout(() => {
                log('Navigate to any page and check default theme...', 'nav');
                showAlert('Navigate to any page and verify default theme is applied', 'info');
            }, 1000);
        }

        // Load previous session logs
        function loadSessionLogs() {
            const sessionLogs = JSON.parse(sessionStorage.getItem('debug_logs') || '[]');
            if (sessionLogs.length > 0) {
                log(`Found ${sessionLogs.length} logs from previous navigation`, 'info');
                logs = sessionLogs;

                // Display last 5
                const last5 = sessionLogs.slice(-5);
                last5.forEach(entry => {
                    if (entry.page !== window.location.pathname) {
                        const logContainer = document.getElementById('log-container');
                        const logEntry = document.createElement('div');
                        logEntry.className = `log-entry ${entry.type}`;
                        logEntry.innerHTML = `<span class="timestamp">[${entry.timestamp}]</span><span>[${entry.page}] ${entry.message}</span>`;
                        logContainer.appendChild(logEntry);
                    }
                });
            }
        }

        // Track page load
        function trackPageLoad() {
            log(`Page loaded: ${window.location.pathname}`, 'nav');
            refreshState();
            setTimeout(() => checkConsistency(), 500);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            log('DOMContentLoaded fired', 'info');
            loadSessionLogs();
            trackPageLoad();
        });

        window.addEventListener('load', () => {
            log('window.load fired', 'info');
            setTimeout(() => refreshState(), 100);
        });

        // Monitor storage changes
        window.addEventListener('storage', (e) => {
            if (e.key === 'theme' || e.key === 'appearance_settings') {
                log(`localStorage.${e.key} changed from "${e.oldValue}" to "${e.newValue}"`, 'warning');
                refreshState();
            }
        });

        // Monitor theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    const newTheme = document.documentElement.getAttribute('data-theme');
                    log(`HTML data-theme changed to: ${newTheme}`, 'warning');
                }
            });
        });

        observer.observe(document.documentElement, { attributes: true });

        console.log('%c‚úÖ Cross-Page Persistence Debug Console Loaded', 'color: #7ee787; font-size: 14px; font-weight: bold;');
    </script>

    <!-- Load appearance-manager.js so we can test themes properly -->
    <script src="js/common-modals/appearance-manager.js"></script>
</body>
</html>
