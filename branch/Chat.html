<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Chat Application - Complete</title>
  <link rel="stylesheet" href="../css/chat.css">
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-animation">
    <span style="left: 10%; animation-delay: 0s;"></span>
    <span style="left: 20%; animation-delay: 2s; animation-duration: 12s;"></span>
    <span style="left: 30%; animation-delay: 4s;"></span>
    <span style="left: 40%; animation-delay: 0s; animation-duration: 18s;"></span>
    <span style="left: 50%; animation-delay: 0s;"></span>
    <span style="left: 60%; animation-delay: 3s;"></span>
    <span style="left: 70%; animation-delay: 4s;"></span>
    <span style="left: 80%; animation-delay: 5s; animation-duration: 20s;"></span>
    <span style="left: 90%; animation-delay: 2s;"></span>
  </div>

  <!-- Main Button -->
  <button class="open-chat-btn" onclick="openModal()">
    💬 Open Enhanced Chat
  </button>

  <!-- Chat Modal -->
  <div id="chatModal" class="modal">
    <div class="modal-content" id="modalContent">
      <!-- User Info Header -->
      <div class="user-info">
        <div class="user-avatar">
          <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="John Doe" id="userAvatar">
          <div class="online-indicator"></div>
        </div>
        <div class="user-details">
          <div class="user-info-left">
            <h2>John Doe</h2>
            <div class="rating-container">
              <span class="rating-stars">★★★★★</span> <span>(50 People)</span>
              <div class="rating-tooltip">
                <p>Communication Skills:</p>
                <div class="rating-bar">
                  <div class="rating-bar-fill" style="width: 80%"></div>
                </div>
                <p>Subject Matter:</p>
                <div class="rating-bar">
                  <div class="rating-bar-fill" style="width: 90%"></div>
                </div>
                <p>Discipline:</p>
                <div class="rating-bar">
                  <div class="rating-bar-fill" style="width: 70%"></div>
                </div>
                <p>Punctuality:</p>
                <div class="rating-bar">
                  <div class="rating-bar-fill" style="width: 85%"></div>
                </div>
              </div>
            </div>
            <p id="typingIndicatorHeader" class="typing-indicator-header">
              <span>.</span><span>.</span><span>.</span>
            </p>
          </div>
          <div>
            <p>+1-555-123-4567</p>
            <p>john.doe@example.com</p>
            <p>New York, NY</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="header-btn call-btn-main" id="callBtn" onclick="startOrEndCall()" title="Start Call">
            📞
          </button>
          <button class="close-btn" onclick="closeModal()" title="Close">✕</button>
          <button class="minimize-btn" id="minimizeBtn" onclick="minimizeModal()" title="Minimize">—</button>
          <button class="maximize-btn" id="maximizeBtn" onclick="maximizeModal()" style="display: none;" title="Maximize">□</button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="search-container">
        <input type="text" class="search-bar" id="searchBar" placeholder="Search messages...">
      </div>

      <!-- Pinned Messages -->
      <div id="pinnedMessages" class="pinned-messages">
        <h3>Pinned Messages</h3>
      </div>

      <!-- Chat Area -->
      <div class="chat-area" id="chatArea">
        <div class="date-divider">
          <span>Today</span>
        </div>
      </div>

      <!-- Voice Recording -->
      <div class="voice-recording" id="voiceRecording">
        <span class="recording-time" id="recordingTime">0:00</span>
        <div class="recording-wave">
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
        </div>
      </div>

      <!-- File Preview -->
      <div class="file-preview" id="filePreview"></div>

      <!-- Input Area -->
      <div class="input-area">
        <div class="input-container">
          <button class="read-all-btn" id="readAllBtn" onclick="readAllMessages()" title="Read All">🔊</button>
          <button class="stop-read-btn" id="stopReadBtn" onclick="stopReading()" title="Stop Reading">⏹️</button>
          <button class="restart-read-btn" id="restartReadBtn" onclick="restartReading()" title="Restart Reading">🔄</button>
          
          <div class="input-wrapper">
            <textarea 
              class="message-input" 
              id="messageInput" 
              placeholder="Type a message..."
              rows="1"></textarea>
            <div class="input-actions">
              <button class="emoji-btn" onclick="openEmojiGifModal()" title="Emoji">😊</button>
              <label class="file-btn" title="Attach File">
                📎
                <input type="file" id="fileInput" class="file-input" accept="image/*,video/*,audio/*,application/pdf,.doc,.docx" multiple onchange="handleFileChange()">
              </label>
            </div>
          </div>
          
          <button class="media-btn" id="voiceToTextBtn" onclick="selectMediaMode('voice-to-text')" title="Voice to Text">🎤</button>
          <button class="media-btn" id="voiceRecordBtn" onclick="selectMediaMode('voice-record')" title="Record Voice">🎙️</button>
          <button class="media-btn" id="videoRecordBtn" onclick="selectMediaMode('video-record')" title="Record Video">📹</button>
          <button class="control-btn" id="controlBtn" onclick="controlRecording()" title="Start Recording">⏺️</button>
          <button class="stop-btn" id="stopBtn" onclick="stopRecording()" title="Stop Recording">⏹️</button>
          <button class="send-btn" onclick="sendMessage()" id="sendBtn" title="Send">➤</button>
        </div>
        <div id="status" class="status"></div>
      </div>
    </div>
  </div>

  <!-- Call Modal -->
  <div id="callModal" class="call-modal">
    <div class="call-modal-content">
      <div class="call-user-info">
        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="John Doe">
        <div class="call-user-details">
          <div>
            <h2>John Doe</h2>
            <p>+1-555-123-4567</p>
            <p>john.doe@example.com</p>
            <p>New York, NY</p>
          </div>
        </div>
        <button class="close-btn" onclick="closeCallModal()" title="Close">✕</button>
        <button class="minimize-btn" id="callMinimizeBtn" onclick="minimizeCallModal()" title="Minimize">—</button>
        <button class="maximize-btn" id="callMaximizeBtn" onclick="maximizeCallModal()" style="display: none;" title="Maximize">□</button>
      </div>
      
      <div class="call-video" id="callVideo">
        <div class="voice-call-animation" id="voiceCallAnimation">📞</div>
      </div>
      
      <div class="call-controls" id="callControls">
        <button id="switchToVideoBtn" onclick="toggleVideoCall()" title="Start Video Call">📹</button>
        <button id="switchToVoiceBtn" onclick="toggleVoiceCall()" title="Start Voice Call">📞</button>
        <button id="shareScreenBtn" onclick="shareScreen()" title="Share Screen">🖥️</button>
        <button id="swapVideoBtn" onclick="swapVideo()" title="Swap Video" style="display: none;">🔄</button>
        <button id="speakerBtn" onclick="toggleSpeaker()" title="Toggle Speaker" class="active">🔊</button>
        <button id="muteBtn" onclick="toggleMute()" title="Toggle Mute">🎤</button>
      </div>
    </div>
  </div>

  <!-- Minimized Video Preview -->
  <div id="minimizedVideoPreview" class="minimized-video-preview">
    <video id="minimizedVideo" muted></video>
  </div>

  <!-- Emoji/GIF Modal -->
  <div id="emojiGifModal" class="emoji-gif-modal">
    <div class="emoji-gif-content">
      <button class="emoji-gif-close" onclick="closeEmojiGifModal()">✕</button>
      <div class="tabs">
        <button class="tab active" onclick="showTab('emojiTab')">Emojis</button>
        <button class="tab" onclick="showTab('gifTab')">GIFs</button>
      </div>
      <div id="emojiTab" class="tab-content active">
        <!-- Emojis will be populated dynamically -->
      </div>
      <div id="gifTab" class="tab-content">
        <button class="gif-btn"><img src="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif" onclick="addEmoji('[GIF]')"></button>
        <button class="gif-btn"><img src="https://media.giphy.com/media/LmNwrBhejkK9EFP504/giphy.gif" onclick="addEmoji('[GIF]')"></button>
      </div>
    </div>
  </div>

  <!-- Attachment Modal -->
  <div id="attachmentModal" class="attachment-modal">
    <div class="attachment-content">
      <div id="attachmentViewer"></div>
      <div class="attachment-controls">
        <button onclick="downloadAttachment()">Download</button>
        <button onclick="toggleFullScreen()">Full Screen</button>
        <button onclick="previousAttachment()">Previous</button>
        <button onclick="nextAttachment()">Next</button>
        <button onclick="forwardAttachment()">Forward</button>
        <button onclick="replayAttachment()">Replay</button>
        <button onclick="copyAttachmentLink()">Copy Link</button>
        <button onclick="closeAttachmentModal()">Close</button>
        <button class="zoom-btn" onclick="zoomAttachment(1.2)">Zoom In</button>
        <button class="zoom-btn" onclick="zoomAttachment(0.833)">Zoom Out</button>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div id="contextMenu" class="context-menu">
    <button id="editBtn" onclick="editMessage()">Edit</button>
    <button id="deleteBtn" onclick="showDeletePrompt()">Delete</button>
    <hr>
    <button id="forwardBtn" onclick="forwardMessage()">Forward</button>
    <button id="copyBtn" onclick="copyMessage()">Copy</button>
    <button id="selectBtn" onclick="selectMessage()">Select</button>
    <button id="selectAllBtn" onclick="selectAllMessages()">Select All</button>
    <hr>
    <button id="pinBtn" onclick="pinMessage()">Pin</button>
    <button id="unpinBtn" onclick="unpinMessage()" style="display: none;">Unpin</button>
    <button id="replyBtn" onclick="replyMessage()">Reply</button>
    <hr>
    <div class="reaction-buttons">
      <button onclick="reactMessage('❤️')">❤️</button>
      <button onclick="reactMessage('😂')">😂</button>
      <button onclick="reactMessage('😮')">😮</button>
      <button onclick="reactMessage('😢')">😢</button>
      <button onclick="reactMessage('😊')">😊</button>
      <button onclick="reactMessage('👍')">👍</button>
      <button onclick="reactMessage('👎')">👎</button>
      <button onclick="reactMessage('🎉')">🎉</button>
      <button onclick="reactMessage('😍')">😍</button>
      <button onclick="reactMessage('😡')">😡</button>
    </div>
  </div>

  <!-- Undo Container -->
  <div id="undoContainer" class="undo-container">
    Message deleted <button onclick="undoDelete()">Undo</button>
  </div>

  <!-- Delete Prompt -->
  <div id="deletePrompt" class="delete-prompt">
    <p id="deletePromptText"></p>
    <label id="deleteForReceiverLabel" style="display: none;">
      <input type="checkbox" id="deleteForReceiver"> Delete for John Doe too?
    </label>
    <button class="confirm" onclick="confirmDelete()">Confirm</button>
    <button class="cancel" onclick="hideDeletePrompt()">Cancel</button>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <script src="../js/chat.js"></script>
</body>
</html>